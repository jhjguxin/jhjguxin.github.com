
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Francis's Octopress Blog</title>
  <meta name="author" content="Francis Jiang">

  
  <meta name="description" content="devise IMPORTANT: Devise 2.0.0.rc is out. If you are upgrading, please read: github.com/plataformatec/devise/wiki/How-To:-Upgrade-to-Devise-2.0 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://jhjguxin.github.io/blog/page/12">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Francis's Octopress Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-25901353-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Francis's Octopress Blog</a></h1>
  
    <h2>A blogging framework for hackers.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:jhjguxin.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/readme">Readme</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/01/06/devise/">Devise</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-06T12:44:00+08:00" pubdate data-updated="true">Jan 6<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>devise</h2>

<div>
<div>

<strong>IMPORTANT:</strong> Devise 2.0.0.rc is out. If you are upgrading, please read: <a href="https://github.com/plataformatec/devise/wiki/How-To:-Upgrade-to-Devise-2.0">github.com/plataformatec/devise/wiki/How-To:-Upgrade-to-Devise-2.0</a>
<h2>Devise</h2>
<a href="http://travis-ci.org/plataformatec/devise"><img src="https://secure.travis-ci.org/plataformatec/devise.png" alt="" /></a>

Devise is a flexible authentication solution for Rails based on Warden. It:
<ul>
    <li>Is Rack based;</li>
    <li>Is a complete MVC solution based on Rails engines;</li>
    <li>Allows you to have multiple roles (or models/scopes) signed in at the same time;</li>
    <li>Is based on a modularity concept: use just what you really need.</li>
</ul>
It’s comprised of 12 modules:
<ul>
    <li>Database Authenticatable: encrypts and stores a password in the database to validate the authenticity of a user while signing in. The authentication can be done both through POST requests or HTTP Basic Authentication.</li>
    <li>Token Authenticatable: signs in a user based on an authentication token (also known as “single access token”). The token can be given both through query string or HTTP Basic Authentication.</li>
    <li>Omniauthable: adds Omniauth (github.com/intridea/omniauth) support;</li>
    <li>Confirmable: sends emails with confirmation instructions and verifies whether an account is already confirmed during sign in.</li>
    <li>Recoverable: resets the user password and sends reset instructions.</li>
    <li>Registerable: handles signing up users through a registration process, also allowing them to edit and destroy their account.</li>
    <li>Rememberable: manages generating and clearing a token for remembering the user from a saved cookie.</li>
    <li>Trackable: tracks sign in count, timestamps and IP address.</li>
    <li>Timeoutable: expires sessions that have no activity in a specified period of time.</li>
    <li>Validatable: provides validations of email and password. It’s optional and can be customized, so you’re able to define your own validations.</li>
    <li>Lockable: locks an account after a specified number of failed sign-in attempts. Can unlock via email or after a specified time period.</li>
    <li>Encryptable: adds support of other authentication mechanisms besides the built-in Bcrypt (the default).</li>
</ul>
<h2>Information</h2>
<h3>The Devise wiki</h3>
The Devise Wiki has lots of additional information about Devise including many “how-to” articles and answers to the most frequently asked questions. Please browse the Wiki after finishing this README:

<a href="https://wiki.github.com/plataformatec/devise">wiki.github.com/plataformatec/devise</a>
<h3>Bug reports</h3>
If you discover a problem with Devise, we would like to know about it. However, we ask that you please review these guidelines before submitting a bug report:

<a href="https://github.com/plataformatec/devise/wiki/Bug-reports">github.com/plataformatec/devise/wiki/Bug-reports</a>

If you found a security bug, do <strong>NOT</strong> use the GitHub issue tracker. Send email or a private GitHub message to the maintainers listed at the bottom of the README.
<h3>Mailing list</h3>
If you have any questions, comments, or concerns, please use the Google Group instead of the GitHub issue tracker:

<a href="https://groups.google.com/group/plataformatec-devise">groups.google.com/group/plataformatec-devise</a>
<h3>RDocs</h3>
You can view the Devise documentation in RDoc format here:

<a href="http://rubydoc.info/github/plataformatec/devise/master/frames">rubydoc.info/github/plataformatec/devise/master/frames</a>

If you need to use Devise with Rails 2.3, you can always run `gem server` from the command line after you install the gem to access the old documentation.
<h3>Example applications</h3>
There are a few example applications available on GitHub that demonstrate various features of Devise with different versions of Rails. You can view them here:

<a href="https://github.com/plataformatec/devise/wiki/Example-Applications">github.com/plataformatec/devise/wiki/Example-Applications</a>
<h3>Extensions</h3>
Our community has created a number of extensions that add functionality above and beyond what is included with Devise. You can view a list of available extensions and add your own here:

<a href="https://github.com/plataformatec/devise/wiki/Extensions">github.com/plataformatec/devise/wiki/Extensions</a>
<h3>Contributing</h3>
We hope that you will consider contributing to Devise. Please read this short overview for some information about how to get started:

<a href="https://github.com/plataformatec/devise/wiki/Contributing">github.com/plataformatec/devise/wiki/Contributing</a>

You will usually want to write tests for your changes. To run the test suite, `cd` into Devise’s top-level directory and run `bundle install` and `rake`. For the tests to pass, you will need to have a MongoDB server (version 2.0 or newer) running on your system.
<h2>Installation</h2>
You can use the latest Rails 3 gem with the latest Devise gem:
<pre>gem install devise</pre>
After you install Devise and add it to your Gemfile, you need to run the generator:
<pre>rails generate devise:install</pre>
The generator will install an initializer which describes ALL Devise’s configuration options and you MUST take a look at it. When you are done, you are ready to add Devise to any of your models using the generator:
<pre>rails generate devise MODEL</pre>
Replace MODEL by the class name used for the applications users, it’s frequently ‘User’ but could also be ‘Admin’. This will create a model (if one does not exist) and configure it with default Devise modules. Next, you’ll usually run db:migrate as the generator will have created a migration file (if your ORM supports them). This generator also configures your config/routes.rb file, continue reading this file to understand exactly what the generator produces and how to use it. Finally, if your server was already running, then restart it as Rails doesn’t automatically load methods from a new gem.

Support for Rails 2.3.x can be found by installing Devise 1.0.x from the v1.0 branch.
<h2>Starting with Rails?</h2>
If you are building your first Rails application, we recommend you to <strong>not</strong> use Devise. Devise requires a good understanding of the Rails Framework. In such cases, we advise you to start a simple authentication system from scratch, today we have two resources:
<ul>
    <li>Michael Hartl’s online book: <a href="http://railstutorial.org/chapters/modeling-and-viewing-users-two#top">railstutorial.org/chapters/modeling-and-viewing-users-two#top</a></li>
    <li>Ryan Bates’ Railscast: <a href="http://railscasts.com/episodes/250-authentication-from-scratch">railscasts.com/episodes/250-authentication-from-scratch</a></li>
</ul>
Once you have solidified your understanding of Rails and authentication mechanisms, we assure you Devise will be very pleasant to work with. :)
<h2>Getting started</h2>
This is a walkthrough with all steps you need to setup a devise resource, including model, migration, route files, and optional configuration.

Devise must be set up within the model (or models) you want to use. Devise routes must be created inside your config/routes.rb file.

We’re assuming here you want a User model with some Devise modules, as outlined below:
<pre>class User &lt; ActiveRecord::Base
  devise :database_authenticatable, :registerable, :confirmable, :recoverable, :rememberable, :trackable, :validatable
end</pre>
After you choose which modules to use, you need to set up your migrations. Luckily, Devise has some helpers to save you from this boring work:
<pre>create_table :users do |t|
  t.database_authenticatable
  t.confirmable
  t.recoverable
  t.rememberable
  t.trackable
  t.timestamps
end</pre>
Devise doesn’t use <em>attr_accessible</em> or <em>attr_protected</em> inside its modules, so be sure to define attributes as accessible or protected in your model.

Configure your routes after setting up your model. Open your config/routes.rb file and add:
<pre>devise_for :users</pre>
This will use your User model to create a set of needed routes (you can see them by running `rake routes`). If you invoked the devise generator, you noticed that this is exactly what the generator produces for us: model, routes and migrations.

Don’t forget to run rake db:migrate and you are ready to go! But don’t stop reading here, we still have a lot to tell you.
<h3>Controller filters and helpers</h3>
Devise will create some helpers to use inside your controllers and views. To set up a controller with user authentication, just add this before_filter:
<pre>before_filter :authenticate_user!</pre>
To verify if a user is signed in, use the following helper:
<pre>user_signed_in?</pre>
For the current signed-in user, this helper is available:
<pre>current_user</pre>
You can access the session for this scope:
<pre>user_session</pre>
After signing in a user, confirming the account or updating the password, Devise will look for a scoped root path to redirect. Example: For a :user resource, it will use user_root_path if it exists, otherwise default root_path will be used. This means that you need to set the root inside your routes:
<pre>root :to =&gt; "home#index"</pre>
You can also overwrite after_sign_in_path_for and after_sign_out_path_for to customize your redirect hooks.

Finally, you need to set up default url options for the mailer in each environment. Here is the configuration for config/environments/development.rb:
<pre>config.action_mailer.default_url_options = { :host =&gt; 'localhost:3000' }</pre>
Notice that if your devise model is not called “user” but “member”, then the helpers you should use are:
<pre>before_filter :authenticate_member!

member_signed_in?

current_member

member_session</pre>
<h3>Configuring Models</h3>
The devise method in your models also accepts some options to configure its modules. For example, you can choose which encryptor to use in database_authenticatable:
<pre>devise :database_authenticatable, :registerable, :confirmable, :recoverable, :stretches =&gt; 20</pre>
Besides :stretches, you can define :pepper, :encryptor, :confirm_within, :remember_for, :timeout_in, :unlock_in and other values. For details, see the initializer file that was created when you invoked the “devise:install” generator described above.
<h3>Configuring multiple models</h3>
Devise allows you to set up as many roles as you want. For example, you may have a User model and also want an Admin model with just authentication, trackable, lockable and timeoutable features and no confirmation or password-recovery features. Just follow these steps:
<pre># Create a migration with the required fields
create_table :admins do |t|
  t.database_authenticatable
  t.lockable
  t.trackable
  t.timestamps
end

# Inside your Admin model
devise :database_authenticatable, :trackable, :timeoutable, :lockable

# Inside your routes
devise_for :admins

# Inside your protected controller
before_filter :authenticate_admin!

# Inside your controllers and views
admin_signed_in?
current_admin
admin_session</pre>
<h3>Configuring views</h3>
We built Devise to help you quickly develop an application that uses authentication. However, we don’t want to be in your way when you need to customize it.

Since Devise is an engine, all its views are packaged inside the gem. These views will help you get started, but after sometime you may want to change them. If this is the case, you just need to invoke the following generator, and it will copy all views to your application:
<pre>rails generate devise:views</pre>
If you have more than one role in your application (such as “User” and “Admin”), you will notice that Devise uses the same views for all roles. Fortunately, Devise offers an easy way to customize views. All you need to do is set “config.scoped_views = true” inside “config/initializers/devise.rb”.

After doing so, you will be able to have views based on the role like “users/sessions/new” and “admins/sessions/new”. If no view is found within the scope, Devise will use the default view at “devise/sessions/new”. You can also use the generator to generate scoped views:
<pre>rails generate devise:views users</pre>
<h3>Configuring controllers</h3>
If the customization at the views level is not enough, you can customize each controller by following these steps:

1) Create your custom controller, for example a Admins::SessionsController:
<pre>class Admins::SessionsController &lt; Devise::SessionsController
end</pre>
2) Tell the router to use this controller:
<pre>devise_for :admins, :controllers =&gt; { :sessions =&gt; "admins/sessions" }</pre>
3) And since we changed the controller, it won’t use the “devise/sessions” views, so remember to copy “devise/sessions” to “admin/sessions”.

Remember that Devise uses flash messages to let users know if sign in was successful or failed. Devise expects your application to call “flash[:notice]” and “flash[:alert]” as appropriate.
<h3>Configuring routes</h3>
Devise also ships with default routes. If you need to customize them, you should probably be able to do it through the devise_for method. It accepts several options like :class_name, :path_prefix and so on, including the possibility to change path names for I18n:
<pre>devise_for :users, :path =&gt; "usuarios", :path_names =&gt; { :sign_in =&gt; 'login', :sign_out =&gt; 'logout', :password =&gt; 'secret', :confirmation =&gt; 'verification', :unlock =&gt; 'unblock', :registration =&gt; 'register', :sign_up =&gt; 'cmon_let_me_in' }</pre>
Be sure to check devise_for documentation for details.

If you have the need for more deep customization, for instance to also allow “/sign_in” besides “/users/sign_in”, all you need to do is to create your routes normally and wrap them in a <tt>devise_scope</tt> block in the router:
<pre>devise_scope :user do
  get "sign_in", :to =&gt; "devise/sessions#new"
end</pre>
This way you tell devise to use the scope :user when “/sign_in” is accessed. Notice <tt>devise_scope</tt> is also aliased as <tt>as</tt> and you can also give a block to <tt>devise_for</tt>, resulting in the same behavior:
<pre>devise_for :users do
  get "sign_in", :to =&gt; "devise/sessions#new"
end</pre>
Feel free to choose the one you prefer!
<h3>I18n</h3>
Devise uses flash messages with I18n with the flash keys :notice and :alert. To customize your app, you can set up your locale file:
<pre>en:
  devise:
    sessions:
      signed_in: 'Signed in successfully.'</pre>
You can also create distinct messages based on the resource you’ve configured using the singular name given in routes:
<pre>en:
  devise:
    sessions:
      user:
        signed_in: 'Welcome user, you are signed in.'
      admin:
        signed_in: 'Hello admin!'</pre>
The Devise mailer uses a similar pattern to create subject messages:
<pre>en:
  devise:
    mailer:
      confirmation_instructions:
        subject: 'Hello everybody!'
        user_subject: 'Hello User! Please confirm your email'
      reset_password_instructions:
        subject: 'Reset instructions'</pre>
Take a look at our locale file to check all available messages. You may also be interested in one of the many translations that are available on our wiki:

<a href="https://github.com/plataformatec/devise/wiki/I18n">github.com/plataformatec/devise/wiki/I18n</a>
<h3>Test helpers</h3>
Devise includes some tests helpers for functional specs. To use them, you just need to include Devise::TestHelpers in your test class and use the sign_in and sign_out method. Such methods have the same signature as in controllers:
<pre>sign_in :user, @user   # sign_in(scope, resource)
sign_in @user          # sign_in(resource)

sign_out :user         # sign_out(scope)
sign_out @user         # sign_out(resource)</pre>
You can include the Devise Test Helpers in all of your tests by adding the following to the bottom of your test/test_helper.rb file:
<pre>class ActionController::TestCase
  include Devise::TestHelpers
end</pre>
If you’re using RSpec and want the helpers automatically included within all <tt>describe</tt> blocks, add a file called spec/support/devise.rb with the following contents:
<pre>RSpec.configure do |config|
  config.include Devise::TestHelpers, :type =&gt; :controller
end</pre>
Do not use such helpers for integration tests such as Cucumber or Webrat. Instead, fill in the form or explicitly set the user in session. For more tips, check the wiki (<a href="https://wiki.github.com/plataformatec/devise">wiki.github.com/plataformatec/devise</a>).
<h3>Omniauth</h3>
Devise comes with Omniauth support out of the box to authenticate from other providers. You can read more about Omniauth support in the wiki:
<ul>
    <li><a href="https://github.com/plataformatec/devise/wiki/OmniAuth:-Overview">github.com/plataformatec/devise/wiki/OmniAuth:-Overview</a></li>
</ul>
<h3>Other ORMs</h3>
Devise supports ActiveRecord (default) and Mongoid. To choose other ORM, you just need to require it in the initializer file.
<h3>Migrating from other solutions</h3>
Devise implements encryption strategies for Clearance, Authlogic and Restful-Authentication. To make use of these strategies, you need set the desired encryptor in the encryptor initializer config option and add :encryptable to your model. You might also need to rename your encrypted password and salt columns to match Devise’s fields (encrypted_password and password_salt).
<h2>Troubleshooting</h2>
<h3>Heroku</h3>
Using devise on Heroku with Ruby on Rails 3.1 requires setting:
<pre>config.assets.initialize_on_precompile = false</pre>
Read more about the potential issues at <a href="http://guides.rubyonrails.org/asset_pipeline.html">guides.rubyonrails.org/asset_pipeline.html</a>
<h2>Additional information</h2>
<h3>Warden</h3>
Devise is based on Warden, which is a general Rack authentication framework created by Daniel Neighman. We encourage you to read more about Warden here:

<a href="https://github.com/hassox/warden">github.com/hassox/warden</a>
<h3>Contributors</h3>
We have a long list of valued contributors. Check them all at:

<a href="https://github.com/plataformatec/devise/contributors">github.com/plataformatec/devise/contributors</a>
<h3>Maintainers</h3>
<ul>
    <li>José Valim (<a href="https://github.com/josevalim">github.com/josevalim</a>)</li>
    <li>Carlos Antônio da Silva (<a href="https://github.com/carlosantoniodasilva">github.com/carlosantoniodasilva</a>)</li>
    <li>Rodrigo Flores (<a href="https://github.com/rodrigoflores">github.com/rodrigoflores</a>)</li>
</ul>
<h2>License</h2>
MIT License. Copyright 2011 Plataforma Tecnologia. <a href="http://blog.plataformatec.com.br/">blog.plataformatec.com.br</a>

</div>
</div>


<div>标签： <a href="http://jhjguxin.hwcrazy.com/tag/devise/">devise</a> <a href="http://jhjguxin.hwcrazy.com/tag/gem/">gem</a> <a href="http://jhjguxin.hwcrazy.com/tag/rails/">rails</a> <a href="http://jhjguxin.hwcrazy.com/tag/ruby/">ruby</a></div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/12/30/ruby-on-rails-3-dot-1-release-notes/">Ruby on Rails 3.1 Release Notes</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-12-30T19:12:00+08:00" pubdate data-updated="true">Dec 30<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Ruby on Rails 3.1 Release Notes</h2>

<h2>Ruby on Rails 3.1 Release Notes</h2>


<p>Highlights in Rails 3.1:</p>

<p>Rails<span style="font-family: DejaVu Sans;">中的亮点：</span></p>

<ul>
    <li>Streaming <span style="font-family: DejaVu Sans;"><span style="font-family: Liberation Serif,Times New Roman,serif;">流</span></span></li>
    <li>Reversible Migrations <span style="font-family: DejaVu Sans;"><span style="font-family: Liberation Serif,Times New Roman,serif;">可逆（数据）迁移</span></span></li>
    <li>Assets Pipeline Assets<span style="font-family: DejaVu Sans;">管道</span></li>
    <li>jQuery as the default JavaScript library <span style="font-family: DejaVu Sans;"><span style="font-family: Liberation Serif,Times New Roman,serif;">以</span></span>jQuery<span style="font-family: DejaVu Sans;"><span style="font-family: Liberation Serif,Times New Roman,serif;">作为默认的 </span></span>JavaScript library</li>
</ul>


<p>This release notes cover the major changes, but don’t include every little bug fix and change. If you want to see everything, check out the <a href="https://github.com/rails/rails/commits/master"><span style="color: #000080;"><span style="text-decoration: underline;">list</span></span><span style="color: #000080;"><span style="text-decoration: underline;">of</span></span><span style="color: #000080;"><span style="text-decoration: underline;">commits</span></span></a> in the main Rails repository on GitHub.</p>

<p><span style="font-family: DejaVu Sans;">这次发行</span>notes<span style="font-family: DejaVu Sans;">涵盖了主要的</span>changes<span style="font-family: DejaVu Sans;">，但是没有包含每个很</span>little<span style="font-family: DejaVu Sans;">的</span>bug<span style="font-family: DejaVu Sans;">修复和</span>chage<span style="font-family: DejaVu Sans;">。如果你希望看到所有的事情，检查</span>Rails <span style="font-family: DejaVu Sans;">的</span>GitHub<span style="font-family: DejaVu Sans;">主代码仓库中的</span><a href="https://github.com/rails/rails/commits/master"><span style="color: #000080;"><span style="text-decoration: underline;">list</span></span><span style="color: #000080;"><span style="text-decoration: underline;">of</span></span><span style="color: #000080;"><span style="text-decoration: underline;">commits</span></span></a><span style="font-family: DejaVu Sans;">。</span></p>

<h3><a name="upgrading-to-rails-3-1"></a>1 Upgrading to Rails 3.1<span style="font-family: WenQuanYi Micro Hei;">升级到</span>Rails 3.1</h3>


<p>If you’re upgrading an existing application, it’s a great idea to have good test coverage before going in. You should also first upgrade to Rails 3 in case you haven’t and make sure your application still runs as expected before attempting to update to Rails 3.1. Then take heed of the following changes:</p>

<p><span style="font-family: DejaVu Sans;">如果你打算升级一个存在的应用程序，在开始进入升级的时候有一个很好的测试覆盖是一个好主意。你还应该首先升级到</span>Rails 3<span style="font-family: DejaVu Sans;">以防止你并没有确保你的应用程序在企图升级到</span>Rails 3.1<span style="font-family: DejaVu Sans;">之前能够预计到升级后仍然能够运行。然后留意随后（介绍）的</span>changes<span style="font-family: DejaVu Sans;">：</span></p>

<h4><a name="rails-3-1-requires-at-least-ruby-1-8-7"></a> 1.1 Rails 3.1 requires at least Ruby 1.8.7</h4>


<p>Rails 3.1 requires Ruby 1.8.7 or higher. Support for all of the previous Ruby versions has been dropped officially and you should upgrade as early as possible. Rails 3.1 is also compatible with Ruby 1.9.2.</p>

<p>Rails 3.1<span style="font-family: DejaVu Sans;">需要至少</span>Ruby 1.8.7<span style="font-family: DejaVu Sans;">或者更高。曾经支持的所有的早先的</span>Ruby<span style="font-family: DejaVu Sans;">版本被正式取消，你需要尽快升级。</span>Rails 3.1<span style="font-family: DejaVu Sans;">同时也与</span>Ruby 1.9.2<span style="font-family: DejaVu Sans;">兼容。</span></p>

<p>Note that Ruby 1.8.7 p248 and p249 have marshaling bugs that crash Rails. Ruby Enterprise Edition have these fixed since release 1.8.7-2010.02 though. On the 1.9 front, Ruby 1.9.1 is not usable because it outright segfaults, so if you want to use 1.9.x jump on 1.9.2 for smooth sailing.</p>

<p><span style="font-family: DejaVu Sans;">注意</span>Ruby 1.8.7 p248<span style="font-family: DejaVu Sans;">和</span>p249<span style="font-family: DejaVu Sans;">有</span>marshaling bugs<span style="font-family: DejaVu Sans;">其与</span>Rails<span style="font-family: DejaVu Sans;">冲突。</span>Ruby<span style="font-family: DejaVu Sans;">企业版自</span>1.8.7-2010.02 <span style="font-family: DejaVu Sans;">发行版已经修复了这些</span>bug<span style="font-family: DejaVu Sans;">。在以</span>1.9<span style="font-family: DejaVu Sans;">开头的</span>ruby<span style="font-family: DejaVu Sans;">，</span>Ruby 1.9.1<span style="font-family: DejaVu Sans;">是不可用的因为</span>it outright segfaults<span style="font-family: DejaVu Sans;">，因此如果你想使用</span>1.9.x<span style="font-family: DejaVu Sans;">可以平稳的跳至</span>1.9.2</p>

<h3><a name="creating-a-rails-3-1-application"></a>2 Creating a Rails 3.1 application</h3>


<h1>You should have the &lsquo;rails&rsquo; rubygem installed</h1>

<p>$ rails new myapp</p>

<p>$ cd myapp</p>

<h4><a name="vendoring-gems"></a>2.1 Vendoring Gems</h4>


<p>Rails now uses a <tt>Gemfile</tt> in the application root to determine the gems you require for your application to start. This <tt>Gemfile</tt> is processed by the <span style="color: #000080;"><span style="text-decoration: underline;"><a href="https://github.com/carlhuda/bundler">Bundler</a></span></span> gem, which then installs all your dependencies. It can even install all the dependencies locally to your application so that it doesn’t depend on the system gems.</p>

<p>Rails<span style="font-family: DejaVu Sans;">现在使用一个位于应用程序根目录的</span>Gemfile<span style="font-family: DejaVu Sans;">文件来决定使你开始你的应用程序的</span>require<span style="font-family: DejaVu Sans;">。这个</span>Gemfile<span style="font-family: DejaVu Sans;">文件被</span>Bundler gem<span style="font-family: DejaVu Sans;">加工生成，它会随后安装你所有的依赖。它甚至可以以你的应用程序为</span>locally<span style="font-family: DejaVu Sans;">安装依赖，使得你的应用程序不用依赖系统</span>gems<span style="font-family: DejaVu Sans;">。</span></p>

<p>&nbsp;</p>

<table width="665" cellspacing="0" cellpadding="2"><colgroup><col width="74" /> <col width="583" /> </colgroup>
<tbody>
<tr>
<td width="74">vendor/</td>
<td width="583">A place for all third-party code. In a typical Rails application, this includes Ruby Gems, the Rails source code (if you install it into your project) and plugins containing additional prepackaged functionality.<span style="font-family: DejaVu Sans;">放置第三方代码的地方。在一个典型的</span>Rails<span style="font-family: DejaVu Sans;">应用程序中，这里包含</span>Ruby Gems<span style="font-family: DejaVu Sans;">，</span>Rails<span style="font-family: DejaVu Sans;">源代码（如果你把</span>Rails<span style="font-family: DejaVu Sans;">安装到你的项目中）还包含一些预先包装好的额外的插件</span></td>
</tr>
</tbody>
</table>


<p>More information: – <a href="http://gembundler.com/"><span style="color: #000080;"><span style="text-decoration: underline;">bundler</span></span><span style="color: #000080;"><span style="text-decoration: underline;">homepage</span></span></a></p>

<h4><a name="living-on-the-edge"></a>2.2 Living on the Edge</h4>


<p><tt>Bundler</tt> and <tt>Gemfile</tt> makes freezing your Rails application easy as pie with the new dedicated <tt>bundle</tt> command. If you want to bundle straight from the Git repository, you can pass the <tt>&mdash;edge</tt> flag:</p>

<p>Bundler<span style="font-family: DejaVu Sans;">和</span>Gemfile<span style="font-family: DejaVu Sans;">通过新的专用</span>bundle <span style="font-family: DejaVu Sans;">命令来冻结你的应用程序就像吃馅饼一样简单。如果你想直接从</span>Git<span style="font-family: DejaVu Sans;">仓库</span>bundle<span style="font-family: DejaVu Sans;">，你可以通过<span style="font-family: Liberation Serif,Times New Roman,serif;">—</span></span>edge flag<span style="font-family: DejaVu Sans;">：</span></p>

<p>$ rails new myapp &mdash;edge</p>

<p>If you have a local checkout of the Rails repository and want to generate an application using that, you can pass the <tt>&mdash;dev</tt> flag:</p>

<p><span style="font-family: DejaVu Sans;">如果你有一个从</span>Rails<span style="font-family: DejaVu Sans;">源代码仓库</span>checkout<span style="font-family: DejaVu Sans;">的本地</span>Rails<span style="font-family: DejaVu Sans;">并且你想生成一个应用程序使用（上面的方法）你可以通过<span style="font-family: Liberation Serif,Times New Roman,serif;">—</span></span>dev <span style="font-family: DejaVu Sans;">标志：</span></p>

<p>$ ruby /path/to/rails/bin/rails new myapp &mdash;dev</p>

<h3><a name="rails-architectural-changes"></a>3 Rails Architectural<span style="font-family: WenQuanYi Micro Hei;">建筑的</span>Changes</h3>


<h4><a name="assets-pipeline"></a>3.1 Assets Pipeline</h4>


<p>The major change in Rails 3.1 is the Assets Pipeline. It makes CSS and JavaScript first-class code citizens and enables proper organization, including use in plugins and engines.</p>

<p><span style="font-family: DejaVu Sans;">在</span>Rails 3.1<span style="font-family: DejaVu Sans;">中主要的更改就是</span>Assets Pipeline<span style="font-family: DejaVu Sans;">（管道）。它使得</span>CSS<span style="font-family: DejaVu Sans;">和</span>JavaScript <span style="font-family: DejaVu Sans;">一流的代码公民可以合适的组织他们，包含使用</span>pluginis<span style="font-family: DejaVu Sans;">和</span>engines<span style="font-family: DejaVu Sans;">。</span></p>

<p>The assets pipeline is powered by <span style="color: #000080;"><span style="text-decoration: underline;"><a href="https://github.com/sstephenson/sprockets">Sprockets</a></span></span> and is covered in the <a href="http://guides.rubyonrails.org/asset_pipeline.html"><span style="color: #000080;"><span style="text-decoration: underline;">Asset</span></span><span style="color: #000080;"><span style="text-decoration: underline;">Pipeline</span></span></a> guide.</p>

<h4><a name="http-streaming"></a>3.2 HTTP Streaming</h4>


<p>HTTP Streaming is another change that is new in Rails 3.1. This lets the browser download your stylesheets and JavaScript files while the server is still generating the response. This requires Ruby 1.9.2, is opt-in and requires support from the web server as well, but the popular combo of nginx and unicorn is ready to take advantage of it.</p>

<p>HTTP Streaming<span style="font-family: DejaVu Sans;">是</span>Rails 3.1<span style="font-family: DejaVu Sans;">另一更改。这使得浏览器下载你的</span>stylesheets<span style="font-family: DejaVu Sans;">和</span>JavaSript<span style="font-family: DejaVu Sans;">文件即使服务器仍然在响应。这需要</span>Ruby 1.9.2<span style="font-family: DejaVu Sans;">，它是需要从服务器中选择以及服务器同样支持</span>HTTP Streaming<span style="font-family: DejaVu Sans;">，但是受欢迎的</span>nginx<span style="font-family: DejaVu Sans;">和</span>unicom<span style="font-family: DejaVu Sans;">组织已经准备</span>advantage HTTP Streaming<span style="font-family: DejaVu Sans;">。</span></p>

<h4><a name="default-js-library-is-now-jquery"></a>3.3 Default JS library is now jQuery</h4>


<p>jQuery is the default JavaScript library that ships with Rails 3.1. But if you use Prototype, it’s simple to switch.</p>

<p>Jquey<span style="font-family: DejaVu Sans;">是默认的</span>JavaScript library<span style="font-family: DejaVu Sans;">搭载在</span>Rrails 3.1.<span style="font-family: DejaVu Sans;">但是如果你使用</span>Prototype<span style="font-family: DejaVu Sans;">，它更改很简单。</span></p>

<p>$ rails new myapp -j prototype</p>

<h4><a name="identity-map"></a>3.4 Identity Map <span style="font-family: WenQuanYi Micro Hei;">身份</span>map</h4>


<p>Active Record has an Identity Map in Rails 3.1. An identity map keeps previously instantiated records and returns the object associated with the record if accessed again. The identity map is created on a per-request basis and is flushed at request completion.</p>

<p>Rails 3.1<span style="font-family: DejaVu Sans;">的</span>Active Record<span style="font-family: DejaVu Sans;">有一个</span>Indentity Map<span style="font-family: DejaVu Sans;">。一个</span>identity map<span style="font-family: DejaVu Sans;">保留先前的实例化的记录并且如果再次访问返回记录的对象的关系。</span>Indentity map<span style="font-family: DejaVu Sans;">是基于每个请求创建的并且在请求完成刷新。</span></p>

<p>Rails 3.1 comes with the identity map turned off by default.</p>

<p>Rails 3.1<span style="font-family: DejaVu Sans;">默认</span>Identity map<span style="font-family: DejaVu Sans;">是关闭的。</span></p>

<h3><a name="railties"></a>4 Railties</h3>


<ul>
    <li><a name="railties1"></a>jQuery is the new default JavaScript library.</li>
</ul>


<p>Jquey<span style="font-family: DejaVu Sans;">是新的默认的</span>JavaScript library<span style="font-family: DejaVu Sans;">。</span></p>

<ul>
    <li>jQuery and Prototype are no longer vendored and is provided from now on by the jquery-rails and prototype-rails gems.</li>
</ul>


<p>jQuey<span style="font-family: DejaVu Sans;">和</span>Prototype<span style="font-family: DejaVu Sans;">不再</span>vendored<span style="font-family: DejaVu Sans;">并且从现在开始提供的是</span>jquery-rails and prototype-rails gems<span style="font-family: DejaVu Sans;">。</span></p>

<ul>
    <li>The application generator accepts an option <tt>-j</tt> which can be an arbitrary string. If passed “foo”, the gem “foo-rails” is added to the <tt>Gemfile</tt>, and the application JavaScript manifest requires “foo” and “foo_ujs”. Currently only “prototype-rails” and “jquery-rails” exist and provide those files via the asset pipeline.</li>
</ul>


<p><span style="font-family: DejaVu Sans;">应用程序创建器接受一个选项</span>-j<span style="font-family: DejaVu Sans;">其可以是任意字符串。如果传递<span style="font-family: Liberation Serif,Times New Roman,serif;">“</span></span>foo”<span style="font-family: DejaVu Sans;">，</span>gem “foo-rails”<span style="font-family: DejaVu Sans;">就被添加到</span>Gemfile<span style="font-family: DejaVu Sans;">，并且应用程序的</span>JavaScript manifest requires “foo” and “foo_ujs”<span style="font-family: DejaVu Sans;">。当前只有<span style="font-family: Liberation Serif,Times New Roman,serif;"> “</span></span>prototype-rails” and “jquery-rails”<span style="font-family: DejaVu Sans;">存在并且通过</span>asset pipeline<span style="font-family: DejaVu Sans;">提供这些文件。</span></p>

<ul>
    <li>Generating an application or a plugin runs <tt>bundle</tt><tt> </tt><tt>install</tt> unless <tt>&#8211;skip-gemfile</tt> or <tt>&#8211;skip-bundle</tt> is specified.</li>
</ul>


<p><span style="font-family: DejaVu Sans;">生成一个应用程序或者一个</span>plugin<span style="font-family: DejaVu Sans;">运行</span>bundle install<span style="font-family: DejaVu Sans;">除非</span>&mdash;skip-gemfile<span style="font-family: DejaVu Sans;">或者</span>&mdash;skip-bundle<span style="font-family: DejaVu Sans;">被指定</span></p>

<ul>
    <li>The controller and resource generators will now automatically produce asset stubs (this can be turned off with <tt>&#8211;skip-assets</tt>). These stubs will use CoffeeScript and Sass, if those libraries are available.</li>
</ul>


<p>Controller<span style="font-family: DejaVu Sans;">和</span>resource<span style="font-family: DejaVu Sans;">创建器将会自动的产生</span>asset stubs(this can be turned off with <tt>&mdash;skip-assets</tt>)<span style="font-family: DejaVu Sans;">。这些</span>stub<span style="font-family: DejaVu Sans;">将会使用</span>CoffeeScript and Sass<span style="font-family: DejaVu Sans;">，如果这些</span>libraries<span style="font-family: DejaVu Sans;">是可用的。</span></p>

<ul>
    <li>Scaffold and app generators use the Ruby 1.9 style hash when running on Ruby 1.9. To generate old style hash, <tt>&#8211;old-style-hash</tt> can be passed.</li>
</ul>


<ul>
    <li>Scaffold controller generator creates format block for JSON instead of XML.</li>
</ul>


<ul>
    <li>Active Record logging is directed to STDOUT and shown inline in the console.</li>
</ul>


<ul>
    <li>Added <tt>config.force_ssl</tt> configuration which loads <tt>Rack::SSL</tt> middleware and force all requests to be under HTTPS protocol.</li>
</ul>


<ul>
    <li>Added <tt>rails</tt><tt> </tt><tt>plugin</tt><tt> </tt><tt>new</tt> command which generates a Rails plugin with gemspec, tests and a dummy application for testing.</li>
</ul>


<ul>
    <li>Added <tt>Rack::Etag</tt> and <tt>Rack::ConditionalGet</tt> to the default middleware stack.</li>
</ul>


<ul>
    <li>Added <tt>Rack::Cache</tt> to the default middleware stack.</li>
</ul>


<ul>
    <li>Engines received a major update – You can mount them at any path, enable assets, run generators etc.</li>
</ul>


<h3><a name="action-pack"></a>5 Action Pack</h3>


<h4><a name="action-controller"></a>5.1 Action Controller</h4>


<ul>
    <li>A warning is given out if the CSRF token authenticity cannot be verified.</li>
</ul>


<ul>
    <li>Specify <tt>force_ssl</tt> in a controller to force the browser to transfer data via HTTPS protocol on that particular controller. To limit to specific actions, <tt>:only</tt> or <tt>:except</tt> can be used.</li>
</ul>


<ul>
    <li>Sensitive query string parameters specified in <tt>config.filter_parameters</tt> will now be filtered out from the request paths in the log.</li>
</ul>


<ul>
    <li>URL parameters which return <tt>nil</tt> for <tt>to_param</tt> are now removed from the query string.</li>
</ul>


<ul>
    <li>Added <tt>ActionController::ParamsWrapper</tt> to wrap parameters into a nested hash, and will be turned on for JSON request in new applications by default. This can be customized in <tt>config/initializers/wrap_parameters.rb</tt>.</li>
</ul>


<ul>
    <li>Added <tt>config.action_controller.include_all_helpers</tt>. By default <tt>helper</tt><tt> </tt><tt>:all</tt> is done in <tt>ActionController::Base</tt>, which includes all the helpers by default. Setting <tt>include_all_helpers</tt> to <tt>false</tt> will result in including only application_helper and the helper corresponding to controller (like foo_helper for foo_controller).</li>
</ul>


<ul>
    <li><tt>url_for</tt> and named url helpers now accept <tt>:subdomain</tt> and <tt>:domain</tt> as options.</li>
</ul>


<ul>
    <li>Added <tt>Base.http_basic_authenticate_with</tt> to do simple http basic authentication with a single class method call.</li>
</ul>


<p>class PostsController &lt; ApplicationController</p>

<p>USER_NAME, PASSWORD = &ldquo;dhh&rdquo;, &ldquo;secret&rdquo;</p>

<p>&nbsp;</p>

<p>before_filter :authenticate, :except =&gt; [ :index ]</p>

<p>&nbsp;</p>

<p>def index</p>

<p>render :text =&gt; &ldquo;Everyone can see me!&rdquo;</p>

<p>end</p>

<p>&nbsp;</p>

<p>def edit</p>

<p>render :text =&gt; &ldquo;I&rsquo;m only accessible if you know the password&rdquo;</p>

<p>end</p>

<p>&nbsp;</p>

<p>private</p>

<p>def authenticate</p>

<p>authenticate_or_request_with_http_basic do |user_name, password|</p>

<p>user_name == USER_NAME &amp;&amp; password == PASSWORD</p>

<p>end</p>

<p>end</p>

<p>end</p>

<p>..can now be written as</p>

<p>class PostsController &lt; ApplicationController</p>

<p>http_basic_authenticate_with :name =&gt; &ldquo;dhh&rdquo;, :password =&gt; &ldquo;secret&rdquo;, :except =&gt; :index</p>

<p>&nbsp;</p>

<p>def index</p>

<p>render :text =&gt; &ldquo;Everyone can see me!&rdquo;</p>

<p>end</p>

<p>&nbsp;</p>

<p>def edit</p>

<p>render :text =&gt; &ldquo;I&rsquo;m only accessible if you know the password&rdquo;</p>

<p>end</p>

<p>end</p>

<p>Added streaming support, you can enable it with:</p>

<p>class PostsController &lt; ActionController::Base</p>

<p>stream</p>

<p>end</p>

<p>You can restrict<span style="font-family: DejaVu Sans;">限制</span>it to some actions by using <tt>:only</tt> or <tt>:except</tt>. Please read the docs at <span style="color: #000080;"><span style="text-decoration: underline;"><a href="http://api.rubyonrails.org/classes/ActionController/Streaming.html">ActionController::Streaming</a></span></span> for more information.</p>

<ul>
    <li>The redirect route method now also accepts a hash of options which will only change the parts of the url in question, or an object which responds to call, allowing for redirects to be reused.</li>
</ul>


<h4><a name="action-dispatch"></a>5.2 Action Dispatch</h4>


<ul>
    <li><tt>config.action_dispatch.x_sendfile_header</tt> now defaults to <tt>nil</tt> and <tt>config/environments/production.rb</tt> doesn’t set any particular value for it. This allows servers to set it through <tt>X-Sendfile-Type</tt>.</li>
</ul>


<ul>
    <li><tt>ActionDispatch::MiddlewareStack</tt> now uses composition<span style="font-family: DejaVu Sans;">组成</span>over inheritance and is no longer an array.</li>
</ul>


<ul>
    <li>Added <tt>ActionDispatch::Request.ignore_accept_header</tt> to ignore accept headers.</li>
</ul>


<ul>
    <li>Added <tt>Rack::Cache</tt> to the default stack.</li>
</ul>


<ul>
    <li>Moved etag responsibility from <tt>ActionDispatch::Response</tt> to the middleware stack.</li>
</ul>


<ul>
    <li>Rely on <tt>Rack::Session</tt> stores API for more compatibility across the Ruby world. This is backwards incompatible since <tt>Rack::Session</tt> expects <tt>#get_session</tt> to accept four arguments and requires <tt>#destroy_session</tt> instead of simply <tt>#destroy</tt>.</li>
</ul>


<ul>
    <li>Template lookup now searches further up in the inheritance chain.</li>
</ul>


<h4><a name="action-view"></a>5.3 Action View</h4>


<ul>
    <li>Added an <tt>:authenticity_token</tt> option to <tt>form_tag</tt> for custom handling or to omit the token by passing <tt>:authenticity_token</tt><tt> </tt><tt>=&gt;</tt><tt> </tt><tt>false</tt>.</li>
</ul>


<ul>
    <li>Created <tt>ActionView::Renderer</tt> and specified an API for <tt>ActionView::Context</tt>.</li>
</ul>


<ul>
    <li>In place <tt>SafeBuffer</tt> mutation is prohibited<span style="font-family: DejaVu Sans;">禁止</span>in Rails 3.1.</li>
</ul>


<ul>
    <li>Added HTML5 <tt>button_tag</tt> helper.</li>
</ul>


<ul>
    <li><tt>file_field</tt> automatically adds <tt>:multipart</tt><tt> </tt><tt>=&gt;</tt><tt> </tt><tt>true</tt> to the enclosing form.</li>
</ul>


<ul>
    <li>Added a convenience idiom to generate HTML5 data-* attributes in tag helpers from a <tt>:data</tt> hash of options:</li>
</ul>


<p>tag(&ldquo;div&rdquo;, :data =&gt; {:name =&gt; &lsquo;Stephen&rsquo;, :city_state =&gt; %w(Chicago IL)})</p>

<h1>=&gt; &lt;div data-name=&ldquo;Stephen&rdquo; data-city-state=&ldquo;[&amp;quot;Chicago&amp;quot;,&amp;quot;IL&amp;quot;]&rdquo; /&gt;</h1>

<p>Keys are dasherized. Values are JSON-encoded, except for strings and symbols.</p>

<ul>
    <li><tt>csrf_meta_tag</tt> is renamed to <tt>csrf_meta_tags</tt> and aliases <tt>csrf_meta_tag</tt> for backwards compatibility.</li>
</ul>


<ul>
    <li>The old template handler API is deprecated and the new API simply requires a template handler to respond to call.</li>
</ul>


<ul>
    <li>rhtml and rxml are finally removed as template handlers.</li>
</ul>


<ul>
    <li><tt>config.action_view.cache_template_loading</tt> is brought back which allows to decide whether templates should be cached or not.</li>
</ul>


<ul>
    <li>The submit form helper does not generate an id “object_name_id” anymore.</li>
</ul>


<ul>
    <li>Allows <tt>FormHelper#form_for</tt> to specify the <tt>:method</tt> as a direct option instead of through the <tt>:html</tt> hash. <tt>form_for(@post,</tt><tt> </tt><tt>remote:</tt><tt> </tt><tt>true,</tt><tt> </tt><tt>method:</tt><tt> </tt><tt>:delete)</tt> instead of <tt>form_for(@post,</tt><tt> </tt><tt>remote:</tt><tt> </tt><tt>true,</tt><tt> </tt><tt>html:</tt><tt> </tt><tt>{</tt><tt> </tt><tt>method:</tt><tt> </tt><tt>:delete</tt><tt> </tt><tt>})</tt>.</li>
</ul>


<ul>
    <li>Provided <tt>JavaScriptHelper#j()</tt> as an alias for <tt>JavaScriptHelper#escape_javascript()</tt>. This supersedes the <tt>Object#j()</tt> method that the JSON gem adds within templates using the JavaScriptHelper.</li>
</ul>


<ul>
    <li>Allows AM/PM format in datetime selectors.</li>
</ul>


<ul>
    <li><tt>auto_link</tt> has been removed from Rails and extracted into the <a href="https://github.com/tenderlove/rails_autolink"><span style="color: #000080;"><span style="text-decoration: underline;">rails_autolink</span></span><span style="color: #000080;"><span style="text-decoration: underline;">gem</span></span></a></li>
</ul>


<h3><a name="active-record"></a>6 Active Record</h3>


<ul>
    <li>Added a class method <tt>pluralize_table_names</tt> to singularize/pluralize<span style="font-family: DejaVu Sans;">复数</span>table names of individual models. Previously this could only be set globally for all models through <tt>ActiveRecord::Base.pluralize_table_names</tt>.</li>
</ul>


<p>class User &lt; ActiveRecord::Base</p>

<p>self.pluralize_table_names = false</p>

<p>end</p>

<ul>
    <li>Added block setting of attributes to singular associations. The block will get called after the instance is initialized</li>
</ul>


<p>class User &lt; ActiveRecord::Base</p>

<p>has_one :account</p>

<p>end</p>

<p>&nbsp;</p>

<p>user.build_account{ |a| a.credit_limit =&gt; 100.0 }</p>

<ul>
    <li><strong>Added</strong><strong> </strong><tt><strong>ActiveRecord::Base.attribute_names</strong></tt><strong> </strong><strong>to</strong><strong> </strong><strong>return</strong><strong> </strong><strong>a</strong><strong> </strong><strong>list</strong><strong> </strong><strong>of</strong><strong> </strong><strong>attribute</strong><strong> </strong><strong>names.</strong><strong> </strong><strong>This</strong><strong> </strong><strong>will</strong><strong> </strong><strong>return</strong><strong> </strong><strong>an</strong><strong> </strong><strong>empty</strong><strong> </strong><strong>array</strong><strong> </strong><strong>if</strong><strong> </strong><strong>the</strong><strong> </strong><strong>model</strong><strong> </strong><strong>is</strong><strong> </strong><strong>abstract</strong><strong> </strong><strong>or</strong><strong> </strong><strong>the</strong><strong> </strong><strong>table</strong><strong> </strong><strong>does</strong><strong> </strong><strong>not</strong><strong> </strong><strong>exist.</strong><strong> </strong></li>
</ul>


<ul>
    <li>CSV Fixtures are deprecated and support will be removed in Rails 3.2.0.</li>
</ul>


<ul>
    <li><tt>ActiveRecord#new</tt>, <tt>ActiveRecord#create</tt> and <tt>ActiveRecord#update_attributes</tt> all accept a second hash as an option that allows you to specify which role to consider when assigning attributes. This is built on top of Active Model’s new mass assignment capabilities:</li>
</ul>


<p>class Post &lt; ActiveRecord::Base</p>

<p>attr_accessible :title</p>

<p>attr_accessible :title, :published_at, :as =&gt; :admin</p>

<p>end</p>

<p>&nbsp;</p>

<p>Post.new(params[:post], :as =&gt; :admin)</p>

<ul>
    <li><tt>default_scope</tt> can now take a block, lambda, or any other object which responds to call for lazy evaluation.</li>
</ul>


<ul>
    <li>Default scopes are now evaluated at the latest possible moment, to avoid problems where scopes would be created which would implicitly contain the default scope, which would then be impossible to get rid of via Model.unscoped.</li>
</ul>


<ul>
    <li>PostgreSQL adapter only supports PostgreSQL version 8.2 and higher.</li>
</ul>


<ul>
    <li><tt>ConnectionManagement</tt> middleware is changed to clean up the connection pool after the rack body has been flushed.</li>
</ul>


<ul>
    <li>Added an <tt>update_column</tt> method on Active Record. This new method updates a given attribute on an object, skipping validations and callbacks. It is recommended to use <tt>update_attribute</tt> unless you are sure you do not want to execute any callback, including the modification of the <tt>updated_at</tt> column. It should not be called on new records.</li>
</ul>


<ul>
    <li>Associations with a <tt>:through</tt> option can now use any association as the through or source association, including other associations which have a <tt>:through</tt> option and <tt>has_and_belongs_to_many</tt> associations.</li>
</ul>


<ul>
    <li>The configuration for the current database connection is now accessible via <tt>ActiveRecord::Base.connection_config</tt>.</li>
</ul>


<ul>
    <li>limits and offsets are removed from COUNT queries unless both are supplied.</li>
</ul>


<p>People.limit(1).count # =&gt; &lsquo;SELECT COUNT(*) FROM people&rsquo;</p>

<p>People.offset(1).count # =&gt; &lsquo;SELECT COUNT(*) FROM people&rsquo;</p>

<p>People.limit(1).offset(1).count # =&gt; &lsquo;SELECT COUNT(*) FROM people LIMIT 1 OFFSET 1&rsquo;</p>

<ul>
    <li><tt>ActiveRecord::Associations::AssociationProxy</tt> has been split. There is now an <tt>Association</tt> class (and subclasses) which are responsible for operating on associations, and then a separate, thin wrapper called <tt>CollectionProxy</tt>, which proxies collection associations. This prevents namespace pollution, separates concerns, and will allow further refactorings.</li>
</ul>


<ul>
    <li>Singular associations (<tt>has_one</tt>, <tt>belongs_to</tt>) no longer have a proxy and simply returns the associated record or <tt>nil</tt>. This means that you should not use undocumented methods such as <tt>bob.mother.create</tt> – use <tt>bob.create_mother</tt> instead.</li>
</ul>


<ul>
    <li>Support the <tt>:dependent</tt> option on <tt>has_many</tt><tt> </tt><tt>:through</tt> associations. For historical and practical reasons, <tt>:delete_all</tt> is the default deletion strategy employed by <tt>association.delete(*records)</tt>, despite the fact that the default strategy is <tt>:nullify</tt> for regular has_many. Also, this only works at all if the source reflection is a belongs_to. For other situations, you should directly modify the through association.</li>
</ul>


<ul>
    <li>The behavior of <tt>association.destroy</tt> for <tt>has_and_belongs_to_many</tt> and <tt>has_many</tt><tt> </tt><tt>:through</tt> is changed. From now on, ‘destroy’ or ‘delete’ on an association will be taken to mean ‘get rid of the link’, not (necessarily) ‘get rid of the associated records’.</li>
</ul>


<ul>
    <li>Previously, <tt>has_and_belongs_to_many.destroy(*records)</tt> would destroy the records themselves. It would not delete any records in the join table. Now, it deletes the records in the join table.</li>
</ul>


<ul>
    <li>Previously, <tt>has_many_through.destroy(*records)</tt> would destroy the records themselves, and the records in the join table. [Note: This has not always been the case; previous version of Rails only deleted the records themselves.] Now, it destroys only the records in the join table.</li>
</ul>


<ul>
    <li>Note that this change is backwards-incompatible to an extent, but there is unfortunately no way to ‘deprecate’ it before changing it. The change is being made in order to have consistency as to the meaning of ‘destroy’ or ‘delete’ across the different types of associations. If you wish to destroy the records themselves, you can do <tt>records.association.each(&amp;:destroy)</tt>.</li>
</ul>


<ul>
    <li>Add <tt>:bulk</tt><tt> </tt><tt>=&gt;</tt><tt> </tt><tt>true</tt> option to <tt>change_table</tt> to make all the schema changes defined in a block using a single ALTER statement.</li>
</ul>


<p>change_table(:users, :bulk =&gt; true) do |t|</p>

<p>t.string :company_name</p>

<p>t.change :birthdate, :datetime</p>

<p>end</p>

<ul>
    <li>Removed support for accessing attributes on a <tt>has_and_belongs_to_many</tt> join table. <tt>has_many</tt><tt> </tt><tt>:through</tt> needs to be used.</li>
</ul>


<ul>
    <li>Added a <tt>create_association!</tt> method for <tt>has_one</tt> and <tt>belongs_to</tt> associations.</li>
</ul>


<ul>
    <li>Migrations are now reversible<span style="font-family: DejaVu Sans;">可逆</span>, meaning that Rails will figure out how to reverse your migrations. To use reversible migrations, just define the <tt>change</tt> method.</li>
</ul>


<p>class MyMigration &lt; ActiveRecord::Migration</p>

<p>def change</p>

<p>create_table(:horses) do</p>

<p>t.column :content, :text</p>

<p>t.column :remind_at, :datetime</p>

<p>end</p>

<p>end</p>

<p>end</p>

<ul>
    <li>Some things cannot be automatically reversed for you. If you know how to reverse those things, you should define <tt>up</tt> and <tt>down</tt> in your migration. If you define something in change that cannot be reversed, an <tt>IrreversibleMigration</tt> exception will be raised when going down.</li>
</ul>


<ul>
    <li>Migrations now use instance methods rather than class methods:</li>
</ul>


<p>class FooMigration &lt; ActiveRecord::Migration</p>

<p>def up # Not self.up</p>

<p>&hellip;</p>

<p>end</p>

<p>end</p>

<ul>
    <li>Migration files generated from model and constructive migration generators (for example, add_name_to_users) use the <strong>reversible</strong><strong> </strong><strong>migration</strong><strong>’</strong><strong>s</strong><strong> </strong><tt>change</tt> method instead of the ordinary <tt>up</tt> and <tt>down</tt> methods.</li>
</ul>


<ul>
    <li>Removed support for interpolating<span style="font-family: DejaVu Sans;">插值</span>string SQL conditions on associations. Instead, a proc should be used.</li>
</ul>


<p>has_many :things, :conditions =&gt; &lsquo;foo = #{bar}&rsquo; # before</p>

<p>has_many :things, :conditions =&gt; proc { &ldquo;foo = #{bar}&rdquo; } # after</p>

<p>&nbsp;</p>

<p>Inside the proc, <tt>self</tt> is the object which is the owner of the association, unless you are eager loading the association, in which case <tt>self</tt> is the class which the association is within.</p>

<p>You can have any “normal” conditions inside the proc, so the following will work too:</p>

<p>has_many :things, :conditions =&gt; proc { [&ldquo;foo = ?&rdquo;, bar] }</p>

<p>&nbsp;</p>

<ul>
    <li>Previously <tt>:insert_sql</tt> and <tt>:delete_sql</tt> on <tt>has_and_belongs_to_many</tt> association allowed you to call ‘record’ to get the record being inserted or deleted. This is now passed as an argument to the proc.</li>
</ul>


<ul>
    <li>Added <tt>ActiveRecord::Base#has_secure_password</tt> (via <tt>ActiveModel::SecurePassword</tt>) to encapsulate dead-simple password usage with BCrypt encryption and salting.</li>
</ul>


<h1>Schema: User(name:string, password_digest:string, password_salt:string)</h1>

<p>class User &lt; ActiveRecord::Base</p>

<p>has_secure_password</p>

<p>end</p>

<p>&nbsp;</p>

<ul>
    <li>When a model is generated <tt>add_index</tt> is added by default for <tt>belongs_to</tt> or <tt>references</tt> columns.</li>
</ul>


<ul>
    <li>Setting the id of a <tt>belongs_to</tt> object will update the reference to the object.</li>
</ul>


<ul>
    <li><tt>ActiveRecord::Base#dup</tt> and <tt>ActiveRecord::Base#clone</tt> semantics<span style="font-family: DejaVu Sans;">语义</span>have changed to closer match normal Ruby dup and clone semantics.</li>
</ul>


<ul>
    <li>Calling <tt>ActiveRecord::Base#clone</tt> will result in a shallow copy of the record, including copying the frozen state. No callbacks will be called.</li>
</ul>


<ul>
    <li>Calling <tt>ActiveRecord::Base#dup</tt> will duplicate the record, including calling after initialize hooks. Frozen state will not be copied, and all associations will be cleared. A duped record will return <tt>true</tt> for <tt>new_record?</tt>, have a <tt>nil</tt> id field, and is saveable.</li>
</ul>


<ul>
    <li>The query cache now works with prepared statements. No changes in the applications are required.</li>
</ul>


<h3><a name="active-model"></a>7 Active Model</h3>


<ul>
    <li><tt>attr_accessible</tt> accepts an option <tt>:as</tt> to specify a role.</li>
</ul>


<ul>
    <li><tt>InclusionValidator</tt>, <tt>ExclusionValidator</tt>, and <tt>FormatValidator</tt> now accepts an option which can be a proc, a lambda, or anything that respond to <tt>call</tt>. This option will be called with the current record as an argument and returns an object which respond to <tt>include?</tt> for <tt>InclusionValidator</tt> and <tt>ExclusionValidator</tt>, and returns a regular expression object for <tt>FormatValidator</tt>.</li>
</ul>


<ul>
    <li>Added <tt>ActiveModel::SecurePassword</tt> to encapsulate dead-simple password usage with BCrypt encryption and salting.</li>
</ul>


<ul>
    <li><tt>ActiveModel::AttributeMethods</tt> allows attributes to be defined on demand.</li>
</ul>


<ul>
    <li>Added support for selectively enabling and disabling observers.</li>
</ul>


<ul>
    <li>Alternate <tt>I18n</tt> namespace lookup is no longer supported.</li>
</ul>


<h3><a name="active-resource"></a>8 Active Resource</h3>


<ul>
    <li><strong>The</strong><strong> </strong><strong>default</strong><strong> </strong><strong>format</strong><strong> </strong><strong>has</strong><strong> </strong><strong>been</strong><strong> </strong><strong>changed</strong><strong> </strong><strong>to</strong><strong> </strong><strong>JSON</strong><strong> </strong><strong>for</strong><strong> </strong><strong>all</strong><strong> </strong><strong>requests</strong>. If you want to continue to use XML you will need to set <tt>self.format</tt><tt> </tt><tt>=</tt><tt> </tt><tt>:xml</tt> in the class. For example,</li>
</ul>


<p>class User &lt; ActiveResource::Base</p>

<p>self.format = :xml</p>

<p>end</p>

<h3><a name="active-support"></a>9 Active Support</h3>


<ul>
    <li><tt>ActiveSupport::Dependencies</tt> now raises <tt>NameError</tt> if it finds an existing constant in <tt>load_missing_constant</tt>.</li>
</ul>


<ul>
    <li>Added a new reporting method <tt>Kernel#quietly</tt> which silences both <tt>STDOUT</tt> and <tt>STDERR</tt>.</li>
</ul>


<ul>
    <li>Added <tt>String#inquiry</tt> as a convenience method for turning a String into a <tt>StringInquirer</tt> object.</li>
</ul>


<ul>
    <li>Added <tt>Object#in?</tt> to test if an object is included in another object.</li>
</ul>


<ul>
    <li><tt>LocalCache</tt> strategy is now a real middleware class and no longer an anonymous class.</li>
</ul>


<ul>
    <li><tt>ActiveSupport::Dependencies::ClassCache</tt> class has been introduced for holding references to reloadable classes.</li>
</ul>


<ul>
    <li><tt>ActiveSupport::Dependencies::Reference</tt> has been refactored to take direct advantage of the new <tt>ClassCache</tt>.</li>
</ul>


<ul>
    <li>Backports <tt>Range#cover?</tt> as an alias for <tt>Range#include?</tt> in Ruby 1.8.</li>
</ul>


<ul>
    <li>Added <tt>weeks_ago</tt> and <tt>prev_week</tt> to Date/DateTime/Time.</li>
</ul>


<ul>
    <li>Added <tt>before_remove_const</tt> callback to <tt>ActiveSupport::Dependencies.remove_unloadable_constants!</tt>.</li>
</ul>


<p>Deprecations:</p>

<ul>
    <li><tt>ActiveSupport::SecureRandom</tt> is deprecated in favor of <tt>SecureRandom</tt> from the Ruby standard library.</li>
</ul>


<h3><a name="credits"></a>10 Credits</h3>


<p>See the <a href="http://contributors.rubyonrails.org/"><span style="color: #000080;"><span style="text-decoration: underline;">full</span></span><span style="color: #000080;"><span style="text-decoration: underline;">list</span></span><span style="color: #000080;"><span style="text-decoration: underline;">of</span></span><span style="color: #000080;"><span style="text-decoration: underline;">contributors</span></span><span style="color: #000080;"><span style="text-decoration: underline;">to</span></span><span style="color: #000080;"><span style="text-decoration: underline;">Rails</span></span></a> for the many people who spent many hours making Rails, the stable and robust framework it is. Kudos to all of them.</p>

<p>Rails 3.1 Release Notes were compiled by <a href="https://github.com/vijaydev"><span style="color: #000080;"><span style="text-decoration: underline;">Vijay</span></span><span style="color: #000080;"><span style="text-decoration: underline;">Dev</span></span></a>.</p>

<p>标签： <a href="http://jhjguxin.hwcrazy.com/tag/gem/">gem</a> <a href="http://jhjguxin.hwcrazy.com/tag/git/">git</a> <a href="http://jhjguxin.hwcrazy.com/tag/guide/">guide</a> <a href="http://jhjguxin.hwcrazy.com/tag/jquery/">jquery</a> <a href="http://jhjguxin.hwcrazy.com/tag/learning/">learning</a> <a href="http://jhjguxin.hwcrazy.com/tag/rails/">rails</a> <a href="http://jhjguxin.hwcrazy.com/tag/release/">release</a> <a href="http://jhjguxin.hwcrazy.com/tag/ruby/">ruby</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/12/29/ban-ben-hao-the-version-number-in-baike/">版本号(the Version Number in Baike)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-12-29T10:28:00+08:00" pubdate data-updated="true">Dec 29<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>版本号(the version number in baike)</h2>

<p>版本号(version number)是版本的标识号。每一个操作系统（或广义的讲，每一个软件）都有一个版本号。版本号能使用户了解所使用的操作系统是否为最新的版本以及它所提供的功能与设施。 每一个版本号可以分为主版本号与次版本号两部分。</p>

<p>版本号的命名格式　　例如：DOS4.0，主版本号是4，次版本号是0。</p>

<div> </div>


<p>　　<a href="http://baike.baidu.com/view/183136.htm" target="_blank">版本控制</a>比较普遍的 3 种命名格式 :</p>

<h3><a name="1_1"></a>一、 GNU 风格的版本号命名格式</h3>


<p>　　主版本号 . 子版本号 [. 修正版本号 [. 编译版本号 ]]</p>

<div> </div>


<p>　　英文对照 : Major_Version_Number.Minor_Version_Number[.Revision_Number[.Build_Number]]</p>

<div> </div>


<p>　　示例 : 1.2.1, 2.0, 5.0.0 build-13124</p>

<h3><a name="1_2"></a>二、 Windows 风格的版本号命名格式</h3>


<p>　　主版本号 . 子版本号 [ 修正版本号 [. 编译版本号 ]]</p>

<div> </div>


<p>　　英文对照 : Major_Version_Number.Minor_Version_Number[Revision_Number[.Build_Number]]</p>

<div> </div>


<p>　　示例: 1.21, 2.0</p>

<h3><a name="1_3"></a>三、.Net Framework 风格的版本号命名格式</h3>


<p>　　主版本号.子版本号[.编译版本号[.修正版本号]]</p>

<div> </div>


<p>　　英文对照: Major_Version_Number.Minor_Version_Number[.Build_Number[.Revision_Number]]</p>

<div> </div>


<p>　　版本号由二至四个部分组成：主版本号、次版本号、内部版本号和修订号。主版本号和次版本号是必选的；内部版本号和修订号是可选的，但是如果定义了修订号部分，则内部版本号就是必选的。所有定义的部分都必须是大于或等于 0 的整数。</p>

<div> </div>


<p>　　应根据下面的约定使用这些部分：</p>

<div> </div>


<p>　　Major ：具有相同名称但不同主版本号的程序集不可互换。例如，这适用于对产品的大量重写，这些重写使得无法实现向后兼容性。</p>

<div> </div>


<p>　　Minor ：如果两个程序集的名称和主版本号相同，而次版本号不同，这指示显著增强，但照顾到了向后兼容性。例如，这适用于产品的修正版或完全向后兼容的新版本。</p>

<div> </div>


<p>　　Build ：内部版本号的不同表示对相同源所作的重新编译。这适合于更改处理器、平台或编译器的情况。</p>

<div> </div>


<p>　　Revision ：名称、主版本号和次版本号都相同但修订号不同的程序集应是完全可互换的。这适用于修复以前发布的程序集中的安全漏洞。</p>

<div> </div>


<p>　　程序集的只有内部版本号或修订号不同的后续版本被认为是先前版本的修补程序 (Hotfix) 更新。</p>

<div> </div>


<h2>版本号管理策略</h2>


<h3><a name="2_1"></a>一、 GNU 风格的版本号管理策略</h3>


<p>　　1．项目初版本时 , 版本号可以为 0.1 或 0.1.0, 也可以为 1.0 或 1.0.0, 如果你为人很低调 , 我想你会选择那个主版本号为 0 的方式 ;</p>

<div> </div>


<p>　　2．当项目在进行了局部修改或 bug 修正时 , 主版本号和子版本号都不变 , 修正版本号加 1;</p>

<div> </div>


<p>　　3. 当项目在原有的基础上增加了部分功能时 , 主版本号不变 , 子版本号加 1, 修正版本号复位为 0, 因而可以被忽略掉 ;</p>

<div> </div>


<p>　　4．当项目在进行了重大修改或局部修正累积较多 , 而导致项目整体发生全局变化时 , 主版本号加 1;</p>

<div> </div>


<p>　　5．另外 , 编译版本号一般是编译器在编译过程中自动生成的 , 我们只定义其格式 , 并不进行人为控制 .</p>

<h3><a name="2_2"></a>二、 Window 下的版本号管理策略</h3>


<p>　　1．目初版时 , 版本号为 1.0 或 1.00;</p>

<div> </div>


<p>　　2. 当项目在进行了局部修改或 bug 修正时，主版本号和子版本号都不变 , 修正版本号加 1;</p>

<div> </div>


<p>　　3. 当项目在原有的基础上增加了部分功能时 , 主版本号不变 , 子版本号加 1, 修正版本号复位为 0, 因而可以被忽略掉 ;</p>

<div> </div>


<p>　　4. 当项目在进行了重大修改或局部修正累积较多 , 而导致项目整体发生全局变化时 , 主版本号加 1;</p>

<div> </div>


<p>　　5. 另外 , 编译版本号一般是编译器在编译过程中自动生成的 , 我们只定义其格式 , 并不进行人为控制 .</p>

<div> </div>


<p>　　另外 , 还可以在版本号后面加入 Alpha, Beta, Gamma, Current, RC (Release Candidate), Release, Stable 等后缀 , 在这些后缀后面还可以加入 1 位数字的版本号 .</p>

<div> </div>


<p>　　对于用户来说 , 如果某个软件的主版本号进行了升级 , 用户还想继续那个软件 , 则发行软件的公司一般要对用户收取升级费用 ; 而如果子版本号或修正版本号发生了升级 , 一般来说是免费的 .</p>

<div> </div>


<h2>常见版本号</h2>


<p>　　Alpha &mdash; 内部测试版　Beta &mdash; 外部测试版</p>

<div> </div>


<p>　　Cardware &mdash; 属共享软件的一种，只要给作者回复一封电邮或明信片即可。（有的作者并由此提供注册码等），目前这种形式已不多见。</p>

<div> </div>


<p>　　CHT &mdash; 繁体中文版</p>

<div> </div>


<p>　　CN/SPC &mdash; 简体中文版</p>

<div> </div>


<p>　　Corporation &amp; Enterprise &mdash; 企业版</p>

<div> </div>


<p>　　Deluxe &mdash; 豪华版</p>

<div> </div>


<p>　　Demo &mdash; 演示版</p>

<div> </div>


<p>　　Dev &mdash; 开发专用版，程序员版本。</p>

<div> </div>


<p>　　EN &mdash; 英文版</p>

<div> </div>


<p>　　Enhance &mdash; 增强版或者加强版 属于正式版</p>

<div> </div>


<p>　　Express&amp;Special &mdash; 特别版</p>

<div> </div>


<p>　　Final &mdash; 最终版</p>

<div> </div>


<p>　　Free &mdash; 免费版</p>

<div> </div>


<p>　　Full version &mdash; 完全版 属于正式版</p>

<div> </div>


<p>　　Green &mdash; 绿色版，破解版</p>

<div> </div>


<p>　　Mini &mdash; 迷你版（也叫精简版），只有最基本的功能</p>

<div> </div>


<p>　　Multi-language &mdash; 多语言版</p>

<div> </div>


<p>　　Plus &mdash; 属增强版，不过这种大部分是在程序界面及多媒体功能上增强。</p>

<div> </div>


<p>　　Premium &mdash; 增强版</p>

<div> </div>


<p>　　Preview &mdash; 预览版</p>

<div> </div>


<p>　　Professional &mdash; 专业版</p>

<div> </div>


<p>　　Regged/Registered &mdash; 已注册版</p>

<div> </div>


<p>　　Release &mdash; 发行版 有时间限制</p>

<div> </div>


<p>　　Retail/RTM &mdash; 零售版</p>

<div> </div>


<p>　　Shareware &mdash; 共享版</p>

<div> </div>


<p>　　Stable &mdash; 稳定版</p>

<div> </div>


<p>　　Standard &mdash; 标准版</p>

<div> </div>


<p>　　Ultimate &mdash; 旗舰版，最终版本</p>

<div> </div>


<p>　　Upgrade &mdash; 升级版</p>

<div> </div>


<h2>分类</h2>


<h3><a name="4_1"></a>非正式版</h3>


<p>　　α版</p>

<div> </div>


<p>　　此版本表示该软件仅仅是一个初步完成品，通常只在软件开发者内部交流，也有很少一部分发布给专业测试人员。一般而言，该版本软件的 bug 较多，普通用户最好不要安装。</p>

<div> </div>


<p>　　β（Beta）版</p>

<div> </div>


<p>　　该版本相对于α版已有了很大的改进，消除了严重的错误，但还是存在着一些缺陷，需要经过大规模的发布测试来进一步消除。这一版本通常由软件公司免费发布，用户可从相关的站点下载。通过一些专业爱好者的测试，将结果反馈给开发者，开发者们再进行有针对性的修改。该版本也不适合一般用户安装。</p>

<div> </div>


<p>　　γ版</p>

<div> </div>


<p>　　该版本已经相当成熟了，与即将发行的正式版相差无几，如果用户实在等不及了，尽可以装上一试。</p>

<div> </div>


<p>　　Trial（试用版）</p>

<div> </div>


<p>　　试用版软件在最近的几年里颇为流行，主要是得益于互联网的迅速发展。该版本软件通常都有时间限制，过期之后用户如果希望继续使用，一般得交纳一定的费用进行注册或购买。有些试用版软件还在功能上做了一定的限制。</p>

<div> </div>


<p>　　Unregistered（未注册版）</p>

<div> </div>


<p>　　未注册版与试用版极其类似，只是未注册版通常没有时间限制，在功能上相对于正式版做了一定的限制，例如绝大多数网络电话软件的注册版和未注册版，两者之间在通话质量上有很大差距。还有些虽然在使用上与正式版毫无二致，但是动不动就会弹出一个恼人的消息框来提醒你注册，如看图软件 acdsee 、智能陈桥汉字输入软件等。</p>

<div> </div>


<p>　　Demo版</p>

<div> </div>


<p>　　也称为演示版，在非正式版软件中，该版本的知名度最大。 demo 版仅仅集成了正式版中的几个功能，颇有点像 unregistered 。不同的是， demo 版一般不能通过升级或注册的方法变为正式版。</p>

<div> </div>


<p>　　以上是软件正式版本推出之前的几个版本，α、β、γ可以称为测试版，大凡成熟软件总会有多个测试版，如 windows 98 的β版，前前后后将近有 10 个。这么多的测试版一方面为了最终产品尽可能地满足用户的需要，另一方面也尽量减少了软件中的 bug 。而 trial 、 unregistered 、 demo 有时统称为演示版，这一类版本的广告色彩较浓，颇有点先尝后买的味道，对于普通用户而言自然是可以免费尝鲜了。</p>

<h3><a name="4_2"></a>正式版</h3>


<p>　　不同类型的软件的正式版本通常也有区别。</p>

<div> </div>


<p>　　Release</p>

<div> </div>


<p>　　该版本意味“最终释放版”，在出了一系列的测试版之后，终归会有一个正式版本，对于用户而言，购买该版本的软件绝对不会错。该版本有时也称为标准版。一般情况下， release 不会以单词形式出现在软件封面上，取而代之的是符号 &reg; ，如 windows nt&reg; 4.0 、 ms-dos&reg; 6.22 等。</p>

<div> </div>


<p>　　Registered</p>

<div> </div>


<p>　　很显然，该版本是与 unregistered 相对的注册版。注册版、 release 和下面所讲的 standard 版一样，都是软件的正式版本，只是注册版软件的前身有很大一部分是从网上下载的。</p>

<div> </div>


<p>　　Standard</p>

<div> </div>


<p>　　这是最常见的标准版，不论是什么软件，标准版一定存在。标准版中包含了该软件的基本组件及一些常用功能，可以满足一般用户的需求。其价格相对高一级版本而言还是“平易近人”的。</p>

<div> </div>


<p>　　Deluxe</p>

<div> </div>


<p>　　顾名思义即为“豪华版”。豪华版通常是相对于标准版而言的，主要区别是多了几项功能，价格当然会高出一大块，不推荐一般用户购买。此版本通常是为那些追求“完美”的专业用户所准备的。</p>

<div> </div>


<p>　　Reference</p>

<div> </div>


<p>　　该版本型号常见于百科全书中，比较有名的是微软的 encarta 系列。 reference 是最高级别，其包含的主题、图像、影片剪辑等相对于 standard 和 deluxe 版均有大幅增加，容量由一张光盘猛增至三张光盘，并且加入了很强的交互功能，当然价格也不菲。可以这么说，这一版本的百科全书才能算是真正的百科全书，也是发烧友们收藏的首选。</p>

<div> </div>


<p>　　Professional（专业版）</p>

<div> </div>


<p>　　专业版是针对某些特定的开发工具软件而言的。专业版中有许多内容是标准版中所没有的，这些内容对于一个专业的软件开发人员来说是极为重要的。如微软的 visual foxpro 标准版并不具备编译成可执行文件的功能，这对于一个完整的开发项目而言显然是无法忍受的，若客户机上没有 foxpro 将不能使用。如果用专业版就没有这个问题了。</p>

<div> </div>


<p>　　Enterprise（企业版）</p>

<div> </div>


<p>　　企业版是开发类软件中的极品（相当于百科全书中的 reference 版）。拥有一套这种版本的软件可以毫无障碍地开发任何级别的应用软件。如著名的 visual c++ 的企业版相对于专业版来说增加了几个附加的特性，如 sql 调试、扩展的存储过程向导、支持 as/400 对 ole db 的访问等。而这一版本的价格也是普通用户无法接受的。如微软的 visual studios 6.0 enterprise 中文版的价格为 23000 元。</p>

<h3><a name="4_3"></a>专有版本</h3>


<p>　　除了以上介绍的一些版本外，还有一些专有版本名称。</p>

<div> </div>


<p>　　Update（升级版）</p>

<div> </div>


<p>　　升级版的软件是不能独立使用的，该版本的软件在安装过程中会搜索原有的正式版，如果不存在，则拒绝执行下一步。如 microsoft office 2000 升级版、 windows 9x 升级版等等。</p>

<div> </div>


<p>　　OEM版</p>

<div> </div>


<p>　　OEM 版通常是捆绑在硬件中而不单独销售的版本。将自己的产品交给别的公司去卖，保留自己的著作权，双方互惠互利，一举两得。</p>

<div> </div>


<p>　　单机（网络）版</p>

<div> </div>


<p>　　网络版在功能、结构上远比单机版复杂，如果留心一下软件的报价，你就会发现某些软件单机版和网络版的价格相差非常大，有些网络版甚至多一个客户端口就要加不少钱。</p>

<div> </div>


<p>　　普及版</p>

<div> </div>


<p>　　该版本有时也会被称为共享版，其特点是价格便宜（有些甚至完全免费）、功能单一、针对性强（当然也有占领市场、打击盗版等因素）。与试用版不同的是，该版本的软件一般不会有时间上的限制。当然，如果用户想升级，最好还是去购买正式版。</p>

<h3><a name="4_4"></a>其他版本</h3>


<p>　　破解版又称绿色版，严格来说这不属于一种授权版本，因为它是针对商业版、<a href="http://baike.baidu.com/view/796056.htm" target="_blank">试用版</a>、共享版这类有使用限制的<a href="http://baike.baidu.com/view/37.htm" target="_blank">软件</a>进行二次开发之后形成的特殊版本，也就是说，使用者可以在没有任何经济付出的条件下无限制的使用该软件的全部功能。一般通过改写原软件、制作算号器、拦截注册信息等等方式实现。</p>

<div> </div>


<p>　　以上是一些常见<a href="http://baike.baidu.com/view/8630.htm" target="_blank">软件版本</a>的简要介绍，随着软件市场行为的变化，现在也出现了一些新的版本命名方式，<a href="http://baike.baidu.com/view/6814120.htm" target="_blank">比如</a>windows xp中的xp是取自于experience中的第二、第三个字母。希望以上内容能够对大家的购买、使用和下载软件有所帮助。</p>

<div> </div>


<p>　　基于商业上考虑，很多的软件都不是非常严谨的遵循这个规则的。最有名的就是微软了。例如他的 NT 系列版本。大家比较熟悉的是从 NT 4.0 开始的。 99 年推出了 windows 2000 ， 2001 年推出了 windows xp ， 2003 年推出了 windows 2003 ，乍一看版本区别蛮大的，但是看他们的内部版本号就会发现，变化其实并不大，只是界面变化的大了而已。这是软件公司经常干的事情。 Windows 2000 的版本号是 NT 5.0 ， windows xp 的版本号是 NT 5.1 ， windows 2003 的版本号是 NT 5.2 ，Windows Vista和现在的Windows7 的版本号是 NT 6.0和NT 6.1，才是跨越化的版本。这样做的话就可以持续的赚广大客户的钱。毕竟人的眼睛看得东西是最直观的，所以给人感觉也是变化最大的 。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/12/29/rails-routing-from-the-outside-in-rails/">Rails Routing From the Outside in Rails</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-12-29T00:23:00+08:00" pubdate data-updated="true">Dec 29<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Rails Routing from the Outside In Rails</h2>

<h2>Rails Routing from the Outside In Rails<span style="font-family: WenQuanYi Micro Hei;">来自外部的</span>Routing</h2>


<p>This guide covers the user-facing features of Rails routing. By referring to this guide, you will be able to:</p>

<p><span style="font-family: DejaVu Sans;">这个</span>guide<span style="font-family: DejaVu Sans;">涵盖了面向用户的</span>Rails<span style="font-family: DejaVu Sans;">路由特性。通过参考这个</span>guide<span style="font-family: DejaVu Sans;">，你将能够：</span></p>

<p>Understand the code in <tt>routes.rb</tt></p>

<p><span style="font-family: DejaVu Sans;">明白在</span><tt>routes.rb</tt><span style="font-family: DejaVu Sans;"><tt>中的代码</tt></span></p>

<ul>
    <li>Construct your own routes, using either the preferred resourceful style or the <tt>match</tt> method</li>
</ul>


<p><span style="font-family: DejaVu Sans;">构建属于你的</span>routes<span style="font-family: DejaVu Sans;">，要么首选使用</span>resourceful style<span style="font-family: DejaVu Sans;">要么使用</span>match<span style="font-family: DejaVu Sans;">方法</span></p>

<ul>
    <li>Identify what parameters to expect an action to receive</li>
</ul>


<p><span style="font-family: DejaVu Sans;">确定什么样的参数</span>expect<span style="font-family: DejaVu Sans;">（预期）一个</span>action<span style="font-family: DejaVu Sans;">来接收（</span>url<span style="font-family: DejaVu Sans;">）</span></p>

<ul>
    <li>Automatically create paths and URLs using route helpers</li>
</ul>


<p><span style="font-family: DejaVu Sans;">自动的创建路径和</span>URLs<span style="font-family: DejaVu Sans;">使用</span>route helpers</p>

<ul>
    <li>Use advanced techniques such as constraints and Rack endpoints</li>
</ul>


<p><span style="font-family: DejaVu Sans;">使用高级的技术比如公约和</span>Rack endpoints</p>

<h3><a name="the-purpose-of-the-rails-router"></a>1 The Purpose of the Rails Router</h3>


<p>The Rails router recognizes URLs and dispatches them to a controller’s action. It can also generate paths and URLs, avoiding the need to hardcode strings in your views.</p>

<p>Rails router<span style="font-family: DejaVu Sans;">组织</span>URLs<span style="font-family: DejaVu Sans;">和</span>dispatches(<span style="font-family: DejaVu Sans;">调度</span>)<span style="font-family: DejaVu Sans;">到一个</span>controller<span style="font-family: DejaVu Sans;">的</span>action<span style="font-family: DejaVu Sans;">中。它也可以创建</span>paths<span style="font-family: DejaVu Sans;">和</span>URLs<span style="font-family: DejaVu Sans;">，避免需要</span>hardcode string<span style="font-family: DejaVu Sans;">到你的视图中。</span></p>

<h4><a name="connecting-urls-to-code"></a>1.1 Connecting URLs to Code<span style="font-family: WenQuanYi Micro Hei;">连接</span>URLs<span style="font-family: WenQuanYi Micro Hei;">到</span>Code</h4>


<p>When your Rails application receives an incoming request</p>

<p><span style="font-family: DejaVu Sans;">当你的</span>Rails<span style="font-family: DejaVu Sans;">应用程序收到一个传入请求（</span>incoming requests (<span style="font-family: DejaVu Sans;">传入请求</span>)<span style="font-family: DejaVu Sans;">正传递给用户的网站内容。）</span></p>

<p>GET /patients/17</p>

<p>it asks the router to match it to a controller action. If the first matching route is</p>

<p><span style="font-family: DejaVu Sans;">它请求</span>router<span style="font-family: DejaVu Sans;">匹配</span>URLs<span style="font-family: DejaVu Sans;">到一个</span>controller action<span style="font-family: DejaVu Sans;">。如果第一个匹配的</span>route<span style="font-family: DejaVu Sans;">是</span></p>

<p>match &ldquo;/patients/:id&rdquo; =&gt; &ldquo;patients#show&rdquo;</p>

<p>the request is dispatched to the <tt>patients</tt> controller’s <tt>show</tt> action with <tt>{</tt><tt> </tt><tt>:id</tt><tt> </tt><tt>=&gt;</tt><tt> “</tt><tt>17</tt><tt>” </tt><tt>}</tt> in <tt>params</tt>.</p>

<p><span style="font-family: DejaVu Sans;">这个请求被调度给</span>patients controller<span style="font-family: DejaVu Sans;">的</span>show action<span style="font-family: DejaVu Sans;">以及</span><tt>{</tt><tt> </tt><tt>:id</tt><tt> </tt><tt>=&gt;</tt><tt> “</tt><tt>17</tt><tt>” </tt><tt>}</tt><span style="font-family: DejaVu Sans;"><tt>在</tt></span><tt>params</tt><span style="font-family: DejaVu Sans;"><tt>字典中。</tt></span></p>

<h4><a name="generating-paths-and-urls-from-code"></a> 1.2 Generating Paths and URLs from Code<span style="font-family: WenQuanYi Micro Hei;">从</span>Code<span style="font-family: WenQuanYi Micro Hei;">创建</span>Paths<span style="font-family: WenQuanYi Micro Hei;">和</span>URLs</h4>


<p>You can also generate paths and URLs. If your application contains this code:</p>

<p><span style="font-family: DejaVu Sans;">你可以创建</span>paths<span style="font-family: DejaVu Sans;">和</span>URLs<span style="font-family: DejaVu Sans;">。如果你的应用程序中包含这样的代码：</span></p>

<p>@patient = Patient.find(17)</p>

<p>&lt;%= link_to &ldquo;Patient Record&rdquo;, patient_path(@patient) %&gt;</p>

<p>The router will generate the path <tt>/patients/17</tt>. This reduces the brittleness of your view and makes your code easier to understand. Note that the id does not need to be specified in the route helper.</p>

<p>Router<span style="font-family: DejaVu Sans;">将会创建</span>path <tt>/patients/17</tt><span style="font-family: DejaVu Sans;"><tt>。这样减少了你的视图的脆性并且使得你的代码更加容易明白。</tt></span></p>

<h3><a name="resource-routing-the-rails-default"></a>2 Resource Routing: the Rails Default</h3>


<p>Resource routing allows you to quickly declare all of the common routes for a given resourceful controller. Instead of declaring separate routes for your <tt>index</tt>, <tt>show</tt>, <tt>new</tt>, <tt>edit</tt>, <tt>create</tt>, <tt>update</tt> and <tt>destroy</tt> actions, a resourceful route declares them in a single line of code.</p>

<p>Resource routing<span style="font-family: DejaVu Sans;">让你快速的为一个提供的</span>resourceful<span style="font-family: DejaVu Sans;">的</span>controller<span style="font-family: DejaVu Sans;">声明所有的常用</span>routes<span style="font-family: DejaVu Sans;">。替代你去声明单个的</span><tt>index</tt>, <tt>show</tt>, <tt>new</tt>, <tt>edit</tt>, <tt>create</tt>, <tt>update</tt> and <tt>destroy</tt> actions<span style="font-family: DejaVu Sans;">的</span>routes<span style="font-family: DejaVu Sans;">，一个</span>resourceful route<span style="font-family: DejaVu Sans;">声明它们在一个单行代码中。</span></p>

<p>When your Rails application receives an incoming request for</p>

<p><span style="font-family: DejaVu Sans;">当你的</span>Rails<span style="font-family: DejaVu Sans;">应用程序收到一个这样的传入请求</span></p>

<p>DELETE /photos/17</p>

<p>it asks the router to map it to a controller action. If the first matching route is</p>

<p><span style="font-family: DejaVu Sans;">它请求</span>router<span style="font-family: DejaVu Sans;">匹配</span>URLs<span style="font-family: DejaVu Sans;">到一个</span>controller action<span style="font-family: DejaVu Sans;">。如果第一个匹配的</span>route<span style="font-family: DejaVu Sans;">是</span></p>

<p>resources :photos</p>

<p>Rails would dispatch that request to the <tt>destroy</tt> method on the <tt>photos</tt> controller with <tt>{</tt><tt> </tt><tt>:id</tt><tt> </tt><tt>=&gt;</tt><tt> “</tt><tt>17</tt><tt>” </tt><tt>}</tt> in <tt>params</tt>.</p>

<p>Rails<span style="font-family: DejaVu Sans;">将会把这个请求调度给</span><tt>photos</tt> controller<span style="font-family: DejaVu Sans;">的</span><tt>destroy</tt> action<span style="font-family: DejaVu Sans;">以及</span><tt>{</tt><tt> </tt><tt>:id</tt><tt> </tt><tt>=&gt;</tt><tt> “</tt><tt>17</tt><tt>” </tt><tt>}</tt><span style="font-family: DejaVu Sans;"><tt>在</tt></span><tt>params</tt><span style="font-family: DejaVu Sans;"><tt>字典中</tt></span></p>

<h4><a name="crud-verbs-and-actions"></a>2.2 CRUD, Verbs, and Actions</h4>


<p>CRUD<span style="font-family: DejaVu Sans;">是指在做计算处理时的增加</span>(Create)<span style="font-family: DejaVu Sans;">、查询</span>(Retrieve)<span style="font-family: DejaVu Sans;">（重新得到数据）、更新</span>(Update)<span style="font-family: DejaVu Sans;">和删除</span>(Delete)<span style="font-family: DejaVu Sans;">几个单词的首字母简写。主要被用在描述软件系统中数据库或者持久层的基本操作功能。</span></p>

<p>HTTP Verb HTTP<span style="font-family: DejaVu Sans;">动作</span></p>

<p>In Rails, a resourceful route provides a mapping between HTTP verbs and URLs to controller actions. By convention, each action also maps to particular CRUD operations in a database. A single entry in the routing file, such as</p>

<p><span style="font-family: DejaVu Sans;">在</span>Rails<span style="font-family: DejaVu Sans;">中，一个</span>resourceful route<span style="font-family: DejaVu Sans;">提供一个在</span>HTTP verbs<span style="font-family: DejaVu Sans;">和</span>URLs<span style="font-family: DejaVu Sans;">之间的映射到</span>controller actions<span style="font-family: DejaVu Sans;">。根据公约，每个</span>action<span style="font-family: DejaVu Sans;">都应该映射到数据库的</span>CRUD<span style="font-family: DejaVu Sans;">操作的一部分。一个单独的条目在</span>routing<span style="font-family: DejaVu Sans;">文件中，像这样</span></p>

<p>resources :photos</p>

<p>creates seven different routes in your application, all mapping to the <tt>Photos</tt> controller:</p>

<p><span style="font-family: DejaVu Sans;">创建七个不同的</span>routes<span style="font-family: DejaVu Sans;">在你的应用程序中，所有的这些</span>routes<span style="font-family: DejaVu Sans;">映射到</span>Photos controller<span style="font-family: DejaVu Sans;">：</span></p>

<p>&nbsp;</p>

<table width="573" cellspacing="0" cellpadding="2"><colgroup><col width="89" /> <col width="102" /> <col width="54" /> <col width="311" /> </colgroup>
<tbody>
<tr>
<th width="89">HTTP Verb</th>
<th width="102">Path</th>
<th width="54">action</th>
<th width="311">used for</th>
</tr>
<tr>
<td width="89">GET</td>
<td width="102">/photos</td>
<td width="54">index</td>
<td width="311">display a list of all photos</td>
</tr>
<tr>
<td width="89">GET</td>
<td width="102">/photos/new</td>
<td width="54">new</td>
<td width="311">return an HTML form for creating a new photo</td>
</tr>
<tr>
<td width="89">POST</td>
<td width="102">/photos</td>
<td width="54">create</td>
<td width="311">create a new photo</td>
</tr>
<tr>
<td width="89">GET</td>
<td width="102">/photos/:id</td>
<td width="54">show</td>
<td width="311">display a specific photo</td>
</tr>
<tr>
<td width="89">GET</td>
<td width="102">/photos/:id/edit</td>
<td width="54">edit</td>
<td width="311">return an HTML form for editing a photo</td>
</tr>
<tr>
<td width="89">PUT</td>
<td width="102">/photos/:id</td>
<td width="54">update</td>
<td width="311">update a specific photo</td>
</tr>
<tr>
<td width="89">DELETE</td>
<td width="102">/photos/:id</td>
<td width="54">destroy</td>
<td width="311">delete a specific photo</td>
</tr>
</tbody>
</table>


<p>Rails routes are matched in the order they are specified, so if you have a <tt>resources</tt><tt> </tt><tt>:photos</tt> above a <tt>get</tt><tt> </tt><tt>&lsquo;photos/poll&rsquo;</tt> the <tt>show</tt> action’s route for the <tt>resources</tt> line will be matched before the <tt>get</tt> line. To fix this, move the <tt>get</tt> line <strong>above</strong> the <tt>resources</tt> line so that it is matched first.</p>

<p><strong>Rails</strong><strong> </strong><strong>routes</strong><span style="font-family: DejaVu Sans;"><strong>在它们指定的顺序中匹配，因此如果你有一个</strong></span><tt><strong>resources</strong></tt><tt><strong> </strong></tt><tt><strong>:photos</strong></tt><span style="font-family: DejaVu Sans;"><tt><strong>在</strong></tt></span><tt><strong>get</strong></tt><tt><strong> </strong></tt><tt><strong>&lsquo;photos/poll&rsquo;</strong></tt><span style="font-family: DejaVu Sans;"><tt><strong>的上面，</strong></tt></span><tt><strong>resources</strong></tt><tt><strong> </strong></tt><tt><strong>line</strong></tt><span style="font-family: DejaVu Sans;"><tt><strong>的</strong></tt></span><tt><strong>show</strong></tt><tt><strong> </strong></tt><tt><strong>action</strong></tt><span style="font-family: DejaVu Sans;"><tt><strong>的</strong></tt></span><tt><strong>route</strong></tt><span style="font-family: DejaVu Sans;"><tt><strong>将会在</strong></tt></span><tt><strong>get</strong></tt><tt><strong> </strong></tt><tt><strong>line</strong></tt><span style="font-family: DejaVu Sans;"><tt><strong>之前先被匹配。要修复这些，移动</strong></tt></span><tt><strong>get</strong></tt><tt><strong> </strong></tt><tt><strong>line</strong></tt><span style="font-family: DejaVu Sans;"><tt><strong>在</strong></tt></span><tt><strong>resources</strong></tt><tt><strong> </strong></tt><tt><strong>line</strong></tt><span style="font-family: DejaVu Sans;"><tt><strong>上面以确保</strong></tt></span><tt><strong>get</strong></tt><tt><strong> </strong></tt><tt><strong>line</strong></tt><span style="font-family: DejaVu Sans;"><tt><strong>被首先匹配。</strong></tt></span></p>

<h4><a name="paths-and-urls"></a>2.3 Paths and URLs</h4>


<p>Creating a resourceful route will also expose a number of helpers to the controllers in your application. In the case of <tt>resources</tt><tt> </tt><tt>:photos</tt>:</p>

<p><span style="font-family: DejaVu Sans;">在你的应用程序中创建一个</span>resourceful<span style="font-family: DejaVu Sans;">的</span>route<span style="font-family: DejaVu Sans;">也将会摆出一系列的</span>controllers<span style="font-family: DejaVu Sans;">的</span>helpers<span style="font-family: DejaVu Sans;">，在这里的情况中</span><tt>resources</tt><tt> </tt><tt>:photos</tt><span style="font-family: DejaVu Sans;"><tt>如下：</tt></span></p>

<ul>
    <li><tt>photos_path</tt> returns <tt>/photos</tt></li>
    <li><tt>new_photo_path</tt> returns <tt>/photos/new</tt></li>
    <li><tt>edit_photo_path(:id)</tt> returns <tt>/photos/:id/edit</tt> (for instance, <tt>edit_photo_path(10)</tt> returns <tt>/photos/10/edit</tt>)</li>
    <li><tt>photo_path(:id)</tt> returns <tt>/photos/:id</tt> (for instance, <tt>photo_path(10)</tt> returns <tt>/photos/10</tt>)</li>
</ul>


<p>Each of these helpers has a corresponding <tt>_url</tt> helper (such as <tt>photos_url</tt>) which returns the same path prefixed with the current host, port and path prefix.</p>

<p><span style="font-family: DejaVu Sans;">这里的每个</span>helpers<span style="font-family: DejaVu Sans;">都有一个相应的</span>_url helper<span style="font-family: DejaVu Sans;">（例如</span><tt>photos_url</tt><span style="font-family: DejaVu Sans;"><tt>，</tt></span><tt>edit_photo_url(1)</tt><span style="font-family: DejaVu Sans;">）</span></p>

<p><span style="font-family: DejaVu Sans;">其将会返回相同的路径后缀以及当前主机，端口和路径后缀。</span></p>

<h4>the code in my demo</h4>

<h1>@tmp=post_url(1)</h1>

<h1>@tmp=posts_url</h1>

<h1>@tmp=edit_post_url(:id)</h1>

<p>@tmp=new_post_url</p>

<p>Because the router uses the HTTP verb and URL to match inbound requests, four URLs map to seven different actions.</p>

<p><span style="font-family: DejaVu Sans;">因为</span>router<span style="font-family: DejaVu Sans;">使用</span>HTTP verb<span style="font-family: DejaVu Sans;">和</span>URL<span style="font-family: DejaVu Sans;">来匹配入站请求，四种</span>URLs<span style="font-family: DejaVu Sans;">映射到七种不同的</span>actions<span style="font-family: DejaVu Sans;">中。</span></p>

<h4><a name="defining-multiple-resources-at-the-same-"></a> 2.4 Defining Multiple Resources at the Same Time<span style="font-family: WenQuanYi Micro Hei;">在同一时间定义多个</span>Resource</h4>


<p>If you need to create routes for more than one resource, you can save a bit of typing by defining them all with a single call to <tt>resources</tt>:</p>

<p><span style="font-family: DejaVu Sans;">如果你需要为超过一个</span>resource<span style="font-family: DejaVu Sans;">创建</span>routes<span style="font-family: DejaVu Sans;">，你可以保存它们到一组中通过调用单个</span>resources<span style="font-family: DejaVu Sans;">来定义所有的</span>resource<span style="font-family: DejaVu Sans;">：</span></p>

<p>resources :photos, :books, :videos</p>

<p>This works exactly the same as</p>

<p><span style="font-family: DejaVu Sans;">这里工作类似于：</span></p>

<p>resources :photos</p>

<p>resources :books</p>

<p>resources :videos</p>

<h4><a name="singular-resources"></a>2.5 Singular Resources <span style="font-family: WenQuanYi Micro Hei;">单数</span>Resources</h4>


<p>Sometimes, you have a resource that clients always look up without referencing an ID. For example, you would like <tt>/profile</tt> to always show the profile of the currently logged in user. In this case, you can use a singular resource to map <tt>/profile</tt> (rather than <tt>/profile/:id</tt>) to the <tt>show</tt> action.</p>

<p><span style="font-family: DejaVu Sans;">有时候，你有一个</span>resource<span style="font-family: DejaVu Sans;">，</span>clients<span style="font-family: DejaVu Sans;">通常查找它们并不引用一个</span>ID<span style="font-family: DejaVu Sans;">。例如，你将会希望</span><tt>/profile</tt><span style="font-family: DejaVu Sans;"><tt>来总是显示当前的登录的用户的</tt></span><tt>profile</tt><span style="font-family: DejaVu Sans;"><tt>。在这种情况中，你可以使用一个单数的</tt></span><tt>resource</tt><span style="font-family: DejaVu Sans;"><tt>来映射</tt></span><tt>/profile</tt><tt> </tt><tt>(rather</tt><tt> </tt><tt>than</tt><tt> </tt><tt>/profile/:id)</tt><span style="font-family: DejaVu Sans;"><tt>到</tt></span><tt>show</tt><tt> </tt><tt>ation</tt><span style="font-family: DejaVu Sans;"><tt>。</tt></span></p>

<p>match &ldquo;profile&rdquo; =&gt; &ldquo;users#show&rdquo;</p>

<p>This resourceful route<span style="font-family: DejaVu Sans;">这里是</span>resourceful route</p>

<p>resource :geocoder</p>

<p>creates six different routes in your application, all mapping to the <tt>Geocoders</tt> controller:</p>

<p><span style="font-family: DejaVu Sans;">在你的应用程序中创建六种不同的</span>routes<span style="font-family: DejaVu Sans;">，所有的</span>routes<span style="font-family: DejaVu Sans;">映射到</span><tt>Geocoders</tt><span style="font-family: DejaVu Sans;"><tt>的</tt></span><tt>cotroller</tt><span style="font-family: DejaVu Sans;"><tt>：</tt></span></p>

<p>&nbsp;</p>

<table width="575" cellspacing="0" cellpadding="2"><colgroup><col width="89" /> <col width="101" /> <col width="54" /> <col width="315" /> </colgroup>
<tbody>
<tr>
<th width="89">HTTP Verb</th>
<th width="101">Path</th>
<th width="54">action</th>
<th width="315">used for</th>
</tr>
<tr>
<td width="89">GET</td>
<td width="101">/geocoder/new</td>
<td width="54">new</td>
<td width="315">return an HTML form for creating the geocoder</td>
</tr>
<tr>
<td width="89">POST</td>
<td width="101">/geocoder</td>
<td width="54">create</td>
<td width="315">create the new geocoder</td>
</tr>
<tr>
<td width="89">GET</td>
<td width="101">/geocoder</td>
<td width="54">show</td>
<td width="315">display the one and only geocoder resource</td>
</tr>
<tr>
<td width="89">GET</td>
<td width="101">/geocoder/edit</td>
<td width="54">edit</td>
<td width="315">return an HTML form for editing the geocoder</td>
</tr>
<tr>
<td width="89">PUT</td>
<td width="101">/geocoder</td>
<td width="54">update</td>
<td width="315">update the one and only geocoder resource</td>
</tr>
<tr>
<td width="89">DELETE</td>
<td width="101">/geocoder</td>
<td width="54">destroy</td>
<td width="315">delete the geocoder resource</td>
</tr>
</tbody>
</table>


<p>Because you might want to use the same controller for a singular route (/account) and a plural route (/accounts/45), singular resources map to plural controllers.</p>

<p><span style="font-family: DejaVu Sans;"><tt>因为你可能希望对单数</tt></span><tt>route(/account)</tt><span style="font-family: DejaVu Sans;"><tt>和复数</tt></span><tt>route(/accounts/45)</tt><span style="font-family: DejaVu Sans;"><tt>使用相同的</tt></span><tt>controller</tt><span style="font-family: DejaVu Sans;"><tt>，单数</tt></span><tt>resources</tt><span style="font-family: DejaVu Sans;"><tt>映射到复数</tt></span><tt>controllers</tt><span style="font-family: DejaVu Sans;"><tt>。</tt></span></p>

<p><tt>A</tt><tt> </tt><tt>singular</tt><tt> </tt><tt>resourceful</tt><tt> </tt><tt>route</tt><tt> </tt><tt>generates</tt><tt> </tt><tt>these</tt><tt> </tt><tt>helpers:</tt></p>

<p><span style="font-family: DejaVu Sans;"><tt>一个单数</tt></span><tt>resourceful</tt><tt> </tt><tt>route</tt><span style="font-family: DejaVu Sans;"><tt>创建这些</tt></span><tt>helpers</tt><span style="font-family: DejaVu Sans;"><tt>：</tt></span></p>

<ul>
    <li><tt>new_geocoder_path</tt> returns <tt>/geocoder/new</tt></li>
    <li><tt>edit_geocoder_path</tt> returns <tt>/geocoder/edit</tt></li>
    <li><tt>geocoder_path</tt> returns <tt>/geocoder</tt></li>
</ul>


<p><tt>As</tt><tt> </tt><tt>with</tt><tt> </tt><tt>plural</tt><tt> </tt><tt>resources,</tt><tt> </tt><tt>the</tt><tt> </tt><tt>same</tt><tt> </tt><tt>helpers</tt><tt> </tt><tt>ending</tt><tt> </tt><tt>in</tt><tt> </tt><tt>_url</tt><tt> </tt><tt>will</tt><tt> </tt><tt>also</tt><tt> </tt><tt>include</tt><tt> </tt><tt>the</tt><tt> </tt><tt>host,</tt><tt> </tt><tt>port</tt><tt> </tt><tt>and</tt><tt> </tt><tt>path</tt><tt> </tt><tt>prefix.</tt></p>

<p><span style="font-family: DejaVu Sans;"><tt>就像</tt></span><tt>plural</tt><tt> </tt><tt>resources</tt><span style="font-family: DejaVu Sans;"><tt>，相同的以</tt></span><tt>_url</tt><span style="font-family: DejaVu Sans;"><tt>结尾的</tt></span><tt>helpers</tt><span style="font-family: DejaVu Sans;"><tt>同样包含，</tt></span><tt>host</tt><span style="font-family: DejaVu Sans;"><tt>，</tt></span><tt>port</tt><span style="font-family: DejaVu Sans;"><tt>和路径后缀。</tt></span></p>

<h4><a name="controller-namespaces-and-routing"></a><tt>2.6</tt><tt> </tt><tt>Controller</tt><tt> </tt><tt>Namespaces</tt><tt> </tt><tt>and</tt><tt> </tt><tt>Routing</tt></h4>


<p>You may wish to organize groups of controllers under a namespace. Most commonly, you might group a number of administrative controllers under an <tt>Admin::</tt> namespace. You would place these controllers under the <tt>app/controllers/admin</tt> directory, and you can group them together in your router:</p>

<p><span style="font-family: DejaVu Sans;"><tt>你可能希望通过</tt></span><tt>namespace</tt><span style="font-family: DejaVu Sans;"><tt>分组组织</tt></span><tt>controllers</tt><span style="font-family: DejaVu Sans;"><tt>。通常大多数情况，你可以分组一系列的</tt><tt></tt></span><tt>administrative</tt><tt> </tt><tt>controllers</tt><span style="font-family: DejaVu Sans;"><tt>到一个</tt></span><tt>Admin::</tt><span style="font-family: DejaVu Sans;"><tt>名称空间下面。你将会放置这些</tt></span><tt>controllers</tt><span style="font-family: DejaVu Sans;"><tt>在</tt><tt></tt></span><tt>app/controllers/admin</tt><span style="font-family: DejaVu Sans;"><tt>目录中，并且你可以在你的</tt></span><tt>router</tt><span style="font-family: DejaVu Sans;"><tt>中分组他们在一起</tt></span></p>

<p><tt>namespace</tt><tt> </tt><tt>:admin</tt><tt> </tt><tt>do</tt></p>

<p><tt> </tt><tt>resources</tt><tt> </tt><tt>:posts,</tt><tt> </tt><tt>:comments</tt></p>

<p><tt>end</tt></p>

<p><tt>This</tt><tt> </tt><tt>will</tt><tt> </tt><tt>create</tt><tt> </tt><tt>a</tt><tt> </tt><tt>number</tt><tt> </tt><tt>of</tt><tt> </tt><tt>routes</tt><tt> </tt><tt>for</tt><tt> </tt><tt>each</tt><tt> </tt><tt>of</tt><tt> </tt><tt>the</tt><tt> </tt><tt>posts</tt><tt> </tt><tt>and</tt><tt> </tt><tt>comments</tt><tt> </tt><tt>controller.</tt><tt> </tt><tt>For</tt><tt> </tt><tt>Admin::PostsController,</tt><tt> </tt><tt>Rails</tt><tt> </tt><tt>will</tt><tt> </tt><tt>create:</tt></p>

<p><span style="font-family: DejaVu Sans;"><tt>这将会对于每一个</tt></span><tt>posts</tt><span style="font-family: DejaVu Sans;"><tt>和</tt></span><tt>comments</tt><tt> </tt><tt>controller</tt><span style="font-family: DejaVu Sans;"><tt>创建若干的</tt></span><tt>routes</tt><span style="font-family: DejaVu Sans;"><tt>。对于</tt><tt></tt></span><tt>Admin::PostsController</tt><span style="font-family: DejaVu Sans;"><tt>，</tt></span><tt>Rails</tt><span style="font-family: DejaVu Sans;"><tt>将会创建：</tt></span></p>

<p>&nbsp;</p>

<table width="473" cellspacing="0" cellpadding="2"><colgroup><col width="89" /> <col width="136" /> <col width="54" /> <col width="178" /> </colgroup>
<tbody>
<tr>
<th width="89">HTTP Verb</th>
<th width="136">Path</th>
<th width="54">action</th>
<th width="178">named helper</th>
</tr>
<tr>
<td width="89">GET</td>
<td width="136">/admin/posts</td>
<td width="54">index</td>
<td width="178">admin_posts_path</td>
</tr>
<tr>
<td width="89">GET</td>
<td width="136">/admin/posts/new</td>
<td width="54">new</td>
<td width="178">new_admin_post_path</td>
</tr>
<tr>
<td width="89">POST</td>
<td width="136">/admin/posts</td>
<td width="54">create</td>
<td width="178">admin_posts_path</td>
</tr>
<tr>
<td width="89">GET</td>
<td width="136">/admin/posts/:id</td>
<td width="54">show</td>
<td width="178">admin_post_path(:id)</td>
</tr>
<tr>
<td width="89">GET</td>
<td width="136">/admin/posts/:id/edit</td>
<td width="54">edit</td>
<td width="178">edit_admin_post_path(:id)</td>
</tr>
<tr>
<td width="89">PUT</td>
<td width="136">/admin/posts/:id</td>
<td width="54">update</td>
<td width="178">admin_post_path(:id)</td>
</tr>
<tr>
<td width="89">DELETE</td>
<td width="136">/admin/posts/:id</td>
<td width="54">destroy</td>
<td width="178">admin_post_path(:id)</td>
</tr>
</tbody>
</table>


<p>If you want to route /posts (without the prefix /admin) to Admin::PostsController, you could use</p>

<p><span style="font-family: DejaVu Sans;"><tt>如果你想</tt></span><tt>Admin::PostsController</tt><span style="font-family: DejaVu Sans;"><tt>的</tt></span><tt>route</tt><tt> </tt><tt>/posts(without</tt><tt> </tt><tt>the</tt><tt> </tt><tt>prefix</tt><tt> </tt><tt>/admin)</tt><span style="font-family: DejaVu Sans;"><tt>，你可以使用</tt></span></p>

<p><tt>#</tt><span style="font-family: DejaVu Sans;"><tt>从</tt></span><tt>admin</tt><span style="font-family: DejaVu Sans;"><tt>中取出，重新声明为独立的</tt></span><tt>resources</tt></p>

<p><tt>scope</tt><tt> </tt><tt>:module</tt><tt> </tt><tt>=&gt;</tt><tt> </tt><tt>&ldquo;admin&rdquo;</tt><tt> </tt><tt>do</tt></p>

<p><tt> </tt><tt>resources</tt><tt> </tt><tt>:posts,</tt><tt> </tt><tt>:comments</tt></p>

<p><tt>end</tt></p>

<p><tt>or,</tt><tt> </tt><tt>for</tt><tt> </tt><tt>a</tt><tt> </tt><tt>single</tt><tt> </tt><tt>case</tt></p>

<p><tt>resources</tt><tt> </tt><tt>:posts,</tt><tt> </tt><tt>:module</tt><tt> </tt><tt>=&gt;</tt><tt> </tt><tt>&ldquo;admin&rdquo;</tt></p>

<p><tt>If</tt><tt> </tt><tt>you</tt><tt> </tt><tt>want</tt><tt> </tt><tt>to</tt><tt> </tt><tt>route</tt><tt> </tt><tt>/admin/posts</tt><tt> </tt><tt>to</tt><tt> </tt><tt>PostsController</tt><tt> </tt><tt>(without</tt><tt> </tt><tt>the</tt><tt> </tt><tt>Admin::</tt><tt> </tt><tt>module</tt><tt> </tt><tt>prefix),</tt><tt> </tt><tt>you</tt><tt> </tt><tt>could</tt><tt> </tt><tt>use</tt></p>

<p>scope &ldquo;/admin&rdquo; do</p>

<p>resources :posts, :comments</p>

<p>end</p>

<p><tt>or,</tt><tt> </tt><tt>for</tt><tt> </tt><tt>a</tt><tt> </tt><tt>single</tt><tt> </tt><tt>case</tt></p>

<p><tt>resources</tt><tt> </tt><tt>:posts,</tt><tt> </tt><tt>:path</tt><tt> </tt><tt>=&gt;</tt><tt> </tt><tt>&ldquo;/admin/posts&rdquo;</tt></p>

<p><tt>In</tt><tt> </tt><tt>each</tt><tt> </tt><tt>of</tt><tt> </tt><tt>these</tt><tt> </tt><tt>cases,</tt><tt> </tt><tt>the</tt><tt> </tt><tt>named</tt><tt> </tt><tt>routes</tt><tt> </tt><tt>remain</tt><tt> </tt><tt>the</tt><tt> </tt><tt>same</tt><tt> </tt><tt>as</tt><tt> </tt><tt>if</tt><tt> </tt><tt>you</tt><tt> </tt><tt>did</tt><tt> </tt><tt>not</tt><tt> </tt><tt>use</tt><tt> </tt><tt>scope.</tt><tt> </tt><tt>In</tt><tt> </tt><tt>the</tt><tt> </tt><tt>last</tt><tt> </tt><tt>case,</tt><tt> </tt><tt>the</tt><tt> </tt><tt>following</tt><tt> </tt><tt>paths</tt><tt> </tt><tt>map</tt><tt> </tt><tt>to</tt><tt> </tt><tt>PostsController:</tt></p>

<p><span style="font-family: DejaVu Sans;"><tt>在每个这样的情况中，</tt></span><tt>named</tt><tt> </tt><tt>routes</tt><span style="font-family: DejaVu Sans;"><tt>保持不变，如果你没有使用范围。在最后，随后的</tt></span><tt>paths</tt><span style="font-family: DejaVu Sans;"><tt>映射到</tt><tt></tt></span><tt>PostsController</tt><span style="font-family: DejaVu Sans;"><tt>：</tt></span></p>

<p>&nbsp;</p>

<table width="417" cellspacing="0" cellpadding="2"><colgroup><col width="89" /> <col width="132" /> <col width="54" /> <col width="126" /> </colgroup>
<tbody>
<tr>
<th width="89">HTTP Verb</th>
<th width="132">Path</th>
<th width="54">action</th>
<th width="126">named helper</th>
</tr>
<tr>
<td width="89">GET</td>
<td width="132">/admin/posts</td>
<td width="54">index</td>
<td width="126">posts_path</td>
</tr>
<tr>
<td width="89">GET</td>
<td width="132">/admin/posts/new</td>
<td width="54">new</td>
<td width="126">new_post_path</td>
</tr>
<tr>
<td width="89">POST</td>
<td width="132">/admin/posts</td>
<td width="54">create</td>
<td width="126">posts_path</td>
</tr>
<tr>
<td width="89">GET</td>
<td width="132">/admin/posts/:id</td>
<td width="54">show</td>
<td width="126">post_path(:id)</td>
</tr>
<tr>
<td width="89">GET</td>
<td width="132">/admin/posts/:id/edit</td>
<td width="54">edit</td>
<td width="126">edit_post_path(:id)</td>
</tr>
<tr>
<td width="89">PUT</td>
<td width="132">/admin/posts/:id</td>
<td width="54">update</td>
<td width="126">post_path(:id)</td>
</tr>
<tr>
<td width="89">DELETE</td>
<td width="132">/admin/posts/:id</td>
<td width="54">destroy</td>
<td width="126">post_path(:id)</td>
</tr>
</tbody>
</table>


<h4><a name="nested-resources"></a>2.7 Nested Resources<span style="font-family: WenQuanYi Micro Hei;"><tt>嵌套</tt></span><tt>Resource</tt></h4>


<p>It’s common to have resources that are logically children of other resources. For example, suppose your application includes these models:</p>

<p><span style="font-family: DejaVu Sans;"><tt>在通常情况中有</tt></span><tt>resources</tt><span style="font-family: DejaVu Sans;"><tt>是其他的</tt></span><tt>resources</tt><span style="font-family: DejaVu Sans;"><tt>逻辑上的</tt></span><tt>children</tt><span style="font-family: DejaVu Sans;"><tt>。例如，假设你的应用程序包含这些</tt></span><tt>models</tt><span style="font-family: DejaVu Sans;"><tt>：</tt></span></p>

<p><tt>class</tt><tt> </tt><tt>Magazine</tt><tt> </tt><tt>&lt;</tt><tt> </tt><tt>ActiveRecord::Base</tt></p>

<p><tt> </tt><tt>has_many</tt><tt> </tt><tt>:ads</tt></p>

<p><tt>end</tt></p>

<p>&nbsp;</p>

<p><tt>class</tt><tt> </tt><tt>Ad</tt><tt> </tt><tt>&lt;</tt><tt> </tt><tt>ActiveRecord::Base</tt></p>

<p><tt> </tt><tt>belongs_to</tt><tt> </tt><tt>:magazine</tt></p>

<p><tt>end</tt></p>

<p><tt>Nested</tt><tt> </tt><tt>routes</tt><tt> </tt><tt>allow</tt><tt> </tt><tt>you</tt><tt> </tt><tt>to</tt><tt> </tt><tt>capture</tt><tt> </tt><tt>this</tt><tt> </tt><tt>relationship</tt><tt> </tt><tt>in</tt><tt> </tt><tt>your</tt><tt> </tt><tt>routing.</tt><tt> </tt><tt>In</tt><tt> </tt><tt>this</tt><tt> </tt><tt>case,</tt><tt> </tt><tt>you</tt><tt> </tt><tt>could</tt><tt> </tt><tt>include</tt><tt> </tt><tt>this</tt><tt> </tt><tt>route</tt><tt> </tt><tt>declaration:</tt></p>

<p><span style="font-family: DejaVu Sans;"><tt>嵌套</tt></span><tt>routes</tt><span style="font-family: DejaVu Sans;"><tt>允许你捕捉这些关系在你的</tt></span><tt>routing</tt><span style="font-family: DejaVu Sans;"><tt>中。在这里的情况中，你可包含这样的声明：</tt></span></p>

<p><tt>resources</tt><tt> </tt><tt>:magazines</tt><tt> </tt><tt>do</tt></p>

<p><tt> </tt><tt>resources</tt><tt> </tt><tt>:ads</tt></p>

<p><tt>end</tt></p>

<p><tt>In</tt><tt> </tt><tt>addition</tt><tt> </tt><tt>to</tt><tt> </tt><tt>the</tt><tt> </tt><tt>routes</tt><tt> </tt><tt>for</tt><tt> </tt><tt>magazines,</tt><tt> </tt><tt>this</tt><tt> </tt><tt>declaration</tt><tt> </tt><tt>will</tt><tt> </tt><tt>also</tt><tt> </tt><tt>route</tt><tt> </tt><tt>ads</tt><tt> </tt><tt>to</tt><tt> </tt><tt>an</tt><tt> </tt><tt>AdsController.</tt><tt> </tt><tt>The</tt><tt> </tt><tt>ad</tt><tt> </tt><tt>URLs</tt><tt> </tt><tt>require</tt><tt> </tt><tt>a</tt><tt> </tt><tt>magazine:</tt></p>

<p><span style="font-family: DejaVu Sans;"><tt>除了</tt><tt></tt></span><tt>magazines</tt><span style="font-family: DejaVu Sans;"><tt>的</tt></span><tt>routes</tt><span style="font-family: DejaVu Sans;"><tt>，这里也同样声明</tt></span><tt>route</tt><tt> </tt><tt>ads</tt><span style="font-family: DejaVu Sans;"><tt>到</tt><tt></tt></span><tt>AdsController</tt><span style="font-family: DejaVu Sans;"><tt>。</tt></span><tt>ad</tt><span style="font-family: DejaVu Sans;"><tt>的</tt></span><tt>URLs</tt><span style="font-family: DejaVu Sans;"><tt>需要一个</tt><tt></tt></span><tt>magazine</tt><span style="font-family: DejaVu Sans;"><tt>（对象）：</tt></span></p>

<p>&nbsp;</p>

<table width="665" cellspacing="0" cellpadding="2"><colgroup><col width="82" /> <col width="144" /> <col width="53" /> <col width="371" /> </colgroup>
<tbody>
<tr>
<th width="82">HTTP Verb</th>
<th width="144">Path</th>
<th width="53">action</th>
<th width="371">used for</th>
</tr>
<tr>
<td width="82">GET</td>
<td width="144">/magazines/:id/ads</td>
<td width="53">index</td>
<td width="371">display a list of all ads for a specific magazine</td>
</tr>
<tr>
<td width="82">GET</td>
<td width="144">/magazines/:id/ads/new</td>
<td width="53">new</td>
<td width="371">return an HTML form for creating a new ad belonging to a specific magazine</td>
</tr>
<tr>
<td width="82">POST</td>
<td width="144">/magazines/:id/ads</td>
<td width="53">create</td>
<td width="371">create a new ad belonging to a specific magazine</td>
</tr>
<tr>
<td width="82">GET</td>
<td width="144">/magazines/:id/ads/:id</td>
<td width="53">show</td>
<td width="371">display a specific ad belonging to a specific magazine</td>
</tr>
<tr>
<td width="82">GET</td>
<td width="144">/magazines/:id/ads/:id/edit</td>
<td width="53">edit</td>
<td width="371">return an HTML form for editing an ad belonging to a specific magazine</td>
</tr>
<tr>
<td width="82">PUT</td>
<td width="144">/magazines/:id/ads/:id</td>
<td width="53">update</td>
<td width="371">update a specific ad belonging to a specific magazine</td>
</tr>
<tr>
<td width="82">DELETE</td>
<td width="144">/magazines/:id/ads/:id</td>
<td width="53">destroy</td>
<td width="371">delete a specific ad belonging to a specific magazine</td>
</tr>
</tbody>
</table>


<p>This will also create routing helpers such as magazine_ads_url and edit_magazine_ad_path. These helpers take an instance of Magazine as the first parameter (magazine_ads_url(@magazine)).</p>

<p><span style="font-family: DejaVu Sans;"><tt>这里也将会创建</tt></span><tt>routing</tt><tt> </tt><tt>helpers</tt><span style="font-family: DejaVu Sans;"><tt>例如</tt><tt></tt></span><tt>magazine_ads_url</tt><span style="font-family: DejaVu Sans;"><tt>和</tt><tt></tt></span><tt>edit_magazine_ad_path</tt><span style="font-family: DejaVu Sans;"><tt>。这些</tt></span><tt>helpers</tt><span style="font-family: DejaVu Sans;"><tt>获取一个</tt><tt></tt></span><tt>Magazine</tt><span style="font-family: DejaVu Sans;"><tt>的实例作为第一个参数（</tt></span><tt>magazine_ads_url(@magazine)</tt><span style="font-family: DejaVu Sans;"><tt>）。</tt></span></p>

<h5><a name="limits-to-nesting"></a><tt>2.7.1</tt><tt> </tt><tt>Limits</tt><tt> </tt><tt>to</tt><tt> </tt><tt>Nesting</tt><span style="font-family: WenQuanYi Micro Hei;"><tt>嵌套的局限</tt></span></h5>


<p>You can nest resources within other nested resources if you like. For example:</p>

<p><span style="font-family: DejaVu Sans;"><tt>你可以嵌套</tt></span><tt>resources</tt><span style="font-family: DejaVu Sans;"><tt>在其他嵌套</tt></span><tt>resources</tt><span style="font-family: DejaVu Sans;"><tt>中如果你喜欢。例如：</tt></span></p>

<p><tt>resources</tt><tt> </tt><tt>:publishers</tt><tt> </tt><tt>do</tt></p>

<p><tt> </tt><tt>resources</tt><tt> </tt><tt>:magazines</tt><tt> </tt><tt>do</tt></p>

<p><tt> </tt><tt>resources</tt><tt> </tt><tt>:photos</tt></p>

<p><tt> </tt><tt>end</tt></p>

<p><tt>end</tt></p>

<p><tt>Deeply-nested</tt><tt> </tt><tt>resources</tt><tt> </tt><tt>quickly</tt><tt> </tt><tt>become</tt><tt> </tt><tt>cumbersome.</tt><tt> </tt><tt>In</tt><tt> </tt><tt>this</tt><tt> </tt><tt>case,</tt><tt> </tt><tt>for</tt><tt> </tt><tt>example,</tt><tt> </tt><tt>the</tt><tt> </tt><tt>application</tt><tt> </tt><tt>would</tt><tt> </tt><tt>recognize</tt><tt> </tt><tt>paths</tt><tt> </tt><tt>such</tt><tt> </tt><tt>as</tt></p>

<p><span style="font-family: DejaVu Sans;"><tt>深层的嵌套</tt></span><tt>resources</tt><span style="font-family: DejaVu Sans;"><tt>相当的累赘。在这样的情况下，例如，应用程序将会这样组织路径</tt></span></p>

<pre><tt>/publishers/1/magazines/2/photos/3</tt></pre>


<p><tt>The</tt><tt> </tt><tt>corresponding</tt><tt> </tt><tt>route</tt><tt> </tt><tt>helper</tt><tt> </tt><tt>would</tt><tt> </tt><tt>be</tt><tt> </tt><tt>publisher_magazine_photo_url,</tt><tt> </tt><tt>requiring</tt><tt> </tt><tt>you</tt><tt> </tt><tt>to</tt><tt> </tt><tt>specify</tt><tt> </tt><tt>objects</tt><tt> </tt><tt>at</tt><tt> </tt><tt>all</tt><tt> </tt><tt>three</tt><tt> </tt><tt>levels.</tt><tt> </tt><tt>Indeed,</tt><tt> </tt><tt>this</tt><tt> </tt><tt>situation</tt><tt> </tt><tt>is</tt><tt> </tt><tt>confusing</tt><tt> </tt><tt>enough</tt><tt> </tt><tt>that</tt><tt> </tt><tt>a</tt><tt> </tt><tt>popular</tt><tt> </tt><span style="color: #000080;"><span style="text-decoration: underline;"><a href="http://weblog.jamisbuck.org/2007/2/5/nesting-resources">article</a></span></span><tt> </tt><tt>by</tt><tt> </tt><tt>Jamis</tt><tt> </tt><tt>Buck</tt><tt> </tt><tt>proposes</tt><tt> </tt><tt>a</tt><tt> </tt><tt>rule</tt><tt> </tt><tt>of</tt><tt> </tt><tt>thumb</tt><tt> </tt><tt>for</tt><tt> </tt><tt>good</tt><tt> </tt><tt>Rails</tt><tt> </tt><tt>design:</tt></p>

<p><span style="font-family: DejaVu Sans;"><tt>相应的</tt></span><tt>route</tt><tt> </tt><tt>helper</tt><span style="font-family: DejaVu Sans;"><tt>将会是</tt><tt></tt></span><tt>publisher_magazine_photo_url</tt><span style="font-family: DejaVu Sans;"><tt>这需要你指定三个级别的所有对象。事实上，这种情况下太混乱了一篇受欢迎的文章来自</tt></span><tt>Jamis</tt><tt> </tt><tt>Buck</tt><span style="font-family: DejaVu Sans;"><tt>，关于一个设计良好的</tt></span><tt>Rails</tt><span style="font-family: DejaVu Sans;"><tt>的经验法则：</tt></span></p>

<p><em><strong>Resources</strong></em><em><strong> </strong></em><em><strong>should</strong></em><em><strong> </strong></em><em><strong>never</strong></em><em><strong> </strong></em><em><strong>be</strong></em><em><strong> </strong></em><em><strong>nested</strong></em><em><strong> </strong></em><em><strong>more</strong></em><em><strong> </strong></em><em><strong>than</strong></em><em><strong> </strong></em><em><strong>1</strong></em><em><strong> </strong></em><em><strong>level</strong></em><em><strong> </strong></em><em><strong>deep.</strong></em></p>

<h4><a name="creating-paths-and-urls-from-objects"></a> <tt>2.8</tt><tt> </tt><tt>Creating</tt><tt> </tt><tt>Paths</tt><tt> </tt><tt>and</tt><tt> </tt><tt>URLs</tt><tt> </tt><tt>From</tt><tt> </tt><tt>Objects</tt></h4>


<p>In addition to using the routing helpers, Rails can also create paths and URLs from an array of parameters. For example, suppose you have this set of routes:</p>

<p><span style="font-family: DejaVu Sans;">除了使用</span>routing helpers<span style="font-family: DejaVu Sans;">，</span>Rails<span style="font-family: DejaVu Sans;">也可以从一个</span>parameters<span style="font-family: DejaVu Sans;">数组创建</span>paths<span style="font-family: DejaVu Sans;">和</span>URLs<span style="font-family: DejaVu Sans;">。例如，假设你有这样的组</span>routes<span style="font-family: DejaVu Sans;">：</span></p>

<p>resources :magazines do</p>

<p>resources :ads</p>

<p>end</p>

<p>When using <tt> </tt><tt>magazine_ad_path</tt>, you can pass in instances of <tt> </tt><tt>Magazine</tt><tt> </tt><tt>and</tt><tt> </tt><tt>Ad</tt> instead of the numeric IDs.</p>

<p><span style="font-family: DejaVu Sans;">在使用</span><tt>magazine_ad_path</tt><span style="font-family: DejaVu Sans;"><tt>的时候，你可以传递</tt><tt></tt></span><tt>Magazine</tt><tt> </tt><tt>and</tt><tt> </tt><tt>Ad</tt><span style="font-family: DejaVu Sans;"><tt>的实例替代数字</tt></span><tt>IDs</tt><span style="font-family: DejaVu Sans;"><tt>。</tt></span></p>

<p>&lt;%= link_to &ldquo;Ad details&rdquo;, magazine_ad_path(@magazine, @ad) %&gt;</p>

<p>You can also use <tt>url_for</tt> with a set of objects, and Rails will automatically determine which route you want:</p>

<p><span style="font-family: DejaVu Sans;">你同样也可以使用</span><tt>url_for</tt><span style="font-family: DejaVu Sans;"><tt>和一组对象，那么</tt></span><tt>Rails</tt><span style="font-family: DejaVu Sans;"><tt>将会自动的决定那个</tt></span><tt>route</tt><span style="font-family: DejaVu Sans;"><tt>是你希望的：</tt></span></p>

<p>&lt;%= link_to &ldquo;Ad details&rdquo;, url_for([@magazine, @ad]) %&gt;</p>

<p>In this case, Rails will see that <tt>@magazine</tt> is a <tt> </tt><tt>Magazine</tt> and <tt>@ad</tt> is an <tt>Ad</tt> and will therefore use the <tt>magazine_ad_path</tt> helper. In helpers like <tt>link_to</tt>, you can specify just the object in place of the full <tt>url_for</tt> call:</p>

<p><span style="font-family: DejaVu Sans;">在这里，</span>Rails<span style="font-family: DejaVu Sans;">将会明白</span><tt>@magazine</tt><span style="font-family: DejaVu Sans;"><tt>是</tt><tt></tt></span><tt>Magazine</tt><span style="font-family: DejaVu Sans;"><tt>并且</tt></span><tt>@ad</tt><span style="font-family: DejaVu Sans;"><tt>是</tt></span><tt>Ad</tt><span style="font-family: DejaVu Sans;"><tt>于此将会因此使用</tt><tt></tt></span><tt>magazine_ad_path</tt><tt> </tt><tt>helper</tt><span style="font-family: DejaVu Sans;"><tt>。在就像</tt></span><tt>link_to</tt><span style="font-family: DejaVu Sans;"><tt>的</tt></span><tt>helpers</tt><span style="font-family: DejaVu Sans;"><tt>中，你可以指定仅仅对象在</tt></span><tt>url_for</tt><span style="font-family: DejaVu Sans;"><tt>调用中：</tt></span></p>

<p>&lt;%= link_to &ldquo;Ad details&rdquo;, [@magazine, @ad] %&gt;</p>

<p>If you wanted to link to just a magazine, you could leave out the <tt>Array</tt>:</p>

<p><span style="font-family: DejaVu Sans;">如果你想仅仅</span>link<span style="font-family: DejaVu Sans;">到一个</span>magazine<span style="font-family: DejaVu Sans;">，你可以省去数组：</span></p>

<p>&lt;%= link_to &ldquo;Magazine details&rdquo;, @magazine %&gt;</p>

<p>This allows you to treat instances of your models as URLs, and is a key advantage to using the resourceful style.</p>

<p><a name="adding-more-restful-actions"></a><span style="font-family: DejaVu Sans;">这让你处理</span>models<span style="font-family: DejaVu Sans;">的实例为</span>URLs<span style="font-family: DejaVu Sans;">，并且这也是使用</span>resourceful style<span style="font-family: DejaVu Sans;">的关键优势。</span></p>

<h4><a name="adding-more-restful-actions1"></a>2.9 Adding More RESTful Actions<span style="font-family: WenQuanYi Micro Hei;">添加更多的</span>RESTful Action</h4>


<p>You are not limited to the seven routes that RESTful routing creates by default. If you like, you may add additional routes that apply to the collection or individual members of the collection.</p>

<p><span style="font-family: DejaVu Sans;">你并不限制于</span>RESTful routing<span style="font-family: DejaVu Sans;">默认创建的七个</span>routes<span style="font-family: DejaVu Sans;">。如果你喜欢，你可以添加额外的</span>routes<span style="font-family: DejaVu Sans;">用于多个或者个别的</span>collection<span style="font-family: DejaVu Sans;">。</span></p>

<h5><a name="adding-member-routes"></a>2.9.1 Adding Member Routes</h5>


<p>To add a member route, just add a <tt>member</tt> block into the resource block:</p>

<p><span style="font-family: DejaVu Sans;">添加一个</span>member route<span style="font-family: DejaVu Sans;">，仅仅添加一个</span>member<span style="font-family: DejaVu Sans;">的</span>block<span style="font-family: DejaVu Sans;">到</span>resource block<span style="font-family: DejaVu Sans;">中：</span></p>

<p>resources :photos do</p>

<p>member do</p>

<p>get &lsquo;preview&rsquo;</p>

<p>end</p>

<p>end</p>

<p>This will recognize <tt>/photos/1/preview</tt> with GET, and route to the <tt>preview</tt> action of <tt>PhotosController</tt>. It will also create the <tt>preview_photo_url</tt> and <tt>preview_photo_path</tt> helpers.</p>

<p>Within the block of member routes, each route name specifies the HTTP verb that it will recognize. You can use <tt>get</tt>, <tt>put</tt>, <tt>post</tt>, or <tt>delete</tt> here. If you don’t have multiple <tt>member</tt> routes, you can also pass <tt>:on</tt> to a route, eliminating the block:</p>

<p><span style="font-family: DejaVu Sans;">在</span>member<span style="font-family: DejaVu Sans;">的</span>routes<span style="font-family: DejaVu Sans;">中，每个</span>route<span style="font-family: DejaVu Sans;">名字指定</span>HTTP verb<span style="font-family: DejaVu Sans;">这是将会组织的。在这里你可以使用</span><tt>get</tt>, <tt>put</tt>, <tt>post</tt>, or <tt>delete</tt><span style="font-family: DejaVu Sans;"><tt>。如果你没有多个</tt></span><tt>member</tt><tt> </tt><tt>routes</tt><span style="font-family: DejaVu Sans;"><tt>，你同样也可以传递</tt></span><tt>:on</tt><span style="font-family: DejaVu Sans;"><tt>到一个</tt></span><tt>route</tt><span style="font-family: DejaVu Sans;"><tt>，消除</tt></span><tt>block</tt><span style="font-family: DejaVu Sans;"><tt>：</tt></span></p>

<p>resources :photos do</p>

<p>get &lsquo;preview&rsquo;, :on =&gt; :member</p>

<p>end</p>

<h5><a name="adding-collection-routes"></a>2.9.2 Adding Collection Routes</h5>


<p>To add a route to the collection:</p>

<p><span style="font-family: DejaVu Sans;">添加一个</span>route<span style="font-family: DejaVu Sans;">到</span>collection<span style="font-family: DejaVu Sans;">：</span></p>

<p>resources :photos do</p>

<p>collection do</p>

<p>get &lsquo;search&rsquo;</p>

<p>end</p>

<p>end</p>

<p>This will enable Rails to recognize paths such as <tt>/photos/search</tt> with GET, and route to the <tt>search</tt> action of <tt>PhotosController</tt>. It will also create the <tt>search_photos_url</tt> and <tt>search_photos_path</tt> route helpers.</p>

<p><span style="font-family: DejaVu Sans;">这将使</span>Rails<span style="font-family: DejaVu Sans;">能够像这样</span><tt>/photos/search</tt> with GET<span style="font-family: DejaVu Sans;">组织路径，并且</span>route<span style="font-family: DejaVu Sans;">到</span><tt>PhotosController</tt><span style="font-family: DejaVu Sans;"><tt>的</tt></span><tt>search</tt><tt> </tt><tt>action</tt><span style="font-family: DejaVu Sans;"><tt>。它将同样创建</tt><tt></tt></span><tt>search_photos_url</tt><span style="font-family: DejaVu Sans;"><tt>和</tt><tt></tt></span><tt>search_photos_path</tt><tt> </tt><tt>route</tt><tt> </tt><tt>helpers</tt><span style="font-family: DejaVu Sans;"><tt>。</tt></span></p>

<p>Just as with member routes, you can pass <tt>:on</tt> to a route:</p>

<p><span style="font-family: DejaVu Sans;">仅仅对于</span>member routes<span style="font-family: DejaVu Sans;">，你可以传递</span>:on<span style="font-family: DejaVu Sans;">给一个</span>route<span style="font-family: DejaVu Sans;">：</span></p>

<p>resources :photos do</p>

<p>get &lsquo;search&rsquo;, :on =&gt; :collection</p>

<p>end</p>

<h5><a name="a-note-of-caution"></a>2.9.3 A Note of Caution<span style="font-family: WenQuanYi Micro Hei;">一个慎重的提醒</span></h5>


<p>If you find yourself adding many extra actions to a resourceful route, it’s time to stop and ask yourself whether you’re disguising the presence of another resource.</p>

<p><span style="font-family: DejaVu Sans;">如果你发现你自己添加很多额外的</span>action<span style="font-family: DejaVu Sans;">到一个</span>resourceful<span style="font-family: DejaVu Sans;">的</span>route<span style="font-family: DejaVu Sans;">，是时候停下来并问你自己</span></p>

<p><a name="result_box"></a><span style="font-family: DejaVu Sans;">是否你在伪造另一个</span>resource<span style="font-family: DejaVu Sans;">。</span></p>

<h3><a name="non-resourceful-routes"></a>3 Non-Resourceful Routes<span style="font-family: WenQuanYi Micro Hei;">非</span>- Resourceful Routes</h3>


<p>In addition to resource routing, Rails has powerful support for routing arbitrary URLs to actions. Here, you don’t get groups of routes automatically generated by resourceful routing. Instead, you set up each route within your application separately.</p>

<p><span style="font-family: DejaVu Sans;">除了</span>resource routing<span style="font-family: DejaVu Sans;">，</span>Rails<span style="font-family: DejaVu Sans;">对任意的</span>URLs<span style="font-family: DejaVu Sans;">到</span>actions<span style="font-family: DejaVu Sans;">有强力的支持。这里，你没有得到被</span>resourceful routing<span style="font-family: DejaVu Sans;">自动创建的</span>groups of routes<span style="font-family: DejaVu Sans;">。作为替代，在你的应用程序中分别设置每个</span>route<span style="font-family: DejaVu Sans;">。</span></p>

<p>While you should usually use resourceful routing, there are still many places where the simpler routing is more appropriate. There’s no need to try to shoehorn every last piece of your application into a resourceful framework if that’s not a good fit.</p>

<p><span style="font-family: DejaVu Sans;">即使你应该通常使用</span>resourceful routing<span style="font-family: DejaVu Sans;">，这里仍然有很多地方简单的</span>routing<span style="font-family: DejaVu Sans;">更加适合。这里不需要尝试将你的应用程序最后写成一个</span>resourceful framework<span style="font-family: DejaVu Sans;">如果这样并不合适。</span></p>

<p>In particular, simple routing makes it very easy to map legacy URLs to new Rails actions.</p>

<p><a name="result_box1"></a><span style="font-family: DejaVu Sans;">特别是，简单的路</span>routing<span style="font-family: DejaVu Sans;">，使得它很容易映射（传入的）现有的</span>URL<span style="font-family: DejaVu Sans;">映射到新的</span>Rails action<span style="font-family: DejaVu Sans;">。</span></p>

<h4><a name="bound-parameters"></a>3.1 Bound Parameters<span style="font-family: WenQuanYi Micro Hei;">绑定参数</span></h4>


<p>When you set up a regular route, you supply a series of symbols that Rails maps to parts of an incoming HTTP request. Two of these symbols are special: <tt>:controller</tt> maps to the name of a controller in your application, and <tt>:action</tt> maps to the name of an action within that controller. For example, consider one of the default Rails routes:</p>

<p><span style="font-family: DejaVu Sans;">当你设定一个正则</span>route<span style="font-family: DejaVu Sans;">，你供应一系列的字符，其将通过</span>Rails<span style="font-family: DejaVu Sans;">映射到传入</span>HTTP<span style="font-family: DejaVu Sans;">请求的一部分。这些字符的两部分分别是：</span><tt>:controller</tt><span style="font-family: DejaVu Sans;"><tt>映射到你应用程序中的一个</tt></span><tt>controller</tt><span style="font-family: DejaVu Sans;"><tt>，并且</tt></span><tt>:action</tt><span style="font-family: DejaVu Sans;"><tt>映射到在指定的</tt></span><tt>controller</tt><span style="font-family: DejaVu Sans;"><tt>中的一个</tt></span><tt>action</tt><span style="font-family: DejaVu Sans;"><tt>。例如思考一个默认的</tt></span><tt>Rails</tt><tt> </tt><tt>routes</tt><span style="font-family: DejaVu Sans;"><tt>：</tt></span></p>

<p>match &lsquo;:controller(/:action(/:id))&rsquo;</p>

<p>If an incoming request of <tt>/photos/show/1</tt> is processed by this route (because it hasn’t matched any previous route in the file), then the result will be to invoke the <tt>show</tt> action of the <tt> </tt><tt>PhotosController</tt>, and to make the final parameter <tt>&ldquo;1&rdquo;</tt> available as <tt>params[:id]</tt>. This route will also route the incoming request of <tt>/photos</tt> to <tt>PhotosController#index</tt>, since <tt>:action</tt> and <tt>:id</tt> are optional parameters, denoted by parentheses.</p>

<p><span style="font-family: DejaVu Sans;">如果传入请求</span><tt>/photos/show/1</tt><tt> </tt><tt>is</tt><tt> </tt><tt>processed</tt><tt> </tt><tt>by</tt><tt> </tt><tt>this</tt><tt> </tt><tt>route</tt><tt> </tt><span style="font-family: DejaVu Sans;"><tt>（因为它并没有被先前的</tt></span><tt>route</tt><span style="font-family: DejaVu Sans;"><tt>文件中任何的</tt></span><tt>route</tt><span style="font-family: DejaVu Sans;"><tt>匹配成功），接着这个结果将会调用</tt><tt></tt></span><tt>PhotosController</tt><span style="font-family: DejaVu Sans;"><tt>的</tt></span><tt>show</tt><tt> </tt><tt>action</tt><span style="font-family: DejaVu Sans;"><tt>，并且使得最后的参数</tt><tt><span style="font-family: Liberation Serif,Times New Roman,serif;">”</span></tt></span><tt>1</tt><tt>”</tt><span style="font-family: DejaVu Sans;"><tt>可用于</tt></span><tt>params[:id]</tt><span style="font-family: DejaVu Sans;"><tt>。这个</tt></span><tt>route</tt><span style="font-family: DejaVu Sans;"><tt>也还会</tt></span><tt>route</tt><span style="font-family: DejaVu Sans;"><tt>传入请求</tt></span><tt>/photos</tt><span style="font-family: DejaVu Sans;"><tt>到</tt></span><tt>PhotosController#index</tt><span style="font-family: DejaVu Sans;"><tt>，因为</tt></span><tt>:action</tt><span style="font-family: DejaVu Sans;"><tt>和</tt></span><tt>:id</tt><span style="font-family: DejaVu Sans;"><tt>是被括号包起来的可选参数。</tt></span></p>

<h4><a name="dynamic-segments"></a>3.2 Dynamic Segments<span style="font-family: WenQuanYi Micro Hei;">动态分割</span></h4>


<p>You can set up as many dynamic segments within a regular route as you like. Anything other than <tt>:controller</tt> or <tt>:action</tt> will be available to the action as part of <tt>params</tt>. If you set up this route:</p>

<p><span style="font-family: DejaVu Sans;">你可以设置你希望的数目的</span>dynamic segments<span style="font-family: DejaVu Sans;">在一个正则</span>route<span style="font-family: DejaVu Sans;">中。超过</span><tt>:controller</tt> or <tt>:action</tt><span style="font-family: DejaVu Sans;"><tt>的其他部分（是可用的）在</tt></span><tt>action</tt><span style="font-family: DejaVu Sans;"><tt>作为</tt></span><tt>params</tt><span style="font-family: DejaVu Sans;"><tt>第一部分。如果你设定这样的</tt></span><tt>route</tt><span style="font-family: DejaVu Sans;"><tt>：</tt></span></p>

<p><tt>match</tt><tt> </tt><tt>&lsquo;:controller/:action/:id/:user_id&rsquo;</tt></p>

<p>An incoming path of <tt>/photos/show/&frac12;</tt> will be dispatched to the <tt>show</tt> action of the <tt>PhotosController</tt>. <tt>params[:id]</tt> will be <tt>&ldquo;1&rdquo;</tt>, and <tt>params[:user_id]</tt> will be <tt>&ldquo;2&rdquo;</tt>.</p>

<p><span style="font-family: DejaVu Sans;">一个传入路径</span><tt>/photos/show/&frac12;</tt><span style="font-family: DejaVu Sans;"><tt>将会被调度给</tt></span><tt>PhotosController</tt><span style="font-family: DejaVu Sans;"><tt>的</tt></span><tt>show</tt><tt> </tt><tt>action</tt><span style="font-family: DejaVu Sans;"><tt>。</tt></span><tt>params[:id]</tt><tt> </tt><tt>will</tt><tt> </tt><tt>be</tt><tt> </tt><tt>&ldquo;1&rdquo;,</tt><tt> </tt><tt>and</tt><tt> </tt><tt>params[:user_id]</tt><tt> </tt><tt>will</tt><tt> </tt><tt>be</tt><tt> </tt><tt>&ldquo;2&rdquo;.</tt></p>

<p>You can’t use <tt>namespace</tt> or <tt>:module</tt> with a <tt>:controller</tt> path segment. If you need to do this then use a constraint on :controller that matches the namespace you require. e.g:</p>

<p><span style="font-family: DejaVu Sans;">你不能对一个</span><tt>:controller</tt><span style="font-family: DejaVu Sans;"><tt>路径</tt></span><tt>segment</tt><span style="font-family: DejaVu Sans;"><tt>使用</tt></span><tt>namespace</tt><span style="font-family: DejaVu Sans;"><tt>或者</tt></span><tt>:module</tt><span style="font-family: DejaVu Sans;"><tt>。如果你需要这么做那么使用对</tt><tt></tt></span><tt>:controller</tt><span style="font-family: DejaVu Sans;"><tt>一个限制使其匹配你请求的</tt></span><tt>namespace</tt><span style="font-family: DejaVu Sans;"><tt>。例如：</tt></span></p>

<p><tt>match</tt><tt> </tt><tt>&lsquo;:controller(/:action(/:id))&rsquo;,</tt><tt> </tt><tt>:controller</tt><tt> </tt><tt>=&gt;</tt><tt> </tt><tt>/admin\/[^\/]+/</tt></p>

<p>&nbsp;</p>

<p>By default dynamic segments don’t accept dots – this is because the dot is used as a separator for formatted routes. If you need to use a dot within a dynamic segment add a constraint which overrides this – for example <tt>:id</tt> =&gt; /[^\/]+/ allows anything except a slash.</p>

<p><span style="font-family: DejaVu Sans;">默认的动态分割不接受</span>dots<span style="font-family: DejaVu Sans;">（</span>.<span style="font-family: DejaVu Sans;">）<span style="font-family: Liberation Serif,Times New Roman,serif;">——</span>这是因为</span>dot<span style="font-family: DejaVu Sans;">被作为格式化</span>routes<span style="font-family: DejaVu Sans;">的一个分割。如果你需要在一个</span>dynamic segment<span style="font-family: DejaVu Sans;">中使用</span>dot<span style="font-family: DejaVu Sans;">，添加一个限制来重写它<span style="font-family: Liberation Serif,Times New Roman,serif;">——</span>例如</span><tt>:id</tt> =&gt; /[^\/]+/<span style="font-family: DejaVu Sans;">允许除了斜线之外的任何字符。</span></p>

<h4><a name="static-segments"></a>3.3 Static Segments</h4>


<p>You can specify static segments when creating a route:</p>

<p>match &lsquo;:controller/:action/:id/with_user/:user_id&rsquo;</p>

<p>This route would respond to paths such as <tt>/photos/show/1/with_user/2</tt>. In this case, <tt>params</tt> would be <tt>{</tt><tt> </tt><tt>:controller</tt><tt> </tt><tt>=&gt;</tt><tt> “</tt><tt>photos</tt><tt>”</tt><tt>,</tt><tt> </tt><tt>:action</tt><tt> </tt><tt>=&gt;</tt><tt> “</tt><tt>show</tt><tt>”</tt><tt>,</tt><tt> </tt><tt>:id</tt><tt> </tt><tt>=&gt;</tt><tt> “</tt><tt>1</tt><tt>”</tt><tt>,</tt><tt> </tt><tt>:user_id</tt><tt> </tt><tt>=&gt;</tt><tt> “</tt><tt>2</tt><tt>” </tt><tt>}</tt>.</p>

<h4><a name="the-query-string"></a>3.4 The Query String<span style="font-family: WenQuanYi Micro Hei;">查询字符串</span></h4>


<p>The <tt>params</tt> will also include any parameters from the query string. For example, with this route:</p>

<p>params<span style="font-family: DejaVu Sans;">将也会包含来自查询字符串的任何参数。例如，使用这个</span>route<span style="font-family: DejaVu Sans;">：</span></p>

<p>match &lsquo;:controller/:action/:id&rsquo;</p>

<p>An incoming path of <tt>/photos/show/1?user_id=2</tt> will be dispatched to the <tt>show</tt> action of the <tt>Photos</tt> controller. <tt>params</tt> will be <tt>{</tt><tt> </tt><tt>:controller</tt><tt> </tt><tt>=&gt;</tt><tt> “</tt><tt>photos</tt><tt>”</tt><tt>,</tt><tt> </tt><tt>:action</tt><tt> </tt><tt>=&gt;</tt><tt> “</tt><tt>show</tt><tt>”</tt><tt>,</tt><tt> </tt><tt>:id</tt><tt> </tt><tt>=&gt;</tt><tt> “</tt><tt>1</tt><tt>”</tt><tt>,</tt><tt> </tt><tt>:user_id</tt><tt> </tt><tt>=&gt;</tt><tt> “</tt><tt>2</tt><tt>” </tt><tt>}</tt>.</p>

<p><span style="font-family: DejaVu Sans;">一个传入路径</span><tt>/photos/show/1?user_id=2</tt><span style="font-family: DejaVu Sans;"><tt>将会被调度给</tt><tt></tt></span><tt>Photos</tt><tt> </tt><tt>controller</tt><span style="font-family: DejaVu Sans;"><tt>的</tt></span><tt>show</tt><tt> </tt><tt>action</tt><span style="font-family: DejaVu Sans;"><tt>。</tt></span><tt>params</tt><span style="font-family: DejaVu Sans;"><tt>将会是</tt></span><tt>{</tt><tt> </tt><tt>:controller</tt><tt> </tt><tt>=&gt;</tt><tt> “</tt><tt>photos</tt><tt>”</tt><tt>,</tt><tt> </tt><tt>:action</tt><tt> </tt><tt>=&gt;</tt><tt> “</tt><tt>show</tt><tt>”</tt><tt>,</tt><tt> </tt><tt>:id</tt><tt> </tt><tt>=&gt;</tt><tt> “</tt><tt>1</tt><tt>”</tt><tt>,</tt><tt> </tt><tt>:user_id</tt><tt> </tt><tt>=&gt;</tt><tt> “</tt><tt>2</tt><tt>” </tt><tt>}</tt><span style="font-family: DejaVu Sans;"><tt>。</tt></span></p>

<h4><a name="defining-defaults"></a>3.5 Defining Defaults<span style="font-family: WenQuanYi Micro Hei;">默认定义</span></h4>


<p>You do not need to explicitly use the <tt>:controller</tt> and <tt>:action</tt> symbols within a route. You can supply them as defaults:</p>

<p><span style="font-family: DejaVu Sans;">你不需要准确的使用</span><tt>:controller</tt><span style="font-family: DejaVu Sans;"><tt>和</tt></span><tt>:action</tt><span style="font-family: DejaVu Sans;"><tt>字符在一个</tt></span><tt>route</tt><span style="font-family: DejaVu Sans;"><tt>中。你可以默认的提供他们：</tt></span></p>

<p>match &lsquo;photos/:id&rsquo; =&gt; &lsquo;photos#show&rsquo;</p>

<p>With this route, Rails will match an incoming path of <tt>/photos/12</tt> to the <tt>show</tt> action of <tt>PhotosController</tt>.</p>

<p><span style="font-family: DejaVu Sans;">通过这个</span>route<span style="font-family: DejaVu Sans;">，</span>Rails<span style="font-family: DejaVu Sans;">将会匹配一个传入路径</span><tt>/photos/12</tt><span style="font-family: DejaVu Sans;"><tt>到</tt><tt></tt></span><tt>PhotosController</tt><span style="font-family: DejaVu Sans;"><tt>的</tt></span><tt>show</tt><tt> </tt><tt>action</tt><span style="font-family: DejaVu Sans;"><tt>。</tt></span></p>

<p>You can also define other defaults in a route by supplying a hash for the <tt>:defaults</tt> option. This even applies to parameters that you do not specify as dynamic segments. For example:</p>

<p><span style="font-family: DejaVu Sans;"><tt>你同样也可以在</tt></span><tt>route</tt><span style="font-family: DejaVu Sans;"><tt>中定义其他的默认（设置）通过提供一个</tt></span><tt>hash</tt><span style="font-family: DejaVu Sans;"><tt>字典给</tt><tt></tt></span><tt>:defaults</tt><span style="font-family: DejaVu Sans;"><tt>选项。这甚至会应用于不需要指定参数作为动态分割。例如：</tt></span></p>

<p>match &lsquo;photos/:id&rsquo; =&gt; &lsquo;photos#show&rsquo;, :defaults =&gt; { :format =&gt; &lsquo;jpg&rsquo; }</p>

<p>Rails would match <tt>photos/12</tt> to the <tt>show</tt> action of <tt>PhotosController</tt>, and set <tt>params[:format]</tt> to <tt>&ldquo;jpg&rdquo;</tt>.</p>

<p>Rails<span style="font-family: DejaVu Sans;">将会匹配</span><tt>photos/12</tt><span style="font-family: DejaVu Sans;"><tt>到</tt><tt></tt></span><tt>PhotosController</tt><span style="font-family: DejaVu Sans;"><tt>的</tt></span><tt>show</tt><tt> </tt><tt>action</tt><span style="font-family: DejaVu Sans;"><tt>，并且设置</tt></span><tt>params[:format]</tt><tt> </tt><tt>to</tt><tt> </tt><tt>&ldquo;jpg&rdquo;</tt><span style="font-family: DejaVu Sans;"><tt>。</tt></span></p>

<h4><a name="naming-routes"></a>3.6 Naming Routes</h4>


<p>You can specify a name for any route using the <tt>:as</tt> option.</p>

<p><span style="font-family: DejaVu Sans;">你可以指定一个</span>name<span style="font-family: DejaVu Sans;">给任何</span>route<span style="font-family: DejaVu Sans;">使用</span>:as<span style="font-family: DejaVu Sans;">选项。</span></p>

<p>match &lsquo;exit&rsquo; =&gt; &lsquo;sessions#destroy&rsquo;, :as =&gt; :logout</p>

<p>This will create <tt>logout_path</tt> and <tt>logout_url</tt> as named helpers in your application. Calling <tt>logout_path</tt> will return <tt>/exit</tt></p>

<p><span style="font-family: DejaVu Sans;"><tt>这里将会在应用程序中创建</tt><tt></tt></span><tt>logout_path</tt><span style="font-family: DejaVu Sans;"><tt>和</tt></span><tt>logout_url</tt><span style="font-family: DejaVu Sans;"><tt>作为（刚才）命名的</tt></span><tt>route</tt><span style="font-family: DejaVu Sans;"><tt>的</tt></span><tt>helpers</tt><span style="font-family: DejaVu Sans;"><tt>。调用</tt></span><tt>logout_path</tt><span style="font-family: DejaVu Sans;"><tt>将会返回</tt></span><tt>/exit</tt></p>

<h4><a name="http-verb-constraints"></a>3.7 HTTP Verb Constraints <span style="font-family: WenQuanYi Micro Hei;">限定</span>HTTP <span style="font-family: WenQuanYi Micro Hei;">动作</span></h4>


<p>You can use the <tt>:via</tt> option to constrain the request to one or more HTTP methods:</p>

<p><span style="font-family: DejaVu Sans;">你可以使用</span>:via<span style="font-family: DejaVu Sans;">选项来限定请求一个或多个（</span>HTTP<span style="font-family: DejaVu Sans;">）方法：</span></p>

<p>match &lsquo;photos/show&rsquo; =&gt; &lsquo;photos#show&rsquo;, :via =&gt; :get</p>

<p>There is a shorthand version of this as well:</p>

<p><span style="font-family: DejaVu Sans;">这里的短操作版本同样也是可以的：</span></p>

<p>get &lsquo;photos/show&rsquo;</p>

<p>You can also permit more than one verb to a single route:</p>

<p><span style="font-family: DejaVu Sans;">你也可以运行超过一个动作到一个单独的</span>route<span style="font-family: DejaVu Sans;">：</span></p>

<p>match &lsquo;photos/show&rsquo; =&gt; &lsquo;photos#show&rsquo;, :via =&gt; [:get, :post]</p>

<h4><a name="segment-constraints"></a>3.8 Segment Constraints<span style="font-family: WenQuanYi Micro Hei;">分割限制</span></h4>


<p>You can use the <tt>:constraints</tt> option to enforce a format for a dynamic segment:</p>

<p><span style="font-family: DejaVu Sans;">你可以使用</span>:constraints<span style="font-family: DejaVu Sans;">选项来强制一个动态分割的格式：</span></p>

<p>match &lsquo;photos/:id&rsquo; =&gt; &lsquo;photos#show&rsquo;, :constraints =&gt; { :id =&gt; /[A-Z]\d{5}/ }</p>

<p>This route would match paths such as <tt>/photos/A12345</tt>. You can more succinctly express the same route this way:</p>

<p><span style="font-family: DejaVu Sans;">这个</span>route<span style="font-family: DejaVu Sans;">将会匹配像这样的路径</span><tt>/photos/A12345</tt><span style="font-family: DejaVu Sans;"><tt>。你可以使用这样的方式来更加简洁的表达相同的</tt></span><tt>route</tt><span style="font-family: DejaVu Sans;"><tt>：</tt></span></p>

<p>match &lsquo;photos/:id&rsquo; =&gt; &lsquo;photos#show&rsquo;, :id =&gt; /[A-Z]\d{5}/</p>

<p><tt>:constraints</tt> takes regular expressions with the restriction that regexp anchors can’t be used. For example, the following route will not work:</p>

<p><tt>:constraints</tt><span style="font-family: DejaVu Sans;"><tt>获取的正则表达式，其限定了正则表达式的锚不能被使用。例如下面的</tt></span><tt>route</tt><span style="font-family: DejaVu Sans;"><tt>将不会工作（使用了</tt></span><tt>^</tt><span style="font-family: DejaVu Sans;"><tt>锚指定从这里开始）：</tt></span></p>

<p>match &lsquo;/:id&rsquo; =&gt; &lsquo;posts#show&rsquo;, :constraints =&gt; {:id =&gt; /^\d/}</p>

<p>However, note that you don’t need to use anchors because all routes are anchored at the start.</p>

<p><span style="font-family: DejaVu Sans;">然而，注意你不需要使用锚因为所有的</span>routes<span style="font-family: DejaVu Sans;">锚定在开始位置。</span></p>

<p>For example, the following routes would allow for <tt>posts</tt> with <tt>to_param</tt> values like <tt>1-hello-world</tt> that always begin with a number and <tt>users</tt> with <tt>to_param</tt> values like <tt>david</tt> that never begin with a number to share the root namespace:</p>

<p><span style="font-family: DejaVu Sans;">例如，下面的</span>route<span style="font-family: DejaVu Sans;">将会允许</span>posts<span style="font-family: DejaVu Sans;">及</span><tt>to_param</tt><span style="font-family: DejaVu Sans;"><tt>像</tt><tt></tt></span><tt>1-hello-world</tt><span style="font-family: DejaVu Sans;"><tt>的值，其总是以一个数字和</tt></span><tt>user</tt><span style="font-family: DejaVu Sans;"><tt>（</tt></span><tt>user</tt><span style="font-family: DejaVu Sans;"><tt>的</tt></span><tt>to_param</tt><span style="font-family: DejaVu Sans;"><tt>的值就像</tt></span><tt>david</tt><span style="font-family: DejaVu Sans;"><tt>）它从不以数字开始来</tt></span><tt>share</tt><span style="font-family: DejaVu Sans;"><tt>根名称空间。</tt></span></p>

<p>match &lsquo;/:id&rsquo; =&gt; &lsquo;posts#show&rsquo;, :constraints =&gt; { :id =&gt; /\d.+/ }</p>

<p>match &lsquo;/:username&rsquo; =&gt; &lsquo;users#show&rsquo;</p>

<h4><a name="request-based-constraints"></a>3.9 Request-Based Constraints Request-Based<span style="font-family: WenQuanYi Micro Hei;">的限制</span></h4>


<p>You can also constrain a route based on any method on the <span style="color: #000080;"><span style="text-decoration: underline;"><a href="http://guides.rubyonrails.org/action_controller_overview.html#the-request-object">Request</a></span></span> object that returns a <tt>String</tt>.</p>

<p>You specify a request-based constraint the same way that you specify a segment constraint:</p>

<p><span style="font-family: DejaVu Sans;">你也可以限制一个</span>route <span style="font-family: DejaVu Sans;">基于任何方法在</span>Request<span style="font-family: DejaVu Sans;">对象时它都会返回一个</span>String<span style="font-family: DejaVu Sans;">。</span></p>

<p><span style="font-family: DejaVu Sans;">你指定一个</span>request-basedcontraint<span style="font-family: DejaVu Sans;">和你指定一个</span>segment constaint<span style="font-family: DejaVu Sans;">是一样的。</span></p>

<p>match &ldquo;photos&rdquo;, :constraints =&gt; {:subdomain =&gt; &ldquo;admin&rdquo;}</p>

<p>You can also specify constraints in a block form:</p>

<p><span style="font-family: DejaVu Sans;">你也可以指定限制在一个</span>block form<span style="font-family: DejaVu Sans;">中：</span></p>

<p>namespace :admin do</p>

<p>constraints :subdomain =&gt; &ldquo;admin&rdquo; do</p>

<p>resources :photos</p>

<p>end</p>

<p>end</p>

<h4><a name="advanced-constraints"></a>3.10 Advanced Constraints<span style="font-family: WenQuanYi Micro Hei;">高级</span>constraints</h4>


<p>If you have a more advanced constraint, you can provide an object that responds to <tt>matches?</tt> that Rails should use. Let’s say you wanted to route all users on a blacklist to the <tt>BlacklistController</tt>. You could do:</p>

<p><span style="font-family: DejaVu Sans;">如果你有一个更高级的</span>contraint<span style="font-family: DejaVu Sans;">，你可以提供一个对象，</span>Rails<span style="font-family: DejaVu Sans;">将会使用</span>matches?<span style="font-family: DejaVu Sans;">回应这个对象。</span></p>

<p><span style="font-family: DejaVu Sans;">让我来告诉你要想</span>route<span style="font-family: DejaVu Sans;">所有的用户在一个黑名单中匹配（通过</span><tt>BlacklistController</tt><span style="font-family: DejaVu Sans;"><tt>的</tt></span><code>matches?</code><span style="font-family: DejaVu Sans;"><code>方法）。你应该：</code></span></p>

<p>class BlacklistConstraint</p>

<p>def initialize</p>

<p>@ips = Blacklist.retrieve_ips</p>

<p>end</p>

<p>&nbsp;</p>

<p>def matches?(request)</p>

<p>@ips.include?(request.remote_ip)</p>

<p>end</p>

<p>end</p>

<p>&nbsp;</p>

<p>TwitterClone::Application.routes.draw do</p>

<p>match &ldquo;*path&rdquo; =&gt; &ldquo;blacklist#index&rdquo;,</p>

<p>:constraints =&gt; BlacklistConstraint.new</p>

<p>end</p>

<h4><a name="route-globbing"></a>3.11 Route Globbing</h4>


<p>Route globbing is a way to specify that a particular parameter should be matched to all the remaining parts of a route. For example</p>

<p>Route globbing<span style="font-family: DejaVu Sans;">是一种方式来指定特定的</span>paramerter<span style="font-family: DejaVu Sans;">应该被一个</span>route<span style="font-family: DejaVu Sans;">的其余的所有部分匹配。例如</span></p>

<p>match &lsquo;photos/*other&rsquo; =&gt; &lsquo;photos#unknown&rsquo;</p>

<p>This route would match <tt>photos/12</tt> or <tt>/photos/long/path/to/12</tt>, setting <tt>params[:other]</tt> to <tt>&ldquo;12&rdquo;</tt> or <tt>&ldquo;long/path/to/12&rdquo;</tt>.</p>

<p><span style="font-family: DejaVu Sans;">这个</span>route<span style="font-family: DejaVu Sans;">将会匹配</span><tt>photos/12</tt><span style="font-family: DejaVu Sans;"><tt>或者</tt></span><tt>/photos/long/path/to/12</tt><span style="font-family: DejaVu Sans;"><tt>，设置</tt></span><tt>params[:other]</tt><tt> </tt><tt>to</tt><tt> </tt><tt>&ldquo;12&rdquo;</tt><span style="font-family: DejaVu Sans;"><tt>或</tt></span><tt>&ldquo;long/path/to/12&rdquo;</tt><span style="font-family: DejaVu Sans;"><tt>。</tt></span></p>

<p>Wildcard segments can occur anywhere in a route. For example,</p>

<p><span style="font-family: DejaVu Sans;">通配符分割可以发生在一个</span>route<span style="font-family: DejaVu Sans;">的任何地方。例如，</span></p>

<p>match &lsquo;books/*section/:title&rsquo; =&gt; &lsquo;books#show&rsquo;</p>

<p>would match <tt>books/some/section/last-words-a-memoir</tt> with <tt>params[:section]</tt> equals <tt>&ldquo;some/section&rdquo;</tt>, and <tt>params[:title]</tt> equals <tt>&ldquo;last-words-a-memoir&rdquo;</tt>.</p>

<p><span style="font-family: DejaVu Sans;">将会匹配</span><tt>books/some/section/last-words-a-memoir</tt><span style="font-family: DejaVu Sans;"><tt>为</tt></span><tt>params[:section]</tt><span style="font-family: DejaVu Sans;"><tt>等于</tt></span><tt>&ldquo;some/section&rdquo;</tt><span style="font-family: DejaVu Sans;"><tt>，以及</tt></span><tt>params[:title]</tt><span style="font-family: DejaVu Sans;"><tt>相当于</tt></span><tt>&ldquo;last-words-a-memoir&rdquo;</tt><span style="font-family: DejaVu Sans;"><tt>。</tt></span></p>

<p>Technically a route can have even more than one wildcard segment. The matcher assigns segments to parameters in an intuitive way. For example,</p>

<p><span style="font-family: DejaVu Sans;">从技术上讲一个</span>route<span style="font-family: DejaVu Sans;">可以有甚至超过一个通配符的分割。</span>matcher<span style="font-family: DejaVu Sans;">分配</span>segments<span style="font-family: DejaVu Sans;">到参数是一个直观的方式。例如，</span></p>

<p>match &lsquo;<em>a/foo/</em>b&rsquo; =&gt; &lsquo;test#index&rsquo; # <tt>*a</tt><span style="font-family: DejaVu Sans;"><tt>这一部分通配为</tt></span><tt>a</tt></p>

<p>would match <tt>zoo/woo/foo/bar/baz</tt> with <tt>params[:a]</tt> equals <tt>&ldquo;zoo/woo&rdquo;</tt>, and <tt>params[:b]</tt> equals <tt>&ldquo;bar/baz&rdquo;</tt>.</p>

<p>Starting from Rails 3.1, wildcard routes will always match the optional format segment by default. For example if you have this route:</p>

<p><code>match</code><code> </code><code>&lsquo;*pages&rsquo;</code> <code>=&gt;</code><code> </code><code>&lsquo;pages#show&rsquo;</code></p>

<p><code>By</code><code> </code><code>requesting</code><code> </code><tt>&ldquo;/foo/bar.json&rdquo;</tt><code>,</code><code> </code><code>your</code><code> </code><tt>params[:pages]</tt><code> </code><code>will</code><code> </code><code>be</code><code> </code><code>equals</code><code> </code><code>to</code><code> </code><tt>&ldquo;foo/bar&rdquo;</tt><code> </code><code>with</code><code> </code><code>the</code><code> </code><code>request</code><code> </code><code>format</code><code> </code><code>of</code><code> </code><code>JSON.</code><code> </code><code>If</code><code> </code><code>you</code><code> </code><code>want</code><code> </code><code>the</code><code> </code><code>old</code><code> </code><code>3.0.x</code><code> </code><code>behavior</code><code> </code><code>back,</code><code> </code><code>you</code><code> </code><code>could</code><code> </code><code>supply</code><code> </code><tt>:format</tt><tt> </tt><tt>=&gt;</tt><tt> </tt><tt>false</tt><code> </code><code>like</code><code> </code><code>this:</code></p>

<p><code>match</code><code> </code><code>&lsquo;*pages&rsquo;</code><code> </code><code>=&gt;</code><code> </code><code>&lsquo;pages#show&rsquo;,</code><code> </code><code>:format</code><code> </code><code>=&gt;</code><code> </code><code>false</code></p>

<p><code>If</code><code> </code><code>you</code><code> </code><code>want</code><code> </code><code>to</code><code> </code><code>make</code><code> </code><code>the</code><code> </code><code>format</code><code> </code><code>segment</code><code> </code><code>mandatory,</code><code> </code><code>so</code><code> </code><code>it</code><code> </code><code>cannot</code><code> </code><code>be</code><code> </code><code>omitted,</code><code> </code><code>you</code><code> </code><code>can</code><code> </code><code>supply</code><code> </code><tt>:format</tt><tt> </tt><tt>=&gt;</tt><tt> </tt><tt>true</tt><code> </code><code>like</code><code> </code><code>this:</code></p>

<p><code>match</code><code> </code><code>&lsquo;*pages&rsquo;</code><code> </code><code>=&gt;</code><code> </code><code>&lsquo;pages#show&rsquo;,</code><code> </code><code>:format</code><code> </code><code>=&gt;</code><code> </code><code>true</code></p>

<h4><a name="redirection"></a><code>3.12</code><code> </code><code>Redirection</code></h4>


<p>You can redirect any path to another path using the <tt>redirect</tt> helper in your router:</p>

<p><span style="font-family: DejaVu Sans;"><code>你可以重定向任何</code></span><code>path</code><span style="font-family: DejaVu Sans;"><code>到另一个</code></span><code>path</code><span style="font-family: DejaVu Sans;"><code>使用</code></span><code>redirect</code><code> </code><code>helper</code><span style="font-family: DejaVu Sans;"><code>在你的</code></span><code>router</code><span style="font-family: DejaVu Sans;"><code>：</code></span></p>

<p>match &ldquo;/stories&rdquo; =&gt; redirect(&ldquo;/posts&rdquo;)</p>

<p>You can also reuse dynamic segments from the match in the path to redirect to:</p>

<p>match &ldquo;/stories/:name&rdquo; =&gt; redirect(&ldquo;/posts/%{name}&rdquo;)</p>

<p>You can also provide a block to redirect, which receives the params and (optionally) the request object:</p>

<p>match &ldquo;/stories/:name&rdquo; =&gt; redirect {|params| &ldquo;/posts/#{params[:name].pluralize}&rdquo; }</p>

<p>match &ldquo;/stories&rdquo; =&gt; redirect {|p, req| &ldquo;/posts/#{req.subdomain}&rdquo; }</p>

<p>In all of these cases, if you don’t provide the leading host (<tt><a href="http://www.example.com">http://www.example.com</a></tt>), Rails will take those details from the current request.</p>

<h4><a name="routing-to-rack-applications"></a>3.13 Routing to Rack Applications</h4>


<p>Instead of a String, like <tt>&ldquo;posts#index&rdquo;</tt>, which corresponds to the <tt>index</tt> action in the <tt>PostsController</tt>, you can specify any <a href="http://guides.rubyonrails.org/rails_on_rack.html"><span style="color: #000080;"><span style="text-decoration: underline;">Rack</span></span><span style="color: #000080;"><span style="text-decoration: underline;">application</span></span></a> as the endpoint for a matcher.</p>

<p>match &ldquo;/application.js&rdquo; =&gt; Sprockets</p>

<p>As long as <tt>Sprockets</tt> responds to <tt>call</tt> and returns a <tt>[status,</tt><tt> </tt><tt>headers,</tt><tt> </tt><tt>body]</tt>, the router won’t know the difference between the Rack application and an action.</p>

<p>For the curious, <tt>&ldquo;posts#index&rdquo;</tt> actually expands out to <tt>PostsController.action(:index)</tt>, which returns a valid Rack application.</p>

<h4><a name="using-root"></a>3.14 Using <tt>root</tt></h4>


<p>You can specify what Rails should route <tt>&ldquo;/&rdquo;</tt> to with the <tt>root</tt> method:</p>

<p>root :to =&gt; &lsquo;pages#main&rsquo;</p>

<p><strong>You</strong><strong> </strong><strong>should</strong><strong> </strong><strong>put</strong><strong> </strong><strong>the</strong><strong> </strong><tt><strong>root</strong></tt><strong> </strong><strong>route</strong><strong> </strong><strong>at</strong><strong> </strong><strong>the</strong><strong> </strong><strong>top</strong><strong> </strong><strong>of</strong><strong> </strong><strong>the</strong><strong> </strong><strong>file</strong>, because it is the most popular route and should be matched first. You also need to delete the <tt>public/index.html</tt> file for the root route to take effect.</p>

<h3><a name="customizing-resourceful-routes"></a>4 Customizing Resourceful Routes</h3>


<p>While the default routes and helpers generated by <tt>resources</tt><tt> </tt><tt>:posts</tt> will usually serve you well, you may want to customize them in some way. Rails allows you to customize virtually any generic part of the resourceful helpers.</p>

<h4><a name="specifying-a-controller-to-use"></a>4.1 Specifying a Controller to Use</h4>


<p>The <tt>:controller</tt> option lets you explicitly specify a controller to use for the resource. For example:</p>

<p>resources :photos, :controller =&gt; &ldquo;images&rdquo;</p>

<p>will recognize incoming paths beginning with <tt>/photos</tt> but route to the <tt>Images</tt> controller:</p>

<table width="402" cellspacing="0" cellpadding="2"><colgroup><col width="89" /> <col width="102" /> <col width="54" /> <col width="140" /> </colgroup>
<tbody>
<tr>
<th width="89">HTTP Verb</th>
<th width="102">Path</th>
<th width="54">action</th>
<th width="140">named helper</th>
</tr>
<tr>
<td width="89">GET</td>
<td width="102">/photos</td>
<td width="54">index</td>
<td width="140">photos_path</td>
</tr>
<tr>
<td width="89">GET</td>
<td width="102">/photos/new</td>
<td width="54">new</td>
<td width="140">new_photo_path</td>
</tr>
<tr>
<td width="89">POST</td>
<td width="102">/photos</td>
<td width="54">create</td>
<td width="140">photos_path</td>
</tr>
<tr>
<td width="89">GET</td>
<td width="102">/photos/:id</td>
<td width="54">show</td>
<td width="140">photo_path(:id)</td>
</tr>
<tr>
<td width="89">GET</td>
<td width="102">/photos/:id/edit</td>
<td width="54">edit</td>
<td width="140">edit_photo_path(:id)</td>
</tr>
<tr>
<td width="89">PUT</td>
<td width="102">/photos/:id</td>
<td width="54">update</td>
<td width="140">photo_path(:id)</td>
</tr>
<tr>
<td width="89">DELETE</td>
<td width="102">/photos/:id</td>
<td width="54">destroy</td>
<td width="140">photo_path(:id)</td>
</tr>
</tbody>
</table>


<p>Use <tt>photos_path</tt>, <tt>new_photo_path</tt>, etc. to generate paths for this resource.</p>

<h4><a name="specifying-constraints"></a>4.2 Specifying Constraints</h4>


<p>You can use the <tt>:constraints</tt> option to specify a required format on the implicit <tt>id</tt>. For example:</p>

<p>This declaration constraints the <tt>:id</tt> parameter to match the supplied regular expression. So, in this case, the router would no longer match <tt>/photos/1</tt> to this route. Instead, <tt>/photos/RR27</tt> would match.</p>

<p>You can specify a single constraint to apply to a number of routes by using the block form:</p>

<p>constraints(:id =&gt; /[A-Z][A-Z][0-9]+/) do</p>

<p>resources :photos</p>

<p>resources :accounts</p>

<p>end</p>

<p>Of course, you can use the more advanced constraints available in non-resourceful routes in this context.</p>

<p>&nbsp;</p>

<p>By default the <tt>:id</tt> parameter doesn’t accept dots – this is because the dot is used as a separator for formatted routes. If you need to use a dot within an <tt>:id</tt> add a constraint which overrides this – for example <tt>:id</tt> =&gt; /[^\/]+/ allows anything except a slash.</p>

<h4><a name="overriding-the-named-helpers"></a>4.3 Overriding the Named Helpers</h4>


<p>The <tt>:as</tt> option lets you override the normal naming for the named route helpers. For example:</p>

<p>resources :photos, :as =&gt; &ldquo;images&rdquo;</p>

<p>will recognize incoming paths beginning with <tt>/photos</tt> and route the requests to <tt>PhotosController</tt>, but use the value of the :as option to name the helpers.</p>

<table width="398" cellspacing="0" cellpadding="2"><colgroup><col width="83" /> <col width="102" /> <col width="54" /> <col width="143" /> </colgroup>
<tbody>
<tr>
<th width="83">HTTP verb</th>
<th width="102">Path</th>
<th width="54">action</th>
<th width="143">named helper</th>
</tr>
<tr>
<td width="83">GET</td>
<td width="102">/photos</td>
<td width="54">index</td>
<td width="143">images_path</td>
</tr>
<tr>
<td width="83">GET</td>
<td width="102">/photos/new</td>
<td width="54">new</td>
<td width="143">new_image_path</td>
</tr>
<tr>
<td width="83">POST</td>
<td width="102">/photos</td>
<td width="54">create</td>
<td width="143">images_path</td>
</tr>
<tr>
<td width="83">GET</td>
<td width="102">/photos/:id</td>
<td width="54">show</td>
<td width="143">image_path(:id)</td>
</tr>
<tr>
<td width="83">GET</td>
<td width="102">/photos/:id/edit</td>
<td width="54">edit</td>
<td width="143">edit_image_path(:id)</td>
</tr>
<tr>
<td width="83">PUT</td>
<td width="102">/photos/:id</td>
<td width="54">update</td>
<td width="143">image_path(:id)</td>
</tr>
<tr>
<td width="83">DELETE</td>
<td width="102">/photos/:id</td>
<td width="54">destroy</td>
<td width="143">image_path(:id)</td>
</tr>
</tbody>
</table>


<h4><a name="overriding-the-new-and-edit-segments"></a> 4.4 Overriding the <tt>new</tt> and <tt>edit</tt> Segments<span style="font-family: WenQuanYi Micro Hei;">重写</span>new<span style="font-family: WenQuanYi Micro Hei;">和</span>edit Segments</h4>


<p>The <tt>:path_names</tt> option lets you override the automatically-generated “new” and “edit” segments in paths:</p>

<p>resources :photos, :path_names =&gt; { :new =&gt; &lsquo;make&rsquo;, :edit =&gt; &lsquo;change&rsquo; }</p>

<p>This would cause the routing to recognize paths such as</p>

<p><code>/photos/make</code></p>

<p><code>/photos/1/change</code></p>

<p>The actual action names aren’t changed by this option. The two paths shown would still route to the <tt>new</tt> and <tt>edit</tt> actions.</p>

<p>&nbsp;</p>

<p>If you find yourself wanting to change this option uniformly for all of your routes, you can use a scope.</p>

<p>scope :path_names =&gt; { :new =&gt; &ldquo;make&rdquo; } do</p>

<h1>rest of your routes</h1>

<p>end</p>

<h4><a name="prefixing-the-named-route-helpers"></a>4.5 Prefixing the Named Route Helpers</h4>


<p>You can use the <tt>:as</tt> option to prefix the named route helpers that Rails generates for a route. Use this option to prevent name collisions between routes using a path scope</p>

<p>scope &ldquo;admin&rdquo; do</p>

<p>resources :photos, :as =&gt; &ldquo;admin_photos&rdquo;</p>

<p>end</p>

<p>&nbsp;</p>

<p>resources :photos</p>

<p>This will provide route helpers such as <tt>admin_photos_path</tt>, <tt>new_admin_photo_path</tt> etc.<span style="font-family: DejaVu Sans;">这将会提供比如 </span><tt>admin_photos_path</tt>, <tt>new_admin_photo_path</tt><span style="font-family: DejaVu Sans;"><tt>等这样的</tt></span><tt>route helpers</tt><span style="font-family: DejaVu Sans;"><tt>。</tt></span></p>

<p>To prefix a group of route helpers, use <tt>:as</tt> with <tt>scope</tt>:</p>

<p>scope &ldquo;admin&rdquo;, :as =&gt; &ldquo;admin&rdquo; do</p>

<p>resources :photos, :accounts</p>

<p>end</p>

<p>&nbsp;</p>

<p>resources :photos, :accounts</p>

<p>This will generate routes such as <tt>admin_photos_path</tt> and <tt>admin_accounts_path</tt> which map to <tt>/admin/photos</tt> and <tt>/admin/accounts</tt> respectively.</p>

<p>The <tt><strong>namespace</strong></tt> scope will automatically add <tt>:as</tt> as well as <tt>:module</tt> and <tt>:path</tt> prefixes.</p>

<p>You can prefix routes with a named parameter also:</p>

<p>scope &ldquo;:username&rdquo; do</p>

<p>resources :posts</p>

<p>end</p>

<p>This will provide you with URLs such as <tt>/bob/posts/1</tt> and will allow you to reference the <tt>username</tt> part of the path as <tt>params[:username]</tt> in controllers, helpers and views.</p>

<h4><a name="restricting-the-routes-created"></a>4.6 Restricting the Routes Created<span style="font-family: WenQuanYi Micro Hei;">限制</span>routes<span style="font-family: WenQuanYi Micro Hei;">被创建</span></h4>


<p>By default, Rails creates routes for the seven default actions (index, show, new, create, edit, update, and destroy) for every RESTful route in your application. You can use the <tt>:only</tt> and <tt>:except</tt> options to fine-tune this behavior. The <tt>:only</tt> option tells Rails to create only the specified routes:</p>

<p><span style="font-family: DejaVu Sans;">默认的，</span>Rails<span style="font-family: DejaVu Sans;">按照七种默认的</span>action<span style="font-family: DejaVu Sans;">（</span>index, show, new, create, edit, update, and destroy<span style="font-family: DejaVu Sans;">）为你应用程序中的每个</span>RESTful route<span style="font-family: DejaVu Sans;">创建</span>routes<span style="font-family: DejaVu Sans;">。</span></p>

<p>resources :photos, :only =&gt; [:index, :show]</p>

<p>Now, a <tt>GET</tt> request to <tt>/photos</tt> would succeed, but a <tt>POST</tt> request to <tt>/photos</tt> (which would ordinarily be routed to the <tt>create</tt> action) will fail.</p>

<p><span style="font-family: DejaVu Sans;">现在一个</span>GET<span style="font-family: DejaVu Sans;">请求到</span><tt>/photos</tt><span style="font-family: DejaVu Sans;"><tt>将会成功，但是一个</tt></span><tt>POST</tt><span style="font-family: DejaVu Sans;"><tt>到</tt></span><tt>/photos</tt><span style="font-family: DejaVu Sans;"><tt>（其按理将会</tt></span><tt>route</tt><span style="font-family: DejaVu Sans;"><tt>到</tt></span><tt>create action</tt><span style="font-family: DejaVu Sans;"><tt>）将会失败。</tt></span></p>

<p>The <tt>:except</tt> option specifies a route or list of routes that Rails should <em>not</em> create:</p>

<p>resources :photos, :except =&gt; :destroy</p>

<p>In this case, Rails will create all of the normal routes except the route for <tt>destroy</tt> (a <tt>DELETE</tt> request to <tt>/photos/:id</tt>).</p>

<p>If your application has many RESTful routes, using <tt>:only</tt> and <tt>:except</tt> to generate only the routes that you actually need can cut down on memory use and speed up the routing process.</p>

<p><span style="font-family: DejaVu Sans;">如果你的应用程序中有很多 </span>RESTful routes<span style="font-family: DejaVu Sans;">，使用</span><tt>:only</tt> and <tt>:except</tt><span style="font-family: DejaVu Sans;"><tt>来生成仅仅你实际需要的</tt></span><tt>route</tt><span style="font-family: DejaVu Sans;"><tt>能够消减内存使用和提速</tt></span><tt>routing </tt><span style="font-family: DejaVu Sans;"><tt>进程。</tt></span></p>

<h4><a name="translated-paths"></a>4.7 Translated Paths<span style="font-family: WenQuanYi Micro Hei;">翻译路径</span></h4>


<p>Using <tt>scope</tt>, we can alter path names generated by resources:</p>

<p><span style="font-family: DejaVu Sans;">使用</span>scope<span style="font-family: DejaVu Sans;">，我们可以别名</span>resources<span style="font-family: DejaVu Sans;">生成的路径</span>name<span style="font-family: DejaVu Sans;">：</span></p>

<p>scope(:path_names =&gt; { :new =&gt; &ldquo;neu&rdquo;, :edit =&gt; &ldquo;bearbeiten&rdquo; }) do</p>

<p>resources :categories, :path =&gt; &ldquo;kategorien&rdquo;</p>

<p>end</p>

<p><tt>Rails now creates routes to the CategoriesController.</tt></p>

<table width="482" cellspacing="0" cellpadding="2"><colgroup><col width="83" /> <col width="170" /> <col width="54" /> <col width="159" /> </colgroup>
<tbody>
<tr>
<th width="83">HTTP verb</th>
<th width="170">Path</th>
<th width="54">action</th>
<th width="159">named helper</th>
</tr>
<tr>
<td width="83">GET</td>
<td width="170">/kategorien</td>
<td width="54">index</td>
<td width="159">categories_path</td>
</tr>
<tr>
<td width="83">GET</td>
<td width="170">/kategorien/neu</td>
<td width="54">new</td>
<td width="159">new_category_path</td>
</tr>
<tr>
<td width="83">POST</td>
<td width="170">/kategorien</td>
<td width="54">create</td>
<td width="159">categories_path</td>
</tr>
<tr>
<td width="83">GET</td>
<td width="170">/kategorien/:id</td>
<td width="54">show</td>
<td width="159">category_path(:id)</td>
</tr>
<tr>
<td width="83">GET</td>
<td width="170">/kategorien/:id/bearbeiten</td>
<td width="54">edit</td>
<td width="159">edit_category_path(:id)</td>
</tr>
<tr>
<td width="83">PUT</td>
<td width="170">/kategorien/:id</td>
<td width="54">update</td>
<td width="159">category_path(:id)</td>
</tr>
<tr>
<td width="83">DELETE</td>
<td width="170">/kategorien/:id</td>
<td width="54">destroy</td>
<td width="159">category_path(:id)</td>
</tr>
</tbody>
</table>


<h4><a name="overriding-the-singular-form"></a><tt>4.8 Overriding the Singular Form</tt></h4>


<p>If you want to define the singular form of a resource, you should add additional rules to the <tt>Inflector</tt>.</p>

<p><span style="font-family: DejaVu Sans;"><tt>如果你想定义一个单数形式的</tt></span><tt>resource</tt><span style="font-family: DejaVu Sans;"><tt>，你应该添加补充的</tt></span><tt>rules</tt><span style="font-family: DejaVu Sans;"><tt>到</tt></span><tt>Inflector</tt><span style="font-family: DejaVu Sans;"><tt>。</tt></span></p>

<p>ActiveSupport::Inflector.inflections do |inflect|</p>

<p>inflect.irregular &lsquo;tooth&rsquo;, &lsquo;teeth&rsquo;</p>

<p>end</p>

<h4><a name="nested-names"></a>4.9 Using <tt>:as</tt> in Nested Resources<span style="font-family: WenQuanYi Micro Hei;">在嵌套</span>resources<span style="font-family: WenQuanYi Micro Hei;">中使用</span>:as</h4>


<p>The <tt>:as</tt> option overrides the automatically-generated name for the resource in nested route helpers. For example,</p>

<p>:as<span style="font-family: DejaVu Sans;">选项覆盖嵌套的</span>resource<span style="font-family: DejaVu Sans;">自动生成的</span>route<span style="font-family: DejaVu Sans;">的名字。例如：</span></p>

<p>resources :magazines do</p>

<p>resources :ads, :as =&gt; &lsquo;periodical_ads&rsquo;</p>

<p>end</p>

<p>This will create routing helpers such as <tt>magazine_periodical_ads_url</tt> and <tt>edit_magazine_periodical_ad_path</tt>.</p>

<h3><a name="inspecting-and-testing-routes"></a>5 Inspecting and Testing Routes<span style="font-family: WenQuanYi Micro Hei;">检查和测试</span>routes</h3>


<p>Rails offers facilities for inspecting and testing your routes.</p>

<p>Rails<span style="font-family: DejaVu Sans;">提供设施来检查和测试你的</span>routes<span style="font-family: DejaVu Sans;">。</span></p>

<h4><a name="seeing-existing-routes-with-rake"></a>5.1 Seeing Existing Routes with <tt>rake</tt><span style="font-family: WenQuanYi Micro Hei;"><tt>使用</tt></span><tt>rake</tt><span style="font-family: WenQuanYi Micro Hei;"><tt>来查看存在的</tt></span><tt>routes</tt></h4>


<p>If you want a complete list of all of the available routes in your application, run <tt> rake routes</tt> command. This will print all of your routes, in the same order that they appear in <tt>routes.rb</tt>. For each route, you’ll see:</p>

<p><span style="font-family: DejaVu Sans;">如果你需要一个你应用程序中可用的完整的</span>list<span style="font-family: DejaVu Sans;">，运行 </span><tt>rake routes</tt><span style="font-family: DejaVu Sans;"><tt>命令。这将会打印所有你的</tt></span><tt>routes</tt><span style="font-family: DejaVu Sans;"><tt>（到终端），与</tt></span><tt>routes.rb</tt><span style="font-family: DejaVu Sans;"><tt>中出现的顺序一样。对于每个</tt></span><tt>route</tt><span style="font-family: DejaVu Sans;"><tt>，你将会看到：</tt></span></p>

<ul>
    <li>The route name (if any)</li>
    <li>The HTTP verb used (if the route doesn’t respond to all verbs)</li>
    <li>The URL pattern to match <span style="font-family: DejaVu Sans;">匹配的</span>URL<span style="font-family: DejaVu Sans;">模式</span></li>
    <li>The routing parameters for the route</li>
</ul>


<p>For example, here’s a small section of the <tt>rake routes</tt> output for a RESTful route:</p>

<pre>          users GET  /users          {:controller=&gt;"users", :action=&gt;"index"}
formatted_users GET  /users.:format  {:controller=&gt;"users", :action=&gt;"index"}
                POST /users          {:controller=&gt;"users", :action=&gt;"create"}
                POST /users.:format  {:controller=&gt;"users", :action=&gt;"create"}</pre>


<p>You may restrict the listing to the routes that map to a particular controller setting the <tt>CONTROLLER</tt> environment variable:</p>

<p><span style="font-family: DejaVu Sans;">你可以限制列出的</span>routes<span style="font-family: DejaVu Sans;">映射到一个别的</span>controller<span style="font-family: DejaVu Sans;">设置 </span><tt>CONTROLLER</tt><span style="font-family: DejaVu Sans;"><tt>环境变量：</tt></span></p>

<p>$ CONTROLLER=users rake routes</p>

<p>You’ll find that the output from <tt>rake routes</tt> is much more readable if you widen your terminal window until the output lines don’t wrap.</p>

<p><span style="font-family: DejaVu Sans;">你会发现如果你扩大到你的终端不自动换行，<tt>来自</tt></span><tt>rake routes</tt><span style="font-family: DejaVu Sans;"><tt>会更具可读性。</tt></span></p>

<h4><a name="testing-routes"></a>5.2 Testing Routes</h4>


<p>Routes should be included in your testing strategy<span style="font-family: DejaVu Sans;">策略 </span>(just like the rest of your application). Rails offers three <a href="http://api.rubyonrails.org/classes/ActionDispatch/Assertions/RoutingAssertions.html">built-in assertions</a> designed to make testing routes simpler:</p>

<ul>
    <li><tt>assert_generates</tt></li>
    <li><tt>assert_recognizes</tt></li>
    <li><tt>assert_routing</tt></li>
</ul>


<h5><a name="the-assert_generates-assertion"></a>5.2.1 The <tt>assert_generates</tt> Assertion</h5>


<p><tt>assert_generates</tt> asserts that a particular set of options generate a particular path and can be used with default routes or custom routes.</p>

<p><tt>assert_generates</tt><span style="font-family: DejaVu Sans;"><tt>断言是一个特别的设置选项生成一个特别的路径并且可以与默认的</tt></span><tt>routes</tt><span style="font-family: DejaVu Sans;"><tt>和定制的</tt></span><tt>routes</tt><span style="font-family: DejaVu Sans;"><tt>。</tt></span></p>

<p>assert_generates &ldquo;/photos/1&rdquo;, { :controller =&gt; &ldquo;photos&rdquo;, :action =&gt; &ldquo;show&rdquo;, :id =&gt; &ldquo;1&rdquo; }</p>

<p>assert_generates &ldquo;/about&rdquo;, :controller =&gt; &ldquo;pages&rdquo;, :action =&gt; &ldquo;about&rdquo;</p>

<h5><a name="the-assert_recognizes-assertion"></a>5.2.2 The <tt>assert_recognizes</tt> Assertion</h5>


<p><tt>assert_recognizes</tt> is the inverse of <tt> </tt><tt>assert_generates</tt>. It asserts that a given path is recognized and routes it to a particular spot in your application.</p>

<p><a name="result_box2"></a><tt>assert_recognizes</tt><span style="font-family: DejaVu Sans;"><tt>是 </tt></span><tt>assert_generates</tt><span style="font-family: DejaVu Sans;"><tt>的逆。它断言</tt>一个给定的</span>path<span style="font-family: DejaVu Sans;">是被承认的并</span>route<span style="font-family: DejaVu Sans;">到应用程序中的特定地点。</span></p>

<p><tt>assert_recognizes({ :controller =&gt; &ldquo;photos&rdquo;, :action =&gt; &ldquo;show&rdquo;, :id =&gt; &ldquo;1&rdquo; }, &ldquo;/photos/1&rdquo;)</tt></p>

<p>You can supply a <tt>:method</tt> argument to specify the HTTP verb:</p>

<p><span style="font-family: DejaVu Sans;">你可以提供一个</span>:method<span style="font-family: DejaVu Sans;">参数来指定</span>HTTP verbe<span style="font-family: DejaVu Sans;">：</span></p>

<p>assert_recognizes({ :controller =&gt; &ldquo;photos&rdquo;, :action =&gt; &ldquo;create&rdquo; }, { :path =&gt; &ldquo;photos&rdquo;, :method =&gt; :post })</p>

<p>assert_recognizes({ :controller =&gt; &ldquo;photos&rdquo;, :action =&gt; &ldquo;create&rdquo; }, { :path =&gt; &ldquo;photos&rdquo;, :method =&gt; :post })</p>

<h5><a name="the-assert_routing-assertion"></a>5.2.3 The <tt>assert_routing</tt> Assertion</h5>


<p>The assertion checks the route both ways: it tests that the path generates the options, and that the options generate the path. Thus, it combines the functions of <tt> assert_generates and </tt><tt>assert_recognizes</tt>.</p>

<p><span style="font-family: DejaVu Sans;">断言 </span><tt>assert_routing</tt><span style="font-family: DejaVu Sans;"><tt>检测</tt></span><tt>route</tt><span style="font-family: DejaVu Sans;"><tt>两方面：它测试访问路径生成选项，并且测试这个选项生成的路径。这样，它联合了 </tt></span><tt>assert_generates and assert_recognizes</tt><span style="font-family: DejaVu Sans;"><tt>的功能。</tt></span></p>

<p>assert_routing({ :path =&gt; &ldquo;photos&rdquo;, :method =&gt; :post }, { :controller =&gt; &ldquo;photos&rdquo;, :action =&gt; &ldquo;create&rdquo; })</p>

<p>标签： <a href="http://jhjguxin.hwcrazy.com/tag/guide/">guide</a> <a href="http://jhjguxin.hwcrazy.com/tag/http/">http</a> <a href="http://jhjguxin.hwcrazy.com/tag/rails/">rails</a> <a href="http://jhjguxin.hwcrazy.com/tag/route/">route</a> <a href="http://jhjguxin.hwcrazy.com/tag/ruby/">ruby</a> <a href="http://jhjguxin.hwcrazy.com/tag/translate/">translate</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/12/28/li-jie-json%3A3fen-zhong-ke-cheng/">理解JSON：3分钟课程</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-12-28T18:57:00+08:00" pubdate data-updated="true">Dec 28<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>理解JSON：3分钟课程</h2>

<p>如果你跟我一样(我担心你就是)，那么，到目前为止，这应该是你对JSON的经验：</p>

<ol>
    <li>两个月前你<strong>从没</strong>听说过JSON</li>
    <li>一个月前你听说了这个词但没有留意</li>
    <li>一周前你发现这个词被提到多次，开始想，<em>没错 … 又有一些垃圾东西要学了</em></li>
    <li>今天你被心灵深处的一个闹铃闹醒，心想：<strong>这该死的json究竟是个什么东西？为什么突然间到处都是它了！</strong></li>
</ol>


<p>于是晚上我乘坐了一辆慢腾腾的公交回到家(周五通常都是很慢)，然后给自己找了一大堆关于JSON资料。所以我可以文雅的带你进入JSON的大门。</p>

<p>这就开始了 …</p>

<h3>这几个字母是什么意思？</h3>


<p><strong>J</strong>ava<strong>S</strong>cript <strong>O</strong>bject <strong>N</strong>otation.</p>

<p>[一个滑稽的名字。它应该被称作<strong>L</strong>ightweight <strong>E</strong>cmascript <strong>O</strong>bject <strong>N</strong>otation, 或简称 &lsquo;LEON&#8217;。 <img src="http://www.linuxeden.com/upimg/allimg/110526/0S53B127-0.gif" alt=";-)" /> ]</p>

<h3>它是个什么东西？</h3>


<p>JSON是一种传递对象的语法，对象可以是name/value对，数组和其他对象。</p>

<p>下面是一小段JSON代码：</p>

<pre>点击收起{"skillz": {
    "web":[
        {"name": "html",
         "years": "5"
        },
        {"name": "css",
         "years": "3"
        }],
    "database":[
        {"name": "sql",
         "years": "7"
        }]
}}</pre>


<p>你看懂了吧？那么当你再看到它时就知道它是JSON了。主要部分：</p>

<h3>花括弧，方括弧，冒号和逗号</h3>


<ol>
    <li>花括弧表示一个“容器”</li>
    <li>方括号装载数组</li>
    <li>名称和值用冒号隔开</li>
    <li>数组元素通过逗号隔开</li>
</ol>


<h3>把它想成“得了厌食症的XML”</h3>


<p>(如果你跟我一样老，可以把它想成有层次关系的’.INI’文件)</p>

<p>(如果你是个自以为是的Lisp小丑，可以把它想成”S-expressions”，自以为是吧)</p>

<h3>JSON很像XML，因为：</h3>


<ol>
    <li>他们都“自我描述”，这意味着值都是可列举的，是“人类可读”的</li>
    <li>都是有层级的。(例如你可以在值里再存放值)</li>
    <li>都能被多种的编程语言解析和使用</li>
    <li>都能使用AJAX方法来传递(例如httpWebRequest)</li>
</ol>


<h3>JSON跟XML不一样，因为：</h3>


<ol>
    <li>XML里在元素的开始和结尾处有尖括号和标签名：JSON使用花括号，而且只在数据的开始和结束时使用。</li>
    <li>JSON更简练，毫无疑问更适合人类书写，也许也能让我们更快速的阅读。</li>
    <li>JSON可以在JavaScript里简单的传递到eval()方法里使用</li>
    <li>JSON里有数组{每个元素没有自己的名称}</li>
    <li>在XML里你可以对一个元素使用任意想要的名称，在JSON里你不能使用Javascript里的保留字</li>
</ol>


<h3>可是为什么？它有什么好的？</h3>


<p>当你写ajax之类的东西时，如果你使用JSON，你就勉去了手工拼写XML。更迅速。</p>

<p>同样，当你写ajax之类的东西时，怎样最简单？XML方式还是JSON方式：</p>

<div>
<h3>XML方式：</h3>
<ol>
    <li>取回一个XML文件</li>
    <li>循环它，从中提取值</li>
    <li>处理这些值，等</li>
</ol>
<h3>对比</h3>
<h3>JSON方式：</h3>
<ol>
    <li>取回JSON字符串。</li>
    <li>‘eval’ JSON数据</li>
</ol>
</div>


<h3>它是面向对象的吗？</h3>


<p>No，严格的说，不是。</p>

<p>就像是VB6里的面向对象一样。它提供了很好的封装机制，你可以使用它把数据和方法分离出来，但它不提供任何的继承，多型，接口，或其它类似的面向对象的东西</p>

<p>很显然，它是使javascript变得更易于维护，分析和复用的方向上前进了一步。</p>

<p><a href="http://www.thomasfrank.se/" target="_blank">Thomas Frank</a>写了一个<a title="classyJSON" href="http://www.thomasfrank.se/classy_json.html" target="_blank">灵巧的javascript库</a>，叫做<em>classyJSON</em>，它在JSON代码上增加了继承和定义范围等特征。</p>

<h3>它只是用在客户端吗？</h3>


<p>是，也不是。在服务器端你可以容易的把对象序列化成JSON或反之。对于<code>.net</code>，程序员可以使用类似<a href="http://www.newtonsoft.com/products/json/" target="_blank">Json.net</a>的类库使这些操作自动化(我估计是使用反射机制)，或你使用自己的程序来做这些事，可能会更快些。</p>

<h3>3分钟将近结束….</h3>


<p>就我所知，JSON是由一个叫做<a href="http://www.crockford.com/" target="_blank">Douglas Crockford</a>的家伙发明的。如果你喜欢的话，可以看一下<a href="http://www.crockford.com/" target="_blank">他的网站</a>，他非常的有趣。</p>

<div>
<h3>现在去读一下懂JSON的人写的东西</h3>
(从<a href="http://del.icio.us/help/json" target="_blank">Delicious using JSON</a>上搜刮来的！)
<ul>
    <li><a href="http://homepages.nildram.co.uk/%7E9jack9/base2/speedtest/" target="_blank">DOM Query Speed Test</a></li>
    <li><a href="http://24ways.org/advent/dont-be-eval" target="_blank">24 ways: Don’t be eval()</a></li>
    <li><a href="http://www.aqee.net/2011/05/26/understanding-json-the-3-minute-lesson/" target="_blank">Understanding JSON: the 3 minute lesson</a></li>
    <li><a href="http://www.hanselman.com/blog/SerializingObjectsAsJavaScriptUsingAtlasJSONNETAndAjaxPro.aspx" target="_blank">Serializing Objects as JavaScript using Atlas, JSON.NET and AjaxPro</a></li>
    <li><a href="http://en.wikipedia.org/wiki/JSON" target="_blank">JSON – Wikipedia, the free encyclopedia</a></li>
    <li><a href="http://www.ajaxprojects.com/ajax/tutorialdetails.php?itemid=11" target="_blank">Introduction to JSON</a></li>
    <li><a href="http://www.xml.com/pub/a/2005/12/21/json-dynamic-script-tag.html" target="_blank">XML.com: JSON and the Dynamic Script Tag: Easy, XML-less Web Services for JavaScript</a></li>
    <li><a href="http://www.thomasfrank.se/classy_json.html" target="_blank">Classy JSON</a></li>
    <li><a href="http://simpletutorials.com/w3/index.php?pagename=Simple%20AJAX%20%28PHP%29%20tutorial" target="_blank">ajax json tutoral</a></li>
    <li><a href="http://www.thomasfrank.se/xml_to_json.html" target="_blank">XML to JSON – a converter</a></li>
</ul>
</div>


<h3>这就是全部。</h3>


<p>我在几分钟的时间里只能整理出这些东西——所有我说的有些东西可能完全是错的。如果是这样，请留言告诉我，告诉我我有多傻。我会很高兴的纠正任何一个错误。祝你好运！</p>

<p>(边注：如果你把 { 和 } 替换成”&lt;” 和 “/&gt;”，把”:” 换成 “/”… 你会得到一个非常像<a href="http://secretgeek.net/gaXml.asp" target="_blank">gaXml</a>的东西。有趣的世界。</p>

<p>(边注2：<a href="http://en.wikipedia.org/wiki/Jason" target="_blank">Jason</a> 和 <a href="http://en.wikipedia.org/wiki/Ajax_%28mythology%29" target="_blank">Ajax</a> 都是希腊神话中的英雄。预告：另外一些即将出现的技术垃圾包括：Heracles, Perseus, Deucalion, Theseus
and Bellerophon。)</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/12/28/16-tiao-ji-qiao-rang-ni-geng-gao-xiao-shi-yong-ssh/">16 条技巧让你更高效使用 SSH</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-12-28T18:53:00+08:00" pubdate data-updated="true">Dec 28<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>16 条技巧让你更高效使用 SSH</h2>

<p>SSH有很多非常酷的特性，如何它是你每天的工作伴侣，那么我想你有必要了解以下16条高效使用SSH的秘籍，它们帮你节省的时间肯定会远远大于你用来配置它们的时间。</p>

<p><strong>1. 多条连接共享</strong></p>

<p>如果你需要在多个窗口中打开到同一个服务器的连接，而不想每次都输入用户名，密码，或是等待连接建立，那么你可以配置SSH的连接共享选项，在本地打开你的SSH配置文件，通常它们位于~/.ssh/config，然后添加下面2行：</p>

<blockquote>ControlMaster auto
ControlPath /tmp/ssh_mux_%h_%p_%r</blockquote>


<p>现在试试断开你与服务器的连接，并建立一条新连接，然后打开一个新窗口，再创建一条连接，你会发现，第二条连接几乎是在瞬间就建立好了。</p>

<p>Windows用户</p>

<p>如果你是Windows用户，很不幸，最流行的开源SSH客户端Putty并不支持这个特性，但是Windows上也有OpenSSH的实现，比如这个<a href="http://www.itefix.no/i2/copssh" target="_blank">Copssh</a>，如果你觉得下面的一些技巧对你很有帮助，或许你应该试试Copssh。</p>

<p>文件传输</p>

<p>连接共享不止可以帮助你共享多个SSH连接，如果你需要通过SFTP与服务器传输文件，你会发现，它们使用的依然是同一条连接，如果你使用的 Bash，你会发现，你甚至SSH甚至支持Tab对服务器端文件进行自动补全，共享连接选项对于那些需要借助SSH的工具，比如rsync，git等等也 同样有效。</p>

<p><strong>2. 长连接</strong></p>

<p>如果你发现自己每条需要连接同一个服务器无数次，那么长连接选项就是为你准备的：</p>

<blockquote>ControlPersist 4h</blockquote>


<p>现在你每次通过SSH与服务器建立连接之后，这条连接将被保持4个小时，即使在你退出服务器之后，这条连接依然可以重用，因此，在你下一次（4小时 之内）登录服务器时，你会发现连接以闪电般的速度建立完成，这个选项对于通过scp拷贝多个文件提速尤其明显，因为你不在需要为每个文件做单独的认证了。</p>

<p><strong>3. 别再输入密码</strong></p>

<p>如果你还在通过密码方式登录SSH，那么你或许应该试试SSH Keys，首先使用OpenSSH为自己声称一对密钥：</p>

<blockquote>$ ssh-keygen</blockquote>


<p>跟随指示，完成之后，你应该可以在你的.ssh目录下看到两个文件，id_rsa就是你的私钥，而id_ras.pub则是你的公钥，现在你需要将你的公钥拷贝到服务器上，如果你的系统有ssh-copy-id命令，拷贝会很简单：</p>

<blockquote>$ ssh-copy-id smylers@compo.example.org</blockquote>


<p>否则，你需要手动将你的私钥拷贝的服务器上的~/.ssh/authorized_keys文件中：</p>

<blockquote>$ &lt; ~/.ssh/id_rsa.pub ssh clegg.example.org ‘mkdir -p .ssh; cat &gt;&gt; .ssh/authorized_keys; chmod go-w .ssh .ssh/authorized_keys’</blockquote>


<p>现在试试重新连接到SSH服务器，或是拷贝文件，是不是已经不需要再输入密码了？</p>

<p>为Putty配置SSH Key</p>

<p>Putty也可以使用SSH Key，<a href="http://www.chiark.greenend.org.uk/%7Esgtatham/putty/download.html" target="_blank">从Putty网站下载PuttyGen和Pageant</a>，然后使用PuttyGen生成你的密钥，将公钥拷贝到服务器的’.ssh/authorized_keys’目录，然后运行Pageant，导入你的私钥，让它在后台运行，险隘你就可以使用Putty通过公钥直接登录服务器了，你可以在<a href="http://the.earth.li/%7Esgtatham/putty/0.61/htmldoc/Chapter8.html" target="_blank">Putty手册的第8，9章</a>了解关于这一特性的详细介绍。</p>

<p><strong>4. 连接中转</strong></p>

<p>有时候你可能需要从一个服务器连接另外一个服务器，比如在两个服务器之间直接传输数据，而不用通过本地电脑中转：</p>

<blockquote>www1 $ scp -pr templates www2:$PWD</blockquote>


<p>（顺便说一下，当你需要在两台服务器间拷贝文件时，$PWD变量时非常有用的），因为即使你已经在两台服务器上添加了你本地电脑的公钥，scp默认 仍然会提示你输入密码：这是因为你用来作为跳板的那台服务器上并没有你的私钥，所以，第二胎服务器会拒绝你的公钥，但是一定不要通过将你的私钥拷贝到中转 服务器上来解决这个问题，你可以使用agent forwarding来解决这个问题，只要在你的.ssh/config文件中加入下面这行代码就可以了：</p>

<blockquote>ForwardAgent yes</blockquote>


<p>或者是在Putty中勾上“Allow agent forwarding”选项，现在你的本地SSH就变成了第一台服务器的SSH代理，从第一台服务器在连接其它服务器就变和和在你本地一样简单，注意，如果要开启这个选项，前提是这个中间服务器值得你信任。</p>

<p><strong>5. 省略主机名</strong></p>

<p>输入服务器的完整主机名来建立一个新的SSH连接实在是太乏味无聊了，尤其是当你有一组拥有相同域名但是子域名不同的服务器需要管理时，比如下面这样：</p>

<blockquote>* www1.example.com
* www2.example.com
* mail.example.com
* intranet.internal.example.com
* backup.internal.example.com
* dev.internal.example.com</blockquote>


<p>或许你的网络已经配置了可以直接使用短域名，比如intranet，但是如果你的网络不支持，实际上你可以自己搞定这个问题，而不用求助网络管理员。</p>

<p>解决办法根据你用的操作系统而略有差异，下面是我的Ubuntu系统的配置：</p>

<blockquote>prepend domain-search “internal.example.com”, “example.com”;</blockquote>


<p>然后你需要重启网络:$ sudo restart network-manager</p>

<p>不同的系统，这两条命令可能会略有差异。</p>

<p><strong>5. 主机别名</strong></p>

<p>你也可以在你的SSH配置中直接定义主机别名，就像下面这样：</p>

<blockquote>Host dev
HostName dev.internal.example.com</blockquote>


<p>你还可以使用通配符来进行分组：</p>

<blockquote>Host dev intranet backup
HostName %h.internal.example.com

Host www* mail
HostName %h.example.com</blockquote>


<p>在Putty中你可以为每个主机名保存单独的session，然后双击建立连接（但是它可能没办法支持通配符）。</p>

<p><strong>7. 省去用户名</strong></p>

<p>如果你在远程服务器上的用户名和你本地的用户名不同，你同样可以在SSH配置中进行设置：</p>

<blockquote>Host www* mail
HostName %h.example.com
User simon</blockquote>


<p>现在就算我的本地用户名是 smylers，我仍然可以这样连接我的服务器：</p>

<blockquote>$ ssh www2</blockquote>


<p>SSH会使用simon账户连接你的服务器，同样，Putty可以保存这个信息在你的session中。</p>

<p><strong>8. 在服务器间跳转</strong></p>

<p>有些时候，你可能没法直接连接到某台服务器，而需要使用一台中间服务器进行中转，这个过程也可以自动化。首先确保你已经为服务器配置了公钥访问，并开启了agent forwarding，现在你就可以通过2条命令来连接目标服务器，不会有任何提示输入：</p>

<blockquote>$ ssh gateway
gateway $ ssh db</blockquote>


<p>然后在你的本地SSH配置中，添加下面这条配置：</p>

<blockquote>Host db
HostName db.internal.example.com
ProxyCommand ssh gateway netcat -q 600 %h %p</blockquote>


<p>现在你就可以通过一条命令来直接连接目标服务器了:</p>

<blockquote>$ ssh db</blockquote>


<p>这里你可能会需要等待长一点的时间，因为SSH需要进行两次认证，，注意netcat也有可能被写成nc或者ncat或者前面还需要加上g，你需要检查你的中间服务器来确定实际的参数。</p>

<p><strong>9. 突破网络封锁</strong></p>

<p>有些时候，你使用的网络可能只开放了80端口，或者它们封锁了SSH端口（默认的22端口），这种情况下，你可以通过配置SSH服务器在80或者443端口进行监听来突破封锁，只需要编辑你的服务器的/etc/ssh/sshd_config文件：</p>

<blockquote>Port 443</blockquote>


<p>然后重启SSH服务器：</p>

<blockquote>$ sudo reload ssh</blockquote>


<p>当然这样做的前提是你的服务器没有使用HTTS服务，但是实际上你只需要设置一台服务器使用https端口就够了，你但你可以访问这台服务器，你就 可以使用我们前面提到的技术利用它作为跳板来访问其它服务器，但是记住，你需要提前配置好这台服务器（现在怎么样？），这样万一当你身处一个只能访问 Web的网络环境时，就可以省掉打电话让其他人帮你配置中间服务器的麻烦了。</p>

<p><strong>10. 穿越Web代理</strong></p>

<p>有些时候，你所在的网络不止封锁SSH端口，它们有可能更进一步，只让你通过Web代理来访问网络，幸运的是我们有一个叫做<a href="http://www.agroman.net/corkscrew/" target="_blank">Corkscrew</a>的程序可以通过Web代理在发送SSH数据。Corkscrew的使用非常简单，一般我都是在需要时搜索，然后直接下载，跟随网站上的指示，然后就搞定了，一般你需要这样一条配置：</p>

<blockquote>ProxyCommand corkscrew proxy.example.org 8080 %h %p</blockquote>


<p><strong>11. 远程GUI</strong></p>

<p>有时候通过本地的GUI程序来访问远程服务器的文件会非常有用，比如，编辑一副图片，或者查看一个PDF文件，或者只是简单的通过一个非命令行的编 辑器来修改代码，我发现GVim要比终端里的Vim更有用，因为我可以通过gvimopens打开一个新窗口来编辑文件，而用当前的SSH窗口继续执行其 它操作，不要要这样做，你需要先在你的SSH配置中开启一个叫做X forwarding的选项：</p>

<blockquote>ForwardX11 yes</blockquote>


<p>这个选项需要服务器配置才能起作用，服务器也需要开启X forwarding，你可以在服务器的/etc/ssh/sshd_config中添加下面这个命令：</p>

<blockquote>X11Forwarding yes</blockquote>


<p>同时你还需要确保安装了xauth，编辑器，图片查看器以及其它的你需要运行的图形化程序，这种方式只有在支持本地X服务器的操作提供才可以工 作，mac和Windows上都有免费的X Server，你可能需要花些时间配置它们，相比之下，切换到Linux相对会更容易一下。</p>

<p><strong>12.本地操作远程文件</strong></p>

<p>另一种让远程GUI程序显示在本地的替代方案就是让本地的GUI程序可以直接操作远程文件，你可以通过SSHFS来实现，只需要创建一个空目录，然后使用SSHFS将一个远程目录mount到这个目录就可以了：</p>

<blockquote>$ mkdir gallery_src
$ sshfs dev:projects/gallery/src gallery_src
$ cd gallery_src
$ ls</blockquote>


<p>现在你就可以使用任何你喜欢的本地程序来便捷这个目录中的文件了，它们看起来是在你的本地，但其实时远程服务器上的文件，你可以使用fusermount命令来unmount这些文件，不要担心记不住，它们就在sshfs手册的顶上：</p>

<blockquote>$ cd ..
$ fusermount -u gallery_src</blockquote>


<p>SSHFS可以在Linux和OSX上工作，Windows用户我目前还没找到什么好办法。</p>

<p><strong>13. 通过Vim访问远程文件</strong></p>

<p>Vim有一个内置的功能可以直接编辑远程文件，需要借助SCP URL：</p>

<blockquote>$ gvim scp://dev/projects/gallery/src/templates/search.html.tt</blockquote>


<p>这中方式明显不如SSHFS灵活，但是如果你只需要对远程服务器的1，2个文件进行编辑时，这条命令就要更灵活一些了，并且可以在Windows上你也可以这样做：</p>

<blockquote>:help netrw-problems</blockquote>


<p><strong>14. 使用本地App连接远程服务器</strong></p>

<p>有时可能有些服务，比如数据库或是Web服务器，它们运行在远程服务器上，但是如果有用方式可以直接从本地程序连接它们，那会非常有用，要做到这一 点，你需要用到端口转发(port forwarding)，举个例子，如果你的服务器运行Postgres（并且只允许本地访问），那么你就可以在你的SSH配置中加入：</p>

<blockquote>Host db
LocalForward 5433 localhost:5432</blockquote>


<p>现在当你连接你的SSH服务器时，它会在你本地电脑打开一个5433端口（我随便挑的），并将所有发送到这个端口的数据转发到服务器的5432端口 （Postgres的默认端口），然后，只要你和服务器建立了连接，你就可以通过5433端口来访问服务器的Postgres了。</p>

<blockquote>$ ssh db</blockquote>


<p>现在打开另外一个窗口，你就可以通过下面这条命令在本地连接你的Postgres数据库了：</p>

<blockquote>$ psql -h localhost -p 5443 orders</blockquote>


<p>如果你想要使用服务器不支持的图形化Postgres客户端时，这条命令会显得尤其有用：</p>

<blockquote>$ pgadmin3 &amp;</blockquote>


<p>或者你有一个后台的Web服务器，你不希望直接通过Internet访问它，你也可以通过端口转发来访问它：</p>

<blockquote>Host api
LocalForward 8080 localhost:80</blockquote>


<p>现在连接到服务器：</p>

<blockquote>$ ssh api</blockquote>


<p>然后将浏览器指向你选择的端口号：</p>

<blockquote>$ firefox http://localhost:8080/</blockquote>


<p><strong>15. 减少延迟</strong></p>

<p>如果每次连接服务器都意味着你需要等待几十秒而无所事事，那么你或许应该试试在你的SSH配置中加入下面这条：</p>

<blockquote>GSSAPIAuthentication no</blockquote>


<p>如果这条命令有效的话，你应该通知你的系统管理员让他在服务器上禁用这个选项，这样其他人就不用再分别添加这条配置到它们的本地配置了。</p>

<p><strong>16. 加速连接</strong></p>

<p>如果你确保你和某个服务器之间的连接是安全的（比如通过公司内网连接），那么你就可以通过选择arcfourencryption算法来让数据传输更快一些：</p>

<blockquote>Host dev
Ciphers arcfour</blockquote>


<p>注意这个加速是以牺牲数据的“加密”性为代价的，所以如果你连接的是位于网上的服务器，千万不要打开这个选项，并且确保你是通过VPN建立的连接。</p>

<p><strong>开始行动吧！</strong></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/12/28/mei-ge-cheng-xu-yuan-du-bi-xu-zun-shou-de-bian-cheng-yuan-ze/">每个程序员都必须遵守的编程原则</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-12-28T18:51:00+08:00" pubdate data-updated="true">Dec 28<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>每个程序员都必须遵守的编程原则</h2>

<p>好的编程原则跟好的系统设计原则和技术实施原则有着密切的联系。下面的这些编程原则在过去的这些年里让我成为了一名优秀的程序员，我相信，这些原则对任何一个开发人员来说，都能让他的编程能力大幅度的提高，能让他开发出可维护性更强、缺陷更少的程序。</p>

<p><strong>我不要自我重复</strong> — 这也许是在编程开发这最最基本的一个信条，就是要告诉你不要出现重复的代码。我们很多的编程结构之所以存在，就是为了帮助我们消除重复(例如，循环语句， 函数，类，等等)。一旦程序里开始有重复现象的出现(例如很长的表达式、一大堆的语句，但都是为了表达相同的概念)，你就需要对代码进行一次新的提炼，抽 象。
<a href="http://en.wikipedia.org/wiki/Don%27t_repeat_yourself"><a href="http://en.wikipedia.org/wiki/Don%27t_repeat_yourself">http://en.wikipedia.org/wiki/Don%27t_repeat_yourself</a></a></p>

<p><strong>提炼原则</strong> — 跟“不要自我重复原则”相关，这一原则是说“程序中任何一段具有功能性的代码在源代码文件中应该唯一的存在。”
<a href="http://en.wikipedia.org/wiki/Abstraction_principle_%28programming"><a href="http://en.wikipedia.org/wiki/Abstraction_principle_">http://en.wikipedia.org/wiki/Abstraction_principle_</a>(programming</a>)</p>

<p><strong>保持简单</strong> — 简单化(避免复杂)永远都应该是你的头等目标。简单的程序让你写起来容易，产生的bug更少，更容易维护修改。
<a href="http://en.wikipedia.org/wiki/KISS_principle"><a href="http://en.wikipedia.org/wiki/KISS_principle">http://en.wikipedia.org/wiki/KISS_principle</a></a></p>

<p><strong>不要开发你目前用不到的功能</strong> — 除非你真正需要用到它，否则不要轻易加上那些乱七八糟用不到的功能。
<a href="http://en.wikipedia.org/wiki/YAGNI"><a href="http://en.wikipedia.org/wiki/YAGNI">http://en.wikipedia.org/wiki/YAGNI</a></a></p>

<p><strong>用最简单的方法让程序跑起来</strong> — 在开发时有个非常好的问题你需要问问自己，“怎样才能最简单的让程序跑起来？”这能帮助我们在设计时让程序保持简单。
<a href="http://c2.com/xp/DoTheSimplestThingThatCouldPossiblyWork.html"><a href="http://c2.com/xp/DoTheSimplestThingThatCouldPossiblyWork.html">http://c2.com/xp/DoTheSimplestThingThatCouldPossiblyWork.html</a></a></p>

<p><strong>不要让我动脑子</strong> — 这实际上是Steve Krug 关于web界面操作的一本书的书名，但也适用于编程。主旨是，程序代码应该让人们花最小的努力就能读懂和理解。如果一段程序对于阅读者来说需要花费太多的努力才能理解，那它很可能需要进一步简化。
<a href="http://www.sensible.com/dmmt.html"><a href="http://www.sensible.com/dmmt.html">http://www.sensible.com/dmmt.html</a></a></p>

<p><strong>开放</strong><strong>/</strong><strong>封闭原则</strong> — 程序里的实体项(类，模块，函数等)应该对扩展行为开放，对修改行为关闭。换句话说，不要写允许别人修改的类，应该写能让人们扩展的类。
<a href="http://en.wikipedia.org/wiki/Open_Closed_Principle"><a href="http://en.wikipedia.org/wiki/Open_Closed_Principle">http://en.wikipedia.org/wiki/Open_Closed_Principle</a></a></p>

<p><strong>为维护者写程序</strong> — 任何值得你编写的程序在将来都是值得你去维护的，也许由你维护，也许由他人。在将来，当你不得不维护这些程序时，你对这些代码的记忆会基本上跟一个陌生人 一样，所以，你最好还是当成一直在给别人写程序。一个有助于你记住这个原则的办法是“写程序时时刻记着，这个将来要维护你写的程序的人是一个有严重暴力倾 向，并且知道你住在哪里的精神变态者”。
<a href="http://c2.com/cgi/wiki?CodeForTheMaintainer"><a href="http://c2.com/cgi/wiki?CodeForTheMaintainer">http://c2.com/cgi/wiki?CodeForTheMaintainer</a></a></p>

<p><strong>最少意外原则</strong> — 最少意外原则通常是使用在用户界面设计上，但这个原则同样适用于编写程序。程序代码应尽可能的不要让阅读者感到意外。也就是说应该遵循编码规范和常见习惯，按照公认的习惯方式进行组织和命名，不符常规的编程动作应该尽可能的避免。
<a href="http://en.wikipedia.org/wiki/Principle_of_least_astonishment"><a href="http://en.wikipedia.org/wiki/Principle_of_least_astonishment">http://en.wikipedia.org/wiki/Principle_of_least_astonishment</a></a></p>

<p><strong>单一职责原则</strong> — 一个代码组件(例如类或函数)应该只执行单一的预设的任务。
<a href="http://en.wikipedia.org/wiki/Single_responsibility_principle"><a href="http://en.wikipedia.org/wiki/Single_responsibility_principle">http://en.wikipedia.org/wiki/Single_responsibility_principle</a></a></p>

<p><strong>最小化耦合关系</strong> — 一个代码片段(代码块，函数，类等)应该最小化它对其它代码的依赖。这个目标通过尽可能少的使用共享变量来实现。“低耦合是一个计算机系统结构合理、设计优秀的标志，把它与高聚合特征联合起来，会对可读性和可维护性等重要目标的实现具有重要的意义。”
<a href="http://en.wikipedia.org/wiki/Coupling_%28computer_programming"><a href="http://en.wikipedia.org/wiki/Coupling_">http://en.wikipedia.org/wiki/Coupling_</a>(computer_programming</a>)</p>

<p><strong>最大化内聚性</strong> — 具有相似功能的代码应该放在同一个代码组件里。
<a href="http://en.wikipedia.org/wiki/Cohesion_%28computer_science"><a href="http://en.wikipedia.org/wiki/Cohesion_">http://en.wikipedia.org/wiki/Cohesion_</a>(computer_science</a>)</p>

<p><strong>隐藏实现细节</strong> — 隐藏实现细节能最小化你在修改程序组件时产生的对那些使用这个组件的其它程序模块的影响。
<a href="http://en.wikipedia.org/wiki/Information_Hiding"><a href="http://en.wikipedia.org/wiki/Information_Hiding">http://en.wikipedia.org/wiki/Information_Hiding</a></a></p>

<p><strong>笛米特法则</strong><strong>(Law of Demeter)</strong> — 程序组件应该只跟它的直系亲属有关系(例如继承类，内包含的对象，通过参数入口传入的对象等。)
<a href="http://en.wikipedia.org/wiki/Law_of_Demeter"><a href="http://en.wikipedia.org/wiki/Law_of_Demeter">http://en.wikipedia.org/wiki/Law_of_Demeter</a></a></p>

<p><strong>避免过早优化</strong> — 只有当你的程序没有其它问题，只是比你预期的要慢时，你才能去考虑优化工作。只有当其它工作都做完后，你才能考虑优化问题，而且你只应该依据经验做法来优 化。“对于小幅度的性能改进都不该考虑，要优化就应该是97%的性能提升：过早优化是一切罪恶的根源”—Donald Knuth。
<a href="http://en.wikipedia.org/wiki/Program_optimization"><a href="http://en.wikipedia.org/wiki/Program_optimization">http://en.wikipedia.org/wiki/Program_optimization</a></a></p>

<p><strong>代码复用</strong> — 这不是非常核心的原则，但它跟其它原则一样非常有价值。代码复用能提高程序的可靠性，节省你的开发时间。
<a href="http://en.wikipedia.org/wiki/Code_reuse"><a href="http://en.wikipedia.org/wiki/Code_reuse">http://en.wikipedia.org/wiki/Code_reuse</a></a></p>

<p><strong>职责分离</strong> — 不同领域的功能应该由完全不同的代码模块来管理，尽量减少这样的模块之间的重叠。<a href="http://en.wikipedia.org/wiki/Separation_of_concerns"><a href="http://en.wikipedia.org/wiki/Separation_of_concerns">http://en.wikipedia.org/wiki/Separation_of_concerns</a></a></p>

<p><strong>拥抱变化</strong> — 这是Kent Beck的一本书的副标题，它也是极限编程和敏捷开发方法的基本信条之一。很多的其它原则都基于此观念：面对变化，欢迎变化。事实上，一些经典的软件工程 原则，例如最小化耦合，就是为了让程序更容易面对变化。不论你是否采用了极限编程方法，这个原则对你的程序开发都有重要意义。<a href="http://bit.ly/pR5Ii5"><a href="http://www.amazon.com/gp/product/0321278658">http://www.amazon.com/gp/product/0321278658</a></a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/12/28/bu-yao-zi-cheng-wei-cheng-xu-yuan/">不要自称为程序员</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-12-28T18:50:00+08:00" pubdate data-updated="true">Dec 28<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>不要自称为程序员</h2>

<p>每年都有无数年轻程序员，加入软件行业。</p>

<p>&nbsp;</p>

<p>他们在学校里学过编程，但是对这个行业的现实一无所知。</p>

<p>&nbsp;</p>

<p>Patrick McKenzie是美国一家小软件公司的老板，他写了一篇长文，介绍这个行业的一些实际情况。我看了以后很感慨，有些地方很受启发。我选择了一部分，翻译如下。</p>

<p>&nbsp;</p>

<p><strong>一、90%的编程工作来自内部软件</strong></p>

<p>&nbsp;</p>

<p>（90% of programming jobs are in creating Line of Business software）</p>

<p>&nbsp;</p>

<p>计算机专业的学生，可能有一种印象，觉得大部分程序员，都在编写公开出售的软件或者通用软件。</p>

<p>&nbsp;</p>

<p>这种看法是不对的。大部分程序员，实际上编写的是不公开的企业内部软件，比如追踪费用的软件、优化装运成本的软件、帮助记账的软件、设计新部件的软件、计算保单价格的软件、识别恶意订单的软件等等。</p>

<p>&nbsp;</p>

<p>各种各样的商业公司，开发内部软件，解决它们自己的问题。市场上对程序员的大部分需求来源于此，只有极少数程序员直接编写面向外部顾客的软件。</p>

<p>&nbsp;</p>

<p>内部软件的开发，通常非常乏味，令人厌倦。因为它们的技术复杂性低、技术决策非常保守、预算很少、缺乏长远考虑。但是，世界上大部分编程工作都是这种。</p>

<p>&nbsp;</p>

<p><strong>二、别人雇你的目的，是让你创造利润，不是让你编程</strong></p>

<p>&nbsp;</p>

<p>（Engineers are hired to create business value, not to program things）</p>

<p>&nbsp;</p>

<p>商业公司最关心的（或者说唯一在乎的）事情，就是增加收入、降低成本。因此，它们实际上需要的不是程序员，而是能够帮助它们增加收入、降低成本的人。</p>

<p>&nbsp;</p>

<p>开发优美的软件，解决技术难题，编写没有bug的代码，这些都不是商业公司的目的。它们雇佣你，是为了让你帮它们完成某个可以增加收入、降低成本的项目，而不是因为你是geek。</p>

<p>&nbsp;</p>

<p>你个人对于公司的唯一价值，就在于你能多大程度上为它们增加收入、降低成本。</p>

<p>&nbsp;</p>

<p><strong>三、不要自称为程序员</strong></p>

<p>&nbsp;</p>

<p>（Don’t call yourself a programmer）</p>

<p>&nbsp;</p>

<p>很多公司的经理不懂计算机，在他们心目中，”程序员”就是一群高成本的劳动力，只会在一台复杂的机器上干一些难懂的事情。</p>

<p>&nbsp;</p>

<p>如果你自称为”程序员”，当公司需要压缩成本的时候，某些经理首先就会想到解雇你。有一家公司叫Salesforce，口号是”没有软件”，意思就是如果经理们购买了他们的服务，就不再需要别的软件管理销售业务了，也就是说，不再需要自己雇佣程序员了。</p>

<p>&nbsp;</p>

<p>正确的做法是，你应该把自己描述成与增加收入、降低成本有关系的人，比如”xx产品的开发者”或”改进者”。有一个Google Adsense程序员的自我介绍，是这样写的：”Google公司97%的收入，与我的代码有关。”</p>

<p>&nbsp;</p>

<p><strong>四、不要限定自己</strong></p>

<p>&nbsp;</p>

<p>（You are not defined by your chosen software stack）</p>

<p>&nbsp;</p>

<p>年轻学生经常会问，应该选择哪种语言或平台？学会Java，是不是比学会.NET容易找工作？</p>

<p>&nbsp;</p>

<p>过分强调某一种语言或平台，都是不必要的。如果你把自己限定为Java程序员或.NET程序员，你就已经输了，因为首先你不应该自称为程序员（理由见上一点），其次这种限定使得你自动被排除在世界上大多数编程工作之外。</p>

<p>&nbsp;</p>

<p>现实生活中，学会一种新语言，只需要几个星期，然后再过半年到一年，你就会变成老手。那时，根本没人在乎你以前用什么语言。</p>

<p>&nbsp;</p>

<p>天才程序员是很少的，可是需要天才程序员的工作机会却很多很多，大多数场合都是需求远远大于供给。这意味着，即使你不是天才程序员，只要你是一个优 秀工程师，那些招聘公司也会立刻录用你，因为它们知道招聘到天才程序员的机会微乎其微。（重复一遍，所谓”优秀工程师”，就是你的履历上有一连串增加收 入、降低成本的记录。）</p>

<p>&nbsp;</p>

<p>某些公司的人事部门，会根据某个关键词（比如Java或.NET）过滤简历。虽然这样的公司根本不值得去，但是如果你真的想过这一关，也很容易：投入几个晚上和周末，在你当前的项目中设法用到这个关键词，然后再把它写进简历就行了。</p>

<p>&nbsp;</p>

<p><strong>五、如何提高求职时的谈判能力？</strong></p>

<p>&nbsp;</p>

<p>（How do I become better at negotiation?）</p>

<p>&nbsp;</p>

<p>（1）记住你不是在求职，不是在展示编程技巧，而是在推销某种商业需求（增加收入或降低成本）的解决方案。</p>

<p>&nbsp;</p>

<p>（2）面试时，要有自信，要平等的对话。你要的是一个互利的录用合同，不要每次对方提出要求，你都说Yes。</p>

<p>&nbsp;</p>

<p>（3）雇主可能会问”你的上一份工资是多少”，他们其实在说”给我一个理由，压低你的报酬”。你要想好如何适当地回答这个问题。</p>

<p>&nbsp;</p>

<p>（4）要还价。这里不仅仅指钱，还指其它你关心的方面。如果你无法要求更高的薪水，那就试着要求更多的假期。</p>

<p>&nbsp;</p>

<p>（5）在对方决定录用你以后，才开始讨论薪水。因为那时，他们已经在你身上，投入了大量的时间和金钱，产生了一定的成本，此时他们可能觉得一些小问题已经不值得再纠缠了，比如每年的工资增加几千元。</p>

<p>&nbsp;</p>

<p><strong>六、创业公司是否适合应届毕业生？</strong></p>

<p>&nbsp;</p>

<p>（Are startups great for your career as a fresh graduate?）</p>

<p>&nbsp;</p>

<p>如果你一毕业就加入创业公司，最可能的结果是，接下来几年你都工作得非常辛苦，然后公司悲惨地失败了，你失业了，不得不又去另一家创业公司工作。</p>

<p>&nbsp;</p>

<p>如果你真的想去创业公司，应该首先找一家大公司干上两年，攒一点钱，积累一些经验，然后精心挑选后再去创业公司。</p>

<p>&nbsp;</p>

<p>在创业公司工作，一般情况下，你遇到的都是创业者。他们大多数人没有能力在两年后雇佣你；而在大公司工作，你遇到的都是其他大公司的人，他们中很多人将来有能力雇用你或者帮你介绍工作。</p>

<p>&nbsp;</p>

<p><strong>七、在创业公司工作是否值得推荐？</strong></p>

<p>&nbsp;</p>

<p>（So would you recommend working at a startup? ）</p>

<p>&nbsp;</p>

<p>选择创业公司，就是选择一条职业道路，而不是选择一种生活方式。可惜很多人把这两者颠倒了，他们推荐创业公司，实际上是在推荐一种你感兴趣的生活方式。</p>

<p>&nbsp;</p>

<p>如果你确实喜欢这种生活方式，老实说，你在大公司里也可以得到它们。在许许多多大公司里，你都有机会钻研最新的技术，而且还能5点半准时回家照顾孩子。</p>

<p>&nbsp;</p>

<p><strong>八、沟通技能是最重要的职业技能</strong></p>

<p>&nbsp;</p>

<p>（Your most important professional skill is communication）</p>

<p>&nbsp;</p>

<p>前面说过，工程师被雇佣，不是因为会编程，而是因为能够创造商业价值。所以，你让人们相信你能创造价值，这是帮助你找到工作的最重要的能力。这种能力与你真的能创造多少价值，实际上联系不是很紧密。</p>

<p>&nbsp;</p>

<p>我认识的一些最优秀的程序员，往往拙于表达。因此，别人不是不想与他们一起工作，就是低估了他们的价值。相反地，如果你看上去很会编程，并且很善于表达，别人就会真的这样看待你。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/12/28/da-xing-wang-zhan-jia-gou-bu-de-bu-kao-lu-de-10ge-wen-ti/">大型网站架构不得不考虑的10个问题</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-12-28T18:41:00+08:00" pubdate data-updated="true">Dec 28<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>大型网站架构不得不考虑的10个问题</h2>

<p>这里的大型网站架构只包括高互动性高交互性的数据型大型网站，基于大家众所周知的原因，我们就不谈新闻类和一些依靠HTML静态化就可以实现的架构 了，我们以高负载高数据交换高数据流动性的网站为例，比如海内，开心网等类似的web2.0系列架构。我们这里不讨论是PHP还是JSP或者.NET环 境，我们从架构的方面去看问题，实现语言方面并不是问题，语言的优势在于实现而不是好坏，不论你选择任何语言，架构都是必须要面对的。</p>

<p>这里讨论一下大型网站需要注意和考虑的问题。</p>

<p>1、海量数据的处理</p>

<p>众所周知，对于一些相对小的站点来说，数据量并不是很大，select和update就可以解决我们面对的问题，本身负载量不是很大，最多再加几个 索引就可以搞定。对于大型网站，每天的数据量可能就上百万，如果一个设计不好的多对多关系，在前期是没有任何问题的，但是随着用户的增长，数据量会是几何 级的增长的。在这个时候我们对于一个表的select和update的时候(还不说多表联合查询)的成本的非常高的。</p>

<p>2、数据并发的处理</p>

<p>在一些时候，2.0的CTO都有个尚方宝剑，就是缓存。对于缓存，在高并发高处理的时候也是个大问题。在整个应用程序下，缓存是全局共享的，然而在 我们进行修改的时候就，如果两个或者多个请求同时对缓存有更新的要求的情况下，应用程序会直接的死掉。这个时候，就需要一个好的数据并发处理策略以及缓存 策略。</p>

<p>另外，就是数据库的死锁问题，也许平时我们感觉不到，死锁在高并发的情况下的出现的概率是非常高的，磁盘缓存就是一个大问题。</p>

<p>3、文件存贮的问题</p>

<p>对于一些支持文件上传的2.0的站点，在庆幸硬盘容量越来越大的时候我们更多的应该考虑的是文件应该如何被存储并且被有效的索引。常见的方案是对文 件按照日期和类型进行存贮。但是当文件量是海量的数据的情况下，如果一块硬盘存贮了500个G的琐碎文件，那么维护的时候和使用的时候磁盘的Io就是一个 巨大的问题，哪怕你的带宽足够，但是你的磁盘也未必响应过来。如果这个时候还涉及上传，磁盘很容易就over了。</p>

<p>也许用raid和专用存贮服务器能解决眼下的问题，但是还有个问题就是各地的访问问题，也许我们的服务器在北京，可能在云南或者新疆的访问速度如何解决?如果做分布式，那么我们的文件索引以及架构该如何规划。</p>

<p>所以我们不得不承认，文件存贮是个很不容易的问题</p>

<p>4、数据关系的处理</p>

<p>我们可以很容易的规划出一个符合第三范式的数据库，里面布满了多对多关系，还能用GUID来替换INDENTIFY COLUMN 但是，多对多关系充斥的2.0时代，第三范式是第一个应该被抛弃的。必须有效的把多表联合查询降到最低。</p>

<p>5、数据索引的问题</p>

<p>众所周知，索引是提高数据库效率查询的最方面最廉价最容易实现的方案。但是，在高UPDATE的情况下，update和delete付出的成本会高的无法想想，笔者遇到过一个情况，在更新一个聚焦索引的时候需要10分钟来完成，那么对于站点来说，这些基本上是不可忍受的。</p>

<p>索引和更新是一对天生的冤家，问题A，D，E这些是我们在做架构的时候不得不考虑的问题，并且也可能是花费时间最多的问题。</p>

<p>6、分布式处理</p>

<p>对于2.0网站由于其高互动性，CDN实现的效果基本上为0，内容是实时更新的，我们常规的处理。为了保证各地的访问速度，我们就需要面对一个绝大的问题，就是如何有效的实现数据同步和更新，实现各地服务器的实时通讯有是一个不得不需要考虑的问题。</p>

<p>7、Ajax的利弊分析</p>

<p>成也AJAX，败也AJAX，AJAX成为了主流趋势，突然发现基于XMLHTTP的post和get是如此的容易。客户端get或者post 到服务器数据，服务器接到数据请求之后返回来，这是一个很正常的AJAX请求。但是在AJAX处理的时候，如果我们使用一个抓包工具的话，对数据返回和处 理是一目了然。对于一些计算量大的AJAX请求的话，我们可以构造一个发包机，很容易就可以把一个webserver干掉。</p>

<p>8、数据安全性的分析</p>

<p>对于HTTP协议来说，数据包都是明文传输的，也许我们可以说我们可以用加密啊，但是对于G问题来说的话，加密的过程就可能是明文了(比如我们知道 的QQ，可以很容易的判断他的加密，并有效的写一个跟他一样的加密和解密方法出来的)。当你站点流量不是很大的时候没有人会在乎你，但是当你流量上来之 后，那么所谓的外挂，所谓的群发就会接踵而来(从qq一开始的群发可见端倪)。也许我们可以很的意的说，我们可以采用更高级别的判断甚至HTTPS来实 现，注意，当你做这些处理的时候付出的将是海量的database，io以及CPU的成本。对于一些群发，基本上是不可能的。笔者已经可以实现对于百度空 间和qq空间的群发了。大家愿意试试，实际上并不是很难。</p>

<p>9、数据同步和集群的处理的问题</p>

<p>当我们的一台databaseserver不堪重负的时候，这个时候我们就需要做基于数据库的负载和集群了。而这个时候可能是最让人困扰的的问题 了，数据基于网络传输根据数据库的设计的不同，数据延迟是很可怕的问题，也是不可避免的问题，这样的话，我们就需要通过另外的手段来保证在这延迟的几秒或 者更长的几分钟时间内，实现有效的交互。比如数据散列，分割，内容处理等等问题。</p>

<p>10、数据共享的渠道以及OPENAPI趋势</p>

<p>Openapi已经成为一个不可避免的趋势，从google，facebook，myspace到21kaiyun.com，都在考虑这个问题，它 可以更有效的留住用户并激发用户的更多的兴趣以及让更多的人帮助你做最有效的开发。这个时候一个有效的数据共享平台，数据开放平台就成为必不可少的途径 了，而在开放的接口的情况保证数据的安全性和性能，又是一个我们必须要认真思考的问题了。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/12/28/slash-usr-de-lai-long-qu-mai/">/usr 的来龙去脉</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-12-28T18:21:00+08:00" pubdate data-updated="true">Dec 28<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>/usr 的来龙去脉</h2>

<p>在 linux 文件结构中，有一个很神奇的目录 —— /usr。之前一直没有怎么关注过它，反正程序都是安装在里边的，也没有什么值得追根溯源的东西。直到有一天 <a href="http://cnbeta.com/articles/160791.htm">fedora 要简化整个文件系统体系</a>，看到讨论才想到，usr 到底是什么的缩写呢，它又是怎么来的呢？</p>

<p>讨论中，大部分观点认为：</p>

<ul>
    <li>usr 是 unix system resources 的缩写；</li>
    <li>usr 是 user 的缩写；</li>
    <li>usr 是 unix software resources 的缩写。</li>
</ul>


<p>根据常识判断，是 user 缩写的可能性不大，因为和 /home 冲突了嘛。不过是 system resources 还是 software resources 的缩写还真不好说。特此查了好多东西，却发现竟然连 <a href="http://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard">wikipedia 也模棱两可</a>。</p>

<p>后来终于找到了 相关的文档和介绍。（<a href="http://tldp.org/LDP/Linux-Filesystem-Hierarchy/html/usr.html">via</a>，<a href="http://webcache.googleusercontent.com/search?q=cache:HBW07QkS9DsJ:tldp.org/LDP/Linux-Filesystem-Hierarchy/html/usr.html+&amp;cd=1&amp;hl=en&amp;ct=clnk">cache</a>）</p>

<blockquote>/usr usually contains by far the largest share of data on a system. Hence, this is one of the most important directories in the system as it contains all the user binaries, their documentation, libraries, header files, etc…. X and its supporting libraries can be found here. User programs like telnet, ftp, etc…. are also placed here. In the original Unix implementations, /usr was where the home directories of the users were placed (that is to say, /usr/someone was then the directory now known as /home/someone). In current Unices, /usr is where user-land programs and data (as opposed to ’system land’ programs and data) are. <strong>The name hasn’t changed, but it’s meaning has narrowed and lengthened from “everything user related” to “user usable programs and data”. As such, some people may now refer to this directory as meaning ‘User System Resources’ and not ‘user’ as was originally intended.</strong>（via<a href="http://tldp.org/LDP/Linux-Filesystem-Hierarchy/html/usr.html">1</a>,<a href="http://en.wikipedia.org/wiki/Unix_directory_structure">2</a>）</blockquote>


<p>/usr 是系统核心所在，包含了所有的共享文件。它是 unix 系统中最重要的目录之一，涵盖了二进制文件，各种文档，各种头文件，x，还有各种库文件；还有诸多程序，例如 ftp，telnet 等等。</p>

<p>曾经的 /usr 还是用户的家目录，存放着各种用户文件 —— 现在已经被 /home 取代了（例如 /usr/someone 已经改为 /home/someone）。现代的 /usr 只专门存放各种程序和数据，用户目录已经转移。虽然  /usr 名称未改，不过其含义已经从“用户目录”变成了“unix 系统资源”目录。值得注意的是，在一些 unix 系统上，仍然把 /usr/someone 当做用户家目录，如 Minix。</p>

<p>至此，真相大白。看来就像前一阵子的 <a href="http://linux.solidot.org/linux/11/03/31/0958237.shtml">/var/run 移到 /run</a> 一样。</p>

<p>真的是不看不知道，一看吓一跳呀。原来 linux 几经进化，好多目录的诞生和用途已经产生了根本的变化。历史车轮在前进，长江后浪推前浪，正所谓：学习历史，收获真知；尽心竭力，前进不止。</p>

<h2><strong>附录：/usr 目录结构</strong></h2>


<ul>
    <li><strong>/usr/bin</strong> : 所有可执行文件，如 gcc，firefox 等（指不包含在 <strong>/sbin</strong> 和 <strong>/bin</strong> 内的）；</li>
    <li><strong>/usr/include</strong> : 各种头文件，编译文件等时需要使用；
<ul>
    <li><strong>/usr/include/’package-name’</strong> : 程序特定的头文件；</li>
</ul>
</li>
    <li><strong>/usr/lib</strong> : 所以可执行文件所需要的库文件；</li>
    <li><strong>/usr/local </strong>: /usr 通常只包含系统发行时自带的程序，而 /usr/local 则是本地系统管理员用来自由添加程序的目录；</li>
    <li><strong>/usr/X11R6</strong> : x 系统的二进制文件，库文件，文档，字体等。它不等同于 /usr 的作用，只有 x 才能调用这些库文件等，其他程序不读取或者使用。因为 linux 没有原生图形界面，而且 linux 大部分情况下是 for server 的，所以图形界面没有意义；其中 X11R6 代表 version 11 release 6；
<ul>
    <li><strong>/usr/X11R6/bin</strong> : x 的二进制文件，包含运行 x 的必须文件；</li>
    <li><strong>/usr/X11R6/include</strong> : x 相关的头文件；</li>
    <li><strong>/usr/X11R6/lib</strong> : x 库文件；</li>
    <li><strong>/usr/X11R6/lib/modules</strong> : x 的模块，启动时加载。缺少 video4linux, DRI and GLX 和 输入输出设备 模块，将工作不正常；</li>
    <li><strong>/usr/X11R6/lib/X11/fonts</strong> : x font server 的字体文件；</li>
</ul>
</li>
    <li><strong>/usr/doc</strong> : 文档。实际是<strong> /usr/share/doc </strong>的软链接；</li>
    <li><strong>/usr/etc</strong> : 一个极少用到的配置文件存放地；</li>
    <li><strong>/usr/games</strong> : 曾经包含游戏等文件，现在很少用到；</li>
    <li><strong>/usr/info</strong> : 系统相关信息，是 <strong>/usr/share/info </strong>的软链接；</li>
    <li><strong>/usr/man</strong> : man 手册，已经移至 <strong>/usr/share/man</strong>；</li>
    <li><strong>/usr/sbin</strong> : 类似 /sbin，root 可以执行。但此目录不包含在环境变量 $PATH 中，它包含的程序类似于 chroot, useradd, in.tftpd and pppconfig；</li>
    <li><strong>/usr/share</strong> : 它包含了各种程序间的共享文件，如字体，图标，文档等。（/usr/local 对应的目录是  /usr/loca/share）;
<ul>
    <li><strong>/usr/share/doc</strong> : 类似应用程序的 man 手册。它包含程序的说明文件，默认配置文件等；</li>
    <li><strong>/usr/share/info</strong> : 不常用，已经被 man 代替；</li>
    <li><strong>/usr/share/man</strong> : app 的 manual；</li>
    <li><strong>/usr/share/icons</strong> : 应用程序的图标等文件，分为 png，svg 等多种格式；</li>
    <li><strong>/usr/share/fonts</strong> : 字体文件，系统范围内可使用，~/.fonts 仅当前用户可用；</li>
</ul>
</li>
    <li><strong>/usr/src</strong> : linux 内核的源码和说明文档等；
<ul>
    <li><strong>/usr/src/linux</strong> : linux 源代码；</li>
    <li><strong>/usr/src/linux/.config</strong> : 内核编译过程产生的文件；通常由命令 ‘make config’ ， ‘make menuconfig’ 或 ‘make xconfig’ 执行后产生；</li>
    <li><strong>/usr/src/linux/.depend, /usr/src/linux/.hdepend</strong> : ‘make dep’ 检测编译依赖时需要的文件，由 /usr/src/linux/.config 产生；</li>
    <li><strong>/usr/src/linux/COPYING</strong> : GNU license；</li>
    <li><strong>/usr/src/linux/Makefile</strong> : 编译内核所需的 Makefile；</li>
    <li><strong>/usr/src/linux/Rules.make</strong> : 当有多个 Makefile 时，根据它的规则执行 make；</li>
</ul>
</li>
    <li><strong>/usr/tmp</strong> : 已经被众多发行版抛弃的临时文件夹。</li>
</ul>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/13/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/11/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/10/08/tong-guo-mongodumphe-mongorestoreshi-xian-mongodbbei-fen-he-hui-fu-by-chenzhou123520/">通过mongodump和mongorestore实现Mongodb备份和恢复 &#8211;by Chenzhou123520</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/10/06/ruby-on-rails-4-dot-0-release-notes/">Ruby on Rails 4.0 Release Notes</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/10/06/rails-active-record-named-scopes/">Rails Active Record Named Scopes</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/09/27/shai-shai-wo-men-de-kai-yuan-xiang-mu-iteyekai-yuan-dai-ma/">晒晒我们的开源项目 ITEYE开源代码</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/09/26/single-sign-on-dan-dian-deng-lu-sso/">Single Sign-on 单点登录 Sso</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/jhjguxin">@jhjguxin</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'jhjguxin',
            count: 10,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Francis Jiang -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
